/*
* EaselJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011 gskinner.com, inc.
* 
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/

/*
* Copyright (c) 2006-2007 Erin Catto http://www.gphysics.com
*
* This software is provided 'as-is', without any express or implied
* warranty.  In no event will the authors be held liable for any damages
* arising from the use of this software.
* Permission is granted to anyone to use this software for any purpose,
* including commercial applications, and to alter it and redistribute it
* freely, subject to the following restrictions:
* 1. The origin of this software must not be misrepresented; you must not
* claim that you wrote the original software. If you use this software
* in a product, an acknowledgment in the product documentation would be
* appreciated but is not required.
* 2. Altered source versions must be plainly marked as such, and must not be
* misrepresented as being the original software.
* 3. This notice may not be removed or altered from any source distribution.
*/

/**
* PreloadJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011 gskinner.com, inc.
* 
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
**/

this.createjs=this.createjs||{},function(){var t=function(){throw"UID cannot be instantiated"};t._nextID=0,t.get=function(){return t._nextID++},createjs.UID=t}(),this.createjs=this.createjs||{},function(){var t=function(){this.initialize()},e=t.prototype;t.initialize=function(t){t.addEventListener=e.addEventListener,t.removeEventListener=e.removeEventListener,t.removeAllEventListeners=e.removeAllEventListeners,t.hasEventListener=e.hasEventListener,t.dispatchEvent=e.dispatchEvent},e._listeners=null,e.initialize=function(){},e.addEventListener=function(t,e){var i=this._listeners;i?this.removeEventListener(t,e):i=this._listeners={};var o=i[t];return o||(o=i[t]=[]),o.push(e),e},e.removeEventListener=function(t,e){var i=this._listeners;if(i){var o=i[t];if(o)for(var n=0,s=o.length;s>n;n++)if(o[n]==e){1==s?delete i[t]:o.splice(n,1);break}}},e.removeAllEventListeners=function(t){t?this._listeners&&delete this._listeners[t]:this._listeners=null},e.dispatchEvent=function(t,e){var i=!1,o=this._listeners;if(t&&o){if("string"==typeof t&&(t={type:t}),o=o[t.type],!o)return i;t.target=e||this;for(var o=o.slice(),n=0,s=o.length;s>n;n++)var r=o[n],i=r.handleEvent?i||r.handleEvent(t):i||r(t)}return!!i},e.hasEventListener=function(t){var e=this._listeners;return!(!e||!e[t])},e.toString=function(){return"[EventDispatcher]"},createjs.EventDispatcher=t}(),this.createjs=this.createjs||{},function(){var t=function(){throw"Ticker cannot be instantiated."};t.useRAF=!1,t.addEventListener=null,t.removeEventListener=null,t.removeAllEventListeners=null,t.dispatchEvent=null,t.hasEventListener=null,t._listeners=null,createjs.EventDispatcher.initialize(t),t._listeners=null,t._pauseable=null,t._paused=!1,t._inited=!1,t._startTime=0,t._pausedTime=0,t._ticks=0,t._pausedTicks=0,t._interval=50,t._lastTime=0,t._times=null,t._tickTimes=null,t._rafActive=!1,t._timeoutID=null,t.addListener=function(e,i){null!=e&&(t.removeListener(e),t._pauseable[t._listeners.length]=null==i?!0:i,t._listeners.push(e))},t.init=function(){t._inited=!0,t._times=[],t._tickTimes=[],t._pauseable=[],t._listeners=[],t._times.push(t._lastTime=t._startTime=t._getTime()),t.setInterval(t._interval)},t.removeListener=function(e){var i=t._listeners;i&&(e=i.indexOf(e),-1!=e&&(i.splice(e,1),t._pauseable.splice(e,1)))},t.removeAllListeners=function(){t._listeners=[],t._pauseable=[]},t.setInterval=function(e){t._interval=e,t._inited&&t._setupTick()},t.getInterval=function(){return t._interval},t.setFPS=function(e){t.setInterval(1e3/e)},t.getFPS=function(){return 1e3/t._interval},t.getMeasuredFPS=function(e){return 2>t._times.length?-1:(null==e&&(e=0|t.getFPS()),e=Math.min(t._times.length-1,e),1e3/((t._times[0]-t._times[e])/e))},t.setPaused=function(e){t._paused=e},t.getPaused=function(){return t._paused},t.getTime=function(e){return t._getTime()-t._startTime-(e?t._pausedTime:0)},t.getTicks=function(e){return t._ticks-(e?t._pausedTicks:0)},t._handleAF=function(){t._rafActive=!1,t._setupTick(),t._getTime()-t._lastTime>=.97*(t._interval-1)&&t._tick()},t._handleTimeout=function(){t.timeoutID=null,t._setupTick(),t._tick()},t._setupTick=function(){if(!t._rafActive&&null==t.timeoutID){if(t.useRAF){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(e)return e(t._handleAF),t._rafActive=!0,void 0}t.timeoutID=setTimeout(t._handleTimeout,t._interval)}},t._tick=function(){var e=t._getTime();t._ticks++;var i=e-t._lastTime,o=t._paused;o&&(t._pausedTicks++,t._pausedTime+=i),t._lastTime=e;for(var n=t._pauseable,s=t._listeners.slice(),r=s?s.length:0,a=0;r>a;a++){var l=s[a];null==l||o&&n[a]||(l.tick?l.tick(i,o):l instanceof Function&&l(i,o))}for(t.dispatchEvent({type:"tick",paused:o,delta:i,time:e,runTime:e-t._pausedTime}),t._tickTimes.unshift(t._getTime()-e);100<t._tickTimes.length;)t._tickTimes.pop();for(t._times.unshift(e);100<t._times.length;)t._times.pop()};var e=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);t._getTime=function(){return e&&e.call(performance)||(new Date).getTime()},t.init(),createjs.Ticker=t}(),this.createjs=this.createjs||{},function(){var t=function(t,e,i,o,n,s,r,a,l){this.initialize(t,e,i,o,n,s,r,a,l)},e=t.prototype;e.stageX=0,e.stageY=0,e.rawX=0,e.rawY=0,e.type=null,e.nativeEvent=null,e.onMouseMove=null,e.onMouseUp=null,e.target=null,e.pointerID=0,e.primary=!1,e.addEventListener=null,e.removeEventListener=null,e.removeAllEventListeners=null,e.dispatchEvent=null,e.hasEventListener=null,e._listeners=null,createjs.EventDispatcher.initialize(e),e.initialize=function(t,e,i,o,n,s,r,a,l){this.type=t,this.stageX=e,this.stageY=i,this.target=o,this.nativeEvent=n,this.pointerID=s,this.primary=r,this.rawX=null==a?e:a,this.rawY=null==l?i:l},e.clone=function(){return new t(this.type,this.stageX,this.stageY,this.target,this.nativeEvent,this.pointerID,this.primary,this.rawX,this.rawY)},e.toString=function(){return"[MouseEvent (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"},createjs.MouseEvent=t}(),this.createjs=this.createjs||{},function(){var t=function(t,e,i,o,n,s){this.initialize(t,e,i,o,n,s)},e=t.prototype;t.identity=null,t.DEG_TO_RAD=Math.PI/180,e.a=1,e.b=0,e.c=0,e.d=1,e.tx=0,e.ty=0,e.alpha=1,e.shadow=null,e.compositeOperation=null,e.initialize=function(t,e,i,o,n,s){return null!=t&&(this.a=t),this.b=e||0,this.c=i||0,null!=o&&(this.d=o),this.tx=n||0,this.ty=s||0,this},e.prepend=function(t,e,i,o,n,s){var r=this.tx;if(1!=t||0!=e||0!=i||1!=o){var a=this.a,l=this.c;this.a=a*t+this.b*i,this.b=a*e+this.b*o,this.c=l*t+this.d*i,this.d=l*e+this.d*o}return this.tx=r*t+this.ty*i+n,this.ty=r*e+this.ty*o+s,this},e.append=function(t,e,i,o,n,s){var r=this.a,a=this.b,l=this.c,h=this.d;return this.a=t*r+e*l,this.b=t*a+e*h,this.c=i*r+o*l,this.d=i*a+o*h,this.tx=n*r+s*l+this.tx,this.ty=n*a+s*h+this.ty,this},e.prependMatrix=function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty),this.prependProperties(t.alpha,t.shadow,t.compositeOperation),this},e.appendMatrix=function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty),this.appendProperties(t.alpha,t.shadow,t.compositeOperation),this},e.prependTransform=function(e,i,o,n,s,r,a,l,h){if(s%360){var c=s*t.DEG_TO_RAD;s=Math.cos(c),c=Math.sin(c)}else s=1,c=0;return(l||h)&&(this.tx-=l,this.ty-=h),r||a?(r*=t.DEG_TO_RAD,a*=t.DEG_TO_RAD,this.prepend(s*o,c*o,-c*n,s*n,0,0),this.prepend(Math.cos(a),Math.sin(a),-Math.sin(r),Math.cos(r),e,i)):this.prepend(s*o,c*o,-c*n,s*n,e,i),this},e.appendTransform=function(e,i,o,n,s,r,a,l,h){if(s%360){var c=s*t.DEG_TO_RAD;s=Math.cos(c),c=Math.sin(c)}else s=1,c=0;return r||a?(r*=t.DEG_TO_RAD,a*=t.DEG_TO_RAD,this.append(Math.cos(a),Math.sin(a),-Math.sin(r),Math.cos(r),e,i),this.append(s*o,c*o,-c*n,s*n,0,0)):this.append(s*o,c*o,-c*n,s*n,e,i),(l||h)&&(this.tx-=l*this.a+h*this.c,this.ty-=l*this.b+h*this.d),this},e.rotate=function(t){var e=Math.cos(t);t=Math.sin(t);var i=this.a,o=this.c,n=this.tx;return this.a=i*e-this.b*t,this.b=i*t+this.b*e,this.c=o*e-this.d*t,this.d=o*t+this.d*e,this.tx=n*e-this.ty*t,this.ty=n*t+this.ty*e,this},e.skew=function(e,i){return e*=t.DEG_TO_RAD,i*=t.DEG_TO_RAD,this.append(Math.cos(i),Math.sin(i),-Math.sin(e),Math.cos(e),0,0),this},e.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},e.translate=function(t,e){return this.tx+=t,this.ty+=e,this},e.identity=function(){return this.alpha=this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.shadow=this.compositeOperation=null,this},e.invert=function(){var t=this.a,e=this.b,i=this.c,o=this.d,n=this.tx,s=t*o-e*i;return this.a=o/s,this.b=-e/s,this.c=-i/s,this.d=t/s,this.tx=(i*this.ty-o*n)/s,this.ty=-(t*this.ty-e*n)/s,this},e.isIdentity=function(){return 0==this.tx&&0==this.ty&&1==this.a&&0==this.b&&0==this.c&&1==this.d},e.decompose=function(e){null==e&&(e={}),e.x=this.tx,e.y=this.ty,e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var i=Math.atan2(-this.c,this.d),o=Math.atan2(this.b,this.a);return i==o?(e.rotation=o/t.DEG_TO_RAD,0>this.a&&0<=this.d&&(e.rotation+=0>=e.rotation?180:-180),e.skewX=e.skewY=0):(e.skewX=i/t.DEG_TO_RAD,e.skewY=o/t.DEG_TO_RAD),e},e.reinitialize=function(t,e,i,o,n,s,r,a,l){return this.initialize(t,e,i,o,n,s),this.alpha=r||1,this.shadow=a,this.compositeOperation=l,this},e.appendProperties=function(t,e,i){return this.alpha*=t,this.shadow=e||this.shadow,this.compositeOperation=i||this.compositeOperation,this},e.prependProperties=function(t,e,i){return this.alpha*=t,this.shadow=this.shadow||e,this.compositeOperation=this.compositeOperation||i,this},e.clone=function(){var e=new t(this.a,this.b,this.c,this.d,this.tx,this.ty);return e.shadow=this.shadow,e.alpha=this.alpha,e.compositeOperation=this.compositeOperation,e},e.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},t.identity=new t(1,0,0,1,0,0),createjs.Matrix2D=t}(),this.createjs=this.createjs||{},function(){var t=function(t,e){this.initialize(t,e)},e=t.prototype;e.x=0,e.y=0,e.initialize=function(t,e){this.x=null==t?0:t,this.y=null==e?0:e},e.clone=function(){return new t(this.x,this.y)},e.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},createjs.Point=t}(),this.createjs=this.createjs||{},function(){var t=function(t,e,i,o){this.initialize(t,e,i,o)},e=t.prototype;e.x=0,e.y=0,e.width=0,e.height=0,e.initialize=function(t,e,i,o){this.x=null==t?0:t,this.y=null==e?0:e,this.width=null==i?0:i,this.height=null==o?0:o},e.clone=function(){return new t(this.x,this.y,this.width,this.height)},e.toString=function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"},createjs.Rectangle=t}(),this.createjs=this.createjs||{},function(){var t=function(t,e,i,o,n,s,r){this.initialize(t,e,i,o,n,s,r)},e=t.prototype;e.target=null,e.overLabel=null,e.outLabel=null,e.downLabel=null,e.play=!1,e._isPressed=!1,e._isOver=!1,e.initialize=function(t,e,i,o,n,s,r){t.addEventListener&&(this.target=t,t.cursor="pointer",this.overLabel=null==i?"over":i,this.outLabel=null==e?"out":e,this.downLabel=null==o?"down":o,this.play=n,this.setEnabled(!0),this.handleEvent({}),s&&(r&&(s.actionsEnabled=!1,s.gotoAndStop&&s.gotoAndStop(r)),t.hitArea=s))},e.setEnabled=function(t){var e=this.target;t?(e.addEventListener("mouseover",this),e.addEventListener("mouseout",this),e.addEventListener("mousedown",this)):(e.removeEventListener("mouseover",this),e.removeEventListener("mouseout",this),e.removeEventListener("mousedown",this))},e.toString=function(){return"[ButtonHelper]"},e.handleEvent=function(t){var e=this.target,i=t.type;"mousedown"==i?(t.addEventListener("mouseup",this),this._isPressed=!0,t=this.downLabel):"mouseup"==i?(this._isPressed=!1,t=this._isOver?this.overLabel:this.outLabel):"mouseover"==i?(this._isOver=!0,t=this._isPressed?this.downLabel:this.overLabel):(this._isOver=!1,t=this._isPressed?this.overLabel:this.outLabel),this.play?e.gotoAndPlay&&e.gotoAndPlay(t):e.gotoAndStop&&e.gotoAndStop(t)},createjs.ButtonHelper=t}(),this.createjs=this.createjs||{},function(){var t=function(t,e,i,o){this.initialize(t,e,i,o)},e=t.prototype;t.identity=null,e.color=null,e.offsetX=0,e.offsetY=0,e.blur=0,e.initialize=function(t,e,i,o){this.color=t,this.offsetX=e,this.offsetY=i,this.blur=o},e.toString=function(){return"[Shadow]"},e.clone=function(){return new t(this.color,this.offsetX,this.offsetY,this.blur)},t.identity=new t("transparent",0,0,0),createjs.Shadow=t}(),this.createjs=this.createjs||{},function(){var t=function(t){this.initialize(t)},e=t.prototype;e.complete=!0,e.onComplete=null,e.addEventListener=null,e.removeEventListener=null,e.removeAllEventListeners=null,e.dispatchEvent=null,e.hasEventListener=null,e._listeners=null,createjs.EventDispatcher.initialize(e),e._animations=null,e._frames=null,e._images=null,e._data=null,e._loadCount=0,e._frameHeight=0,e._frameWidth=0,e._numFrames=0,e._regX=0,e._regY=0,e.initialize=function(t){var e,i,o;if(null!=t){if(t.images&&0<(i=t.images.length))for(o=this._images=[],e=0;i>e;e++){var n=t.images[e];if("string"==typeof n){var s=n,n=new Image;n.src=s}o.push(n),!n.getContext&&!n.complete&&(this._loadCount++,this.complete=!1,function(t){n.onload=function(){t._handleImageLoad()}}(this))}if(null!=t.frames)if(t.frames instanceof Array)for(this._frames=[],o=t.frames,e=0,i=o.length;i>e;e++)s=o[e],this._frames.push({image:this._images[s[4]?s[4]:0],rect:new createjs.Rectangle(s[0],s[1],s[2],s[3]),regX:s[5]||0,regY:s[6]||0});else i=t.frames,this._frameWidth=i.width,this._frameHeight=i.height,this._regX=i.regX||0,this._regY=i.regY||0,this._numFrames=i.count,0==this._loadCount&&this._calculateFrames();if(null!=(i=t.animations)){this._animations=[],this._data={};for(var r in i){if(t={name:r},s=i[r],"number"==typeof s)o=t.frames=[s];else if(s instanceof Array)if(1==s.length)t.frames=[s[0]];else for(t.frequency=s[3],t.next=s[2],o=t.frames=[],e=s[0];e<=s[1];e++)o.push(e);else t.frequency=s.frequency,t.next=s.next,e=s.frames,o=t.frames="number"==typeof e?[e]:e.slice(0);t.next=2>o.length||0==t.next?null:null==t.next||1==t.next?r:t.next,t.frequency||(t.frequency=1),this._animations.push(r),this._data[r]=t}}}},e.getNumFrames=function(t){return null==t?this._frames?this._frames.length:this._numFrames:(t=this._data[t],null==t?0:t.frames.length)},e.getAnimations=function(){return this._animations.slice(0)},e.getAnimation=function(t){return this._data[t]},e.getFrame=function(t){var e;return this.complete&&this._frames&&(e=this._frames[t])?e:null},e.getFrameBounds=function(t){return(t=this.getFrame(t))?new createjs.Rectangle(-t.regX,-t.regY,t.rect.width,t.rect.height):null},e.toString=function(){return"[SpriteSheet]"},e.clone=function(){var e=new t;return e.complete=this.complete,e._animations=this._animations,e._frames=this._frames,e._images=this._images,e._data=this._data,e._frameHeight=this._frameHeight,e._frameWidth=this._frameWidth,e._numFrames=this._numFrames,e._loadCount=this._loadCount,e},e._handleImageLoad=function(){0==--this._loadCount&&(this._calculateFrames(),this.complete=!0,this.onComplete&&this.onComplete(),this.dispatchEvent("complete"))},e._calculateFrames=function(){if(!this._frames&&0!=this._frameWidth){this._frames=[];for(var t=0,e=this._frameWidth,i=this._frameHeight,o=0,n=this._images;o<n.length;o++){for(var s=n[o],r=0|(s.width+1)/e,a=0|(s.height+1)/i,a=0<this._numFrames?Math.min(this._numFrames-t,r*a):r*a,l=0;a>l;l++)this._frames.push({image:s,rect:new createjs.Rectangle(l%r*e,(0|l/r)*i,e,i),regX:this._regX,regY:this._regY});t+=a}this._numFrames=t}},createjs.SpriteSheet=t}(),this.createjs=this.createjs||{},function(){function t(t,e,i){this.f=t,this.params=e,this.path=null==i?!0:i}t.prototype.exec=function(t){this.f.apply(t,this.params)};var e=function(){this.initialize()},i=e.prototype;e.getRGB=function(t,e,i,o){return null!=t&&null==i&&(o=e,i=255&t,e=255&t>>8,t=255&t>>16),null==o?"rgb("+t+","+e+","+i+")":"rgba("+t+","+e+","+i+","+o+")"},e.getHSL=function(t,e,i,o){return null==o?"hsl("+t%360+","+e+"%,"+i+"%)":"hsla("+t%360+","+e+"%,"+i+"%,"+o+")"},e.BASE_64={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63},e.STROKE_CAPS_MAP=["butt","round","square"],e.STROKE_JOINTS_MAP=["miter","round","bevel"],e._ctx=(createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")).getContext("2d"),e.beginCmd=new t(e._ctx.beginPath,[],!1),e.fillCmd=new t(e._ctx.fill,[],!1),e.strokeCmd=new t(e._ctx.stroke,[],!1),i._strokeInstructions=null,i._strokeStyleInstructions=null,i._ignoreScaleStroke=!1,i._fillInstructions=null,i._instructions=null,i._oldInstructions=null,i._activeInstructions=null,i._active=!1,i._dirty=!1,i.initialize=function(){this.clear(),this._ctx=e._ctx},i.isEmpty=function(){return!(this._instructions.length||this._oldInstructions.length||this._activeInstructions.length)},i.draw=function(t){this._dirty&&this._updateInstructions();for(var e=this._instructions,i=0,o=e.length;o>i;i++)e[i].exec(t)},i.drawAsPath=function(t){this._dirty&&this._updateInstructions();for(var e,i=this._instructions,o=0,n=i.length;n>o;o++)((e=i[o]).path||0==o)&&e.exec(t)},i.moveTo=function(e,i){return this._activeInstructions.push(new t(this._ctx.moveTo,[e,i])),this},i.lineTo=function(e,i){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.lineTo,[e,i])),this},i.arcTo=function(e,i,o,n,s){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.arcTo,[e,i,o,n,s])),this},i.arc=function(e,i,o,n,s,r){return this._dirty=this._active=!0,null==r&&(r=!1),this._activeInstructions.push(new t(this._ctx.arc,[e,i,o,n,s,r])),this},i.quadraticCurveTo=function(e,i,o,n){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.quadraticCurveTo,[e,i,o,n])),this},i.bezierCurveTo=function(e,i,o,n,s,r){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.bezierCurveTo,[e,i,o,n,s,r])),this},i.rect=function(e,i,o,n){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.rect,[e,i,o,n])),this},i.closePath=function(){return this._active&&(this._dirty=!0,this._activeInstructions.push(new t(this._ctx.closePath,[]))),this},i.clear=function(){return this._instructions=[],this._oldInstructions=[],this._activeInstructions=[],this._strokeStyleInstructions=this._strokeInstructions=this._fillInstructions=null,this._active=this._dirty=!1,this},i.beginFill=function(i){return this._active&&this._newPath(),this._fillInstructions=i?[new t(this._setProp,["fillStyle",i],!1),e.fillCmd]:null,this},i.beginLinearGradientFill=function(i,o,n,s,r,a){for(this._active&&this._newPath(),n=this._ctx.createLinearGradient(n,s,r,a),s=0,r=i.length;r>s;s++)n.addColorStop(o[s],i[s]);return this._fillInstructions=[new t(this._setProp,["fillStyle",n],!1),e.fillCmd],this},i.beginRadialGradientFill=function(i,o,n,s,r,a,l,h){for(this._active&&this._newPath(),n=this._ctx.createRadialGradient(n,s,r,a,l,h),s=0,r=i.length;r>s;s++)n.addColorStop(o[s],i[s]);return this._fillInstructions=[new t(this._setProp,["fillStyle",n],!1),e.fillCmd],this},i.beginBitmapFill=function(i,o,n){return this._active&&this._newPath(),i=this._ctx.createPattern(i,o||""),i=new t(this._setProp,["fillStyle",i],!1),this._fillInstructions=n?[i,new t(this._ctx.save,[],!1),new t(this._ctx.transform,[n.a,n.b,n.c,n.d,n.tx,n.ty],!1),e.fillCmd,new t(this._ctx.restore,[],!1)]:[i,e.fillCmd],this},i.endFill=function(){return this.beginFill()},i.setStrokeStyle=function(i,o,n,s,r){return this._active&&this._newPath(),this._strokeStyleInstructions=[new t(this._setProp,["lineWidth",null==i?"1":i],!1),new t(this._setProp,["lineCap",null==o?"butt":isNaN(o)?o:e.STROKE_CAPS_MAP[o]],!1),new t(this._setProp,["lineJoin",null==n?"miter":isNaN(n)?n:e.STROKE_JOINTS_MAP[n]],!1),new t(this._setProp,["miterLimit",null==s?"10":s],!1)],this._ignoreScaleStroke=r,this},i.beginStroke=function(e){return this._active&&this._newPath(),this._strokeInstructions=e?[new t(this._setProp,["strokeStyle",e],!1)]:null,this},i.beginLinearGradientStroke=function(e,i,o,n,s,r){for(this._active&&this._newPath(),o=this._ctx.createLinearGradient(o,n,s,r),n=0,s=e.length;s>n;n++)o.addColorStop(i[n],e[n]);return this._strokeInstructions=[new t(this._setProp,["strokeStyle",o],!1)],this},i.beginRadialGradientStroke=function(e,i,o,n,s,r,a,l){for(this._active&&this._newPath(),o=this._ctx.createRadialGradient(o,n,s,r,a,l),n=0,s=e.length;s>n;n++)o.addColorStop(i[n],e[n]);return this._strokeInstructions=[new t(this._setProp,["strokeStyle",o],!1)],this},i.beginBitmapStroke=function(e,i){this._active&&this._newPath();var o=this._ctx.createPattern(e,i||"");return this._strokeInstructions=[new t(this._setProp,["strokeStyle",o],!1)],this},i.endStroke=function(){return this.beginStroke(),this},i.curveTo=i.quadraticCurveTo,i.drawRect=i.rect,i.drawRoundRect=function(t,e,i,o,n){return this.drawRoundRectComplex(t,e,i,o,n,n,n,n),this},i.drawRoundRectComplex=function(e,i,o,n,s,r,a,l){var h=(n>o?o:n)/2,c=0,m=0,_=0,u=0;0>s&&(s*=c=-1),s>h&&(s=h),0>r&&(r*=m=-1),r>h&&(r=h),0>a&&(a*=_=-1),a>h&&(a=h),0>l&&(l*=u=-1),l>h&&(l=h),this._dirty=this._active=!0;var h=this._ctx.arcTo,p=this._ctx.lineTo;return this._activeInstructions.push(new t(this._ctx.moveTo,[e+o-r,i]),new t(h,[e+o+r*m,i-r*m,e+o,i+r,r]),new t(p,[e+o,i+n-a]),new t(h,[e+o+a*_,i+n+a*_,e+o-a,i+n,a]),new t(p,[e+l,i+n]),new t(h,[e-l*u,i+n+l*u,e,i+n-l,l]),new t(p,[e,i+s]),new t(h,[e-s*c,i-s*c,e+s,i,s]),new t(this._ctx.closePath)),this},i.drawCircle=function(t,e,i){return this.arc(t,e,i,0,2*Math.PI),this},i.drawEllipse=function(e,i,o,n){this._dirty=this._active=!0;var s=.5522848*(o/2),r=.5522848*(n/2),a=e+o,l=i+n;return o=e+o/2,n=i+n/2,this._activeInstructions.push(new t(this._ctx.moveTo,[e,n]),new t(this._ctx.bezierCurveTo,[e,n-r,o-s,i,o,i]),new t(this._ctx.bezierCurveTo,[o+s,i,a,n-r,a,n]),new t(this._ctx.bezierCurveTo,[a,n+r,o+s,l,o,l]),new t(this._ctx.bezierCurveTo,[o-s,l,e,n+r,e,n])),this},i.drawPolyStar=function(e,i,o,n,s,r){this._dirty=this._active=!0,null==s&&(s=0),s=1-s,r=null==r?0:r/(180/Math.PI);var a=Math.PI/n;this._activeInstructions.push(new t(this._ctx.moveTo,[e+Math.cos(r)*o,i+Math.sin(r)*o]));for(var l=0;n>l;l++)r+=a,1!=s&&this._activeInstructions.push(new t(this._ctx.lineTo,[e+Math.cos(r)*o*s,i+Math.sin(r)*o*s])),r+=a,this._activeInstructions.push(new t(this._ctx.lineTo,[e+Math.cos(r)*o,i+Math.sin(r)*o]));return this},i.decodePath=function(t){for(var i=[this.moveTo,this.lineTo,this.quadraticCurveTo,this.bezierCurveTo,this.closePath],o=[2,2,4,6,0],n=0,s=t.length,r=[],a=0,l=0,h=e.BASE_64;s>n;){var c=t.charAt(n),m=h[c],_=m>>3,u=i[_];if(!u||3&m)throw"bad path data (@"+n+"): "+c;for(c=o[_],_||(a=l=0),r.length=0,n++,m=(1&m>>2)+2,_=0;c>_;_++){var p=h[t.charAt(n)],y=p>>5?-1:1,p=(31&p)<<6|h[t.charAt(n+1)];3==m&&(p=p<<6|h[t.charAt(n+2)]),p=y*p/10,_%2?a=p+=a:l=p+=l,r[_]=p,n+=m}u.apply(this,r)}return this},i.clone=function(){var t=new e;return t._instructions=this._instructions.slice(),t._activeInstructions=this._activeInstructions.slice(),t._oldInstructions=this._oldInstructions.slice(),this._fillInstructions&&(t._fillInstructions=this._fillInstructions.slice()),this._strokeInstructions&&(t._strokeInstructions=this._strokeInstructions.slice()),this._strokeStyleInstructions&&(t._strokeStyleInstructions=this._strokeStyleInstructions.slice()),t._active=this._active,t._dirty=this._dirty,t},i.toString=function(){return"[Graphics]"},i.mt=i.moveTo,i.lt=i.lineTo,i.at=i.arcTo,i.bt=i.bezierCurveTo,i.qt=i.quadraticCurveTo,i.a=i.arc,i.r=i.rect,i.cp=i.closePath,i.c=i.clear,i.f=i.beginFill,i.lf=i.beginLinearGradientFill,i.rf=i.beginRadialGradientFill,i.bf=i.beginBitmapFill,i.ef=i.endFill,i.ss=i.setStrokeStyle,i.s=i.beginStroke,i.ls=i.beginLinearGradientStroke,i.rs=i.beginRadialGradientStroke,i.bs=i.beginBitmapStroke,i.es=i.endStroke,i.dr=i.drawRect,i.rr=i.drawRoundRect,i.rc=i.drawRoundRectComplex,i.dc=i.drawCircle,i.de=i.drawEllipse,i.dp=i.drawPolyStar,i.p=i.decodePath,i._updateInstructions=function(){this._instructions=this._oldInstructions.slice(),this._instructions.push(e.beginCmd),this._instructions.push.apply(this._instructions,this._activeInstructions),this._fillInstructions&&this._instructions.push.apply(this._instructions,this._fillInstructions),this._strokeInstructions&&(this._strokeStyleInstructions&&this._instructions.push.apply(this._instructions,this._strokeStyleInstructions),this._instructions.push.apply(this._instructions,this._strokeInstructions),this._ignoreScaleStroke?this._instructions.push(new t(this._ctx.save,[],!1),new t(this._ctx.setTransform,[1,0,0,1,0,0],!1),e.strokeCmd,new t(this._ctx.restore,[],!1)):this._instructions.push(e.strokeCmd))},i._newPath=function(){this._dirty&&this._updateInstructions(),this._oldInstructions=this._instructions,this._activeInstructions=[],this._active=this._dirty=!1},i._setProp=function(t,e){this[t]=e},createjs.Graphics=e}(),this.createjs=this.createjs||{},function(){var t=function(){this.initialize()},e=t.prototype;t.suppressCrossDomainErrors=!1,t._hitTestCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),t._hitTestCanvas.width=t._hitTestCanvas.height=1,t._hitTestContext=t._hitTestCanvas.getContext("2d"),t._nextCacheID=1,e.alpha=1,e.cacheCanvas=null,e.id=-1,e.mouseEnabled=!0,e.name=null,e.parent=null,e.regX=0,e.regY=0,e.rotation=0,e.scaleX=1,e.scaleY=1,e.skewX=0,e.skewY=0,e.shadow=null,e.visible=!0,e.x=0,e.y=0,e.compositeOperation=null,e.snapToPixel=!1,e.onPress=null,e.onClick=null,e.onDoubleClick=null,e.onMouseOver=null,e.onMouseOut=null,e.onTick=null,e.filters=null,e.cacheID=0,e.mask=null,e.hitArea=null,e.cursor=null,e.addEventListener=null,e.removeEventListener=null,e.removeAllEventListeners=null,e.dispatchEvent=null,e.hasEventListener=null,e._listeners=null,createjs.EventDispatcher.initialize(e),e._cacheOffsetX=0,e._cacheOffsetY=0,e._cacheScale=1,e._cacheDataURLID=0,e._cacheDataURL=null,e._matrix=null,e.initialize=function(){this.id=createjs.UID.get(),this._matrix=new createjs.Matrix2D},e.isVisible=function(){return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY)},e.draw=function(t,e){var i=this.cacheCanvas;if(e||!i)return!1;var o=this._cacheScale;return t.drawImage(i,this._cacheOffsetX,this._cacheOffsetY,i.width/o,i.height/o),!0},e.updateContext=function(t){var e,i=this.mask;i&&i.graphics&&!i.graphics.isEmpty()&&(e=i.getMatrix(i._matrix),t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty),i.graphics.drawAsPath(t),t.clip(),e.invert(),t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty)),e=this._matrix.identity().appendTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.regX,this.regY),createjs.Stage._snapToPixelEnabled&&this.snapToPixel?t.transform(e.a,e.b,e.c,e.d,0|e.tx+.5,0|e.ty+.5):t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.globalAlpha*=this.alpha,this.compositeOperation&&(t.globalCompositeOperation=this.compositeOperation),this.shadow&&this._applyShadow(t,this.shadow)},e.cache=function(t,e,i,o,n){n=n||1,this.cacheCanvas||(this.cacheCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),this.cacheCanvas.width=Math.ceil(i*n),this.cacheCanvas.height=Math.ceil(o*n),this._cacheOffsetX=t,this._cacheOffsetY=e,this._cacheScale=n||1,this.updateCache()},e.updateCache=function(e){var i=this.cacheCanvas,o=this._cacheScale,n=this._cacheOffsetX*o,s=this._cacheOffsetY*o;if(!i)throw"cache() must be called before updateCache()";var r=i.getContext("2d");r.save(),e||r.clearRect(0,0,i.width+1,i.height+1),r.globalCompositeOperation=e,r.setTransform(o,0,0,o,-n,-s),this.draw(r,!0),this._applyFilters(),r.restore(),this.cacheID=t._nextCacheID++},e.uncache=function(){this._cacheDataURL=this.cacheCanvas=null,this.cacheID=this._cacheOffsetX=this._cacheOffsetY=0,this._cacheScale=1},e.getCacheDataURL=function(){return this.cacheCanvas?(this.cacheID!=this._cacheDataURLID&&(this._cacheDataURL=this.cacheCanvas.toDataURL()),this._cacheDataURL):null},e.getStage=function(){for(var t=this;t.parent;)t=t.parent;return t instanceof createjs.Stage?t:null},e.localToGlobal=function(t,e){var i=this.getConcatenatedMatrix(this._matrix);return null==i?null:(i.append(1,0,0,1,t,e),new createjs.Point(i.tx,i.ty))},e.globalToLocal=function(t,e){var i=this.getConcatenatedMatrix(this._matrix);return null==i?null:(i.invert(),i.append(1,0,0,1,t,e),new createjs.Point(i.tx,i.ty))},e.localToLocal=function(t,e,i){return t=this.localToGlobal(t,e),i.globalToLocal(t.x,t.y)},e.setTransform=function(t,e,i,o,n,s,r,a,l){return this.x=t||0,this.y=e||0,this.scaleX=null==i?1:i,this.scaleY=null==o?1:o,this.rotation=n||0,this.skewX=s||0,this.skewY=r||0,this.regX=a||0,this.regY=l||0,this},e.getMatrix=function(t){return(t?t.identity():new createjs.Matrix2D).appendTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.regX,this.regY).appendProperties(this.alpha,this.shadow,this.compositeOperation)},e.getConcatenatedMatrix=function(t){t?t.identity():t=new createjs.Matrix2D;for(var e=this;null!=e;)t.prependTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY).prependProperties(e.alpha,e.shadow,e.compositeOperation),e=e.parent;return t},e.hitTest=function(e,i){var o=t._hitTestContext;o.setTransform(1,0,0,1,-e,-i),this.draw(o);var n=this._testHit(o);return o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,2,2),n},e.set=function(t){for(var e in t)this[e]=t[e];return this},e.clone=function(){var e=new t;return this.cloneProps(e),e},e.toString=function(){return"[DisplayObject (name="+this.name+")]"},e.cloneProps=function(t){t.alpha=this.alpha,t.name=this.name,t.regX=this.regX,t.regY=this.regY,t.rotation=this.rotation,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.shadow=this.shadow,t.skewX=this.skewX,t.skewY=this.skewY,t.visible=this.visible,t.x=this.x,t.y=this.y,t.mouseEnabled=this.mouseEnabled,t.compositeOperation=this.compositeOperation,this.cacheCanvas&&(t.cacheCanvas=this.cacheCanvas.cloneNode(!0),t.cacheCanvas.getContext("2d").putImageData(this.cacheCanvas.getContext("2d").getImageData(0,0,this.cacheCanvas.width,this.cacheCanvas.height),0,0))},e._applyShadow=function(t,e){e=e||Shadow.identity,t.shadowColor=e.color,t.shadowOffsetX=e.offsetX,t.shadowOffsetY=e.offsetY,t.shadowBlur=e.blur},e._tick=function(t){this.onTick&&this.onTick.apply(this,t);var e=this._listeners;e&&e.tick&&this.dispatchEvent({type:"tick",params:t})},e._testHit=function(e){try{var i=1<e.getImageData(0,0,1,1).data[3]}catch(o){if(!t.suppressCrossDomainErrors)throw"An error has occurred. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images."}return i},e._applyFilters=function(){if(this.filters&&0!=this.filters.length&&this.cacheCanvas)for(var t=this.filters.length,e=this.cacheCanvas.getContext("2d"),i=this.cacheCanvas.width,o=this.cacheCanvas.height,n=0;t>n;n++)this.filters[n].applyFilter(e,0,0,i,o)},e._hasMouseHandler=function(t){var e=this._listeners;return!!(1&t&&(this.onPress||this.onClick||this.onDoubleClick||e&&(this.hasEventListener("mousedown")||this.hasEventListener("click")||this.hasEventListener("dblclick")))||2&t&&(this.onMouseOver||this.onMouseOut||this.cursor||e&&(this.hasEventListener("mouseover")||this.hasEventListener("mouseout"))))},createjs.DisplayObject=t}(),this.createjs=this.createjs||{},function(){var t=function(){this.initialize()},e=t.prototype=new createjs.DisplayObject;e.children=null,e.DisplayObject_initialize=e.initialize,e.initialize=function(){this.DisplayObject_initialize(),this.children=[]},e.isVisible=function(){var t=this.cacheCanvas||this.children.length;return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&t)},e.DisplayObject_draw=e.draw,e.draw=function(t,e){if(this.DisplayObject_draw(t,e))return!0;for(var i=this.children.slice(0),o=0,n=i.length;n>o;o++){var s=i[o];s.isVisible()&&(t.save(),s.updateContext(t),s.draw(t),t.restore())}return!0},e.addChild=function(t){if(null==t)return t;var e=arguments.length;if(e>1){for(var i=0;e>i;i++)this.addChild(arguments[i]);return arguments[e-1]}return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t),t},e.addChildAt=function(t,e){var i=arguments.length,o=arguments[i-1];if(0>o||o>this.children.length)return arguments[i-2];if(i>2){for(var n=0;i-1>n;n++)this.addChildAt(arguments[n],o+n);return arguments[i-2]}return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),t},e.removeChild=function(t){var e=arguments.length;if(e>1){for(var i=!0,o=0;e>o;o++)i=i&&this.removeChild(arguments[o]);return i}return this.removeChildAt(this.children.indexOf(t))},e.removeChildAt=function(t){var e=arguments.length;if(e>1){for(var i=[],o=0;e>o;o++)i[o]=arguments[o];
i.sort(function(t,e){return e-t});for(var n=!0,o=0;e>o;o++)n=n&&this.removeChildAt(i[o]);return n}return 0>t||t>this.children.length-1?!1:((e=this.children[t])&&(e.parent=null),this.children.splice(t,1),!0)},e.removeAllChildren=function(){for(var t=this.children;t.length;)t.pop().parent=null},e.getChildAt=function(t){return this.children[t]},e.getChildByName=function(t){for(var e=this.children,i=0,o=e.length;o>i;i++)if(e[i].name==t)return e[i];return null},e.sortChildren=function(t){this.children.sort(t)},e.getChildIndex=function(t){return this.children.indexOf(t)},e.getNumChildren=function(){return this.children.length},e.swapChildrenAt=function(t,e){var i=this.children,o=i[t],n=i[e];o&&n&&(i[t]=n,i[e]=o)},e.swapChildren=function(t,e){for(var i,o,n=this.children,s=0,r=n.length;r>s&&(n[s]==t&&(i=s),n[s]==e&&(o=s),!(null!=i&&null!=o));s++);s!=r&&(n[i]=e,n[o]=t)},e.setChildIndex=function(t,e){var i=this.children,o=i.length;if(!(t.parent!=this||0>e||e>=o)){for(var n=0;o>n&&i[n]!=t;n++);n==o||n==e||(i.splice(n,1),n>e&&e--,i.splice(e,0,t))}},e.contains=function(t){for(;t;){if(t==this)return!0;t=t.parent}return!1},e.hitTest=function(t,e){return null!=this.getObjectUnderPoint(t,e)},e.getObjectsUnderPoint=function(t,e){var i=[],o=this.localToGlobal(t,e);return this._getObjectsUnderPoint(o.x,o.y,i),i},e.getObjectUnderPoint=function(t,e){var i=this.localToGlobal(t,e);return this._getObjectsUnderPoint(i.x,i.y)},e.clone=function(e){var i=new t;if(this.cloneProps(i),e)for(var o=i.children=[],n=0,s=this.children.length;s>n;n++){var r=this.children[n].clone(e);r.parent=i,o.push(r)}return i},e.toString=function(){return"[Container (name="+this.name+")]"},e.DisplayObject__tick=e._tick,e._tick=function(t){for(var e=this.children.length-1;e>=0;e--){var i=this.children[e];i._tick&&i._tick(t)}this.DisplayObject__tick(t)},e._getObjectsUnderPoint=function(e,i,o,n){var s=createjs.DisplayObject._hitTestContext,r=this._matrix,a=this._hasMouseHandler(n);if(!this.hitArea&&this.cacheCanvas&&a&&(this.getConcatenatedMatrix(r),s.setTransform(r.a,r.b,r.c,r.d,r.tx-e,r.ty-i),s.globalAlpha=r.alpha,this.draw(s),this._testHit(s)))return s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,2,2),this;for(var l=this.children.length-1;l>=0;l--){var h=this.children[l],c=h.hitArea;if(h.visible&&(c||h.isVisible())&&(!n||h.mouseEnabled)){var m=n&&h._hasMouseHandler(n);if(!(h instanceof t)||c&&m){if((!n||a||m)&&(h.getConcatenatedMatrix(r),c&&(r.appendTransform(c.x,c.y,c.scaleX,c.scaleY,c.rotation,c.skewX,c.skewY,c.regX,c.regY),r.alpha=c.alpha),s.globalAlpha=r.alpha,s.setTransform(r.a,r.b,r.c,r.d,r.tx-e,r.ty-i),(c||h).draw(s),this._testHit(s))){if(s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,2,2),a)return this;if(!o)return h;o.push(h)}}else if(a){if(h=h._getObjectsUnderPoint(e,i))return this}else if(h=h._getObjectsUnderPoint(e,i,o,n),!o&&h)return h}}return null},createjs.Container=t}(),this.createjs=this.createjs||{},function(){var t=function(t){this.initialize(t)},e=t.prototype=new createjs.Container;t._snapToPixelEnabled=!1,e.autoClear=!0,e.canvas=null,e.mouseX=0,e.mouseY=0,e.onMouseMove=null,e.onMouseUp=null,e.onMouseDown=null,e.snapToPixelEnabled=!1,e.mouseInBounds=!1,e.tickOnUpdate=!0,e.mouseMoveOutside=!1,e._pointerData=null,e._pointerCount=0,e._primaryPointerID=null,e._mouseOverIntervalID=null,e.Container_initialize=e.initialize,e.initialize=function(t){this.Container_initialize(),this.canvas="string"==typeof t?document.getElementById(t):t,this._pointerData={},this.enableDOMEvents(!0)},e.update=function(){if(this.canvas){this.autoClear&&this.clear(),t._snapToPixelEnabled=this.snapToPixelEnabled,this.tickOnUpdate&&this._tick(arguments.length?arguments:null);var e=this.canvas.getContext("2d");e.save(),this.updateContext(e),this.draw(e,!1),e.restore()}},e.tick=e.update,e.handleEvent=function(t){"tick"==t.type&&this.update(t)},e.clear=function(){if(this.canvas){var t=this.canvas.getContext("2d");t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)}},e.toDataURL=function(t,e){e||(e="image/png");var i,o=this.canvas.getContext("2d"),n=this.canvas.width,s=this.canvas.height;if(t){i=o.getImageData(0,0,n,s);var r=o.globalCompositeOperation;o.globalCompositeOperation="destination-over",o.fillStyle=t,o.fillRect(0,0,n,s)}var a=this.canvas.toDataURL(e);return t&&(o.clearRect(0,0,n+1,s+1),o.putImageData(i,0,0),o.globalCompositeOperation=r),a},e.enableMouseOver=function(t){if(this._mouseOverIntervalID&&(clearInterval(this._mouseOverIntervalID),this._mouseOverIntervalID=null),null==t)t=20;else if(0>=t)return;var e=this;this._mouseOverIntervalID=setInterval(function(){e._testMouseOver()},1e3/Math.min(50,t))},e.enableDOMEvents=function(t){null==t&&(t=!0);var e,i=this._eventListeners;if(!t&&i){for(e in i)t=i[e],t.t.removeEventListener(e,t.f);this._eventListeners=null}else if(t&&!i&&this.canvas){t=window.addEventListener?window:document;var o=this,i=this._eventListeners={};i.mouseup={t:t,f:function(t){o._handleMouseUp(t)}},i.mousemove={t:t,f:function(t){o._handleMouseMove(t)}},i.dblclick={t:t,f:function(t){o._handleDoubleClick(t)}},i.mousedown={t:this.canvas,f:function(t){o._handleMouseDown(t)}};for(e in i)t=i[e],t.t.addEventListener(e,t.f)}},e.clone=function(){var e=new t(null);return this.cloneProps(e),e},e.toString=function(){return"[Stage (name="+this.name+")]"},e._getPointerData=function(t){var e=this._pointerData[t];return e||(e=this._pointerData[t]={x:0,y:0},null!=this._primaryPointerID&&-1!=this._primaryPointerID)||(this._primaryPointerID=t),e},e._handleMouseMove=function(t){t||(t=window.event),this._handlePointerMove(-1,t,t.pageX,t.pageY)},e._handlePointerMove=function(t,e,i,o){if(this.canvas){var n=this._getPointerData(t),s=n.inBounds;this._updatePointerPosition(t,i,o),(s||n.inBounds||this.mouseMoveOutside)&&((this.onMouseMove||this.hasEventListener("stagemousemove"))&&(i=new createjs.MouseEvent("stagemousemove",n.x,n.y,this,e,t,t==this._primaryPointerID,n.rawX,n.rawY),this.onMouseMove&&this.onMouseMove(i),this.dispatchEvent(i)),(o=n.event)&&(o.onMouseMove||o.hasEventListener("mousemove"))&&(i=new createjs.MouseEvent("mousemove",n.x,n.y,o.target,e,t,t==this._primaryPointerID,n.rawX,n.rawY),o.onMouseMove&&o.onMouseMove(i),o.dispatchEvent(i,o.target)))}},e._updatePointerPosition=function(t,e,i){var o=this._getElementRect(this.canvas);e-=o.left,i-=o.top;var n=this.canvas.width,s=this.canvas.height;e/=(o.right-o.left)/n,i/=(o.bottom-o.top)/s,o=this._getPointerData(t),(o.inBounds=e>=0&&i>=0&&n-1>=e&&s-1>=i)?(o.x=e,o.y=i):this.mouseMoveOutside&&(o.x=0>e?0:e>n-1?n-1:e,o.y=0>i?0:i>s-1?s-1:i),o.rawX=e,o.rawY=i,t==this._primaryPointerID&&(this.mouseX=o.x,this.mouseY=o.y,this.mouseInBounds=o.inBounds)},e._getElementRect=function(t){var e;try{e=t.getBoundingClientRect()}catch(i){e={top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight}}var o=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||document.body.clientLeft||0),n=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||document.body.clientTop||0),s=window.getComputedStyle?getComputedStyle(t):t.currentStyle;t=parseInt(s.paddingLeft)+parseInt(s.borderLeftWidth);var r=parseInt(s.paddingTop)+parseInt(s.borderTopWidth),a=parseInt(s.paddingRight)+parseInt(s.borderRightWidth),s=parseInt(s.paddingBottom)+parseInt(s.borderBottomWidth);return{left:e.left+o+t,right:e.right+o-a,top:e.top+n+r,bottom:e.bottom+n-s}},e._handleMouseUp=function(t){this._handlePointerUp(-1,t,!1)},e._handlePointerUp=function(t,e,i){var o,n=this._getPointerData(t);(this.onMouseMove||this.hasEventListener("stagemouseup"))&&(o=new createjs.MouseEvent("stagemouseup",n.x,n.y,this,e,t,t==this._primaryPointerID,n.rawX,n.rawY),this.onMouseUp&&this.onMouseUp(o),this.dispatchEvent(o));var s=n.event;s&&(s.onMouseUp||s.hasEventListener("mouseup"))&&(o=new createjs.MouseEvent("mouseup",n.x,n.y,s.target,e,t,t==this._primaryPointerID,n.rawX,n.rawY),s.onMouseUp&&s.onMouseUp(o),s.dispatchEvent(o,s.target)),(s=n.target)&&(s.onClick||s.hasEventListener("click"))&&this._getObjectsUnderPoint(n.x,n.y,null,!0,this._mouseOverIntervalID?3:1)==s&&(o=new createjs.MouseEvent("click",n.x,n.y,s,e,t,t==this._primaryPointerID,n.rawX,n.rawY),s.onClick&&s.onClick(o),s.dispatchEvent(o)),i?(t==this._primaryPointerID&&(this._primaryPointerID=null),delete this._pointerData[t]):n.event=n.target=null},e._handleMouseDown=function(t){this._handlePointerDown(-1,t,!1)},e._handlePointerDown=function(t,e,i,o){var n=this._getPointerData(t);null!=o&&this._updatePointerPosition(t,i,o),(this.onMouseDown||this.hasEventListener("stagemousedown"))&&(i=new createjs.MouseEvent("stagemousedown",n.x,n.y,this,e,t,t==this._primaryPointerID,n.rawX,n.rawY),this.onMouseDown&&this.onMouseDown(i),this.dispatchEvent(i)),(o=this._getObjectsUnderPoint(n.x,n.y,null,this._mouseOverIntervalID?3:1))&&(n.target=o,(o.onPress||o.hasEventListener("mousedown"))&&(i=new createjs.MouseEvent("mousedown",n.x,n.y,o,e,t,t==this._primaryPointerID,n.rawX,n.rawY),o.onPress&&o.onPress(i),o.dispatchEvent(i),(i.onMouseMove||i.onMouseUp||i.hasEventListener("mousemove")||i.hasEventListener("mouseup"))&&(n.event=i)))},e._testMouseOver=function(){if(-1==this._primaryPointerID&&(this.mouseX!=this._mouseOverX||this.mouseY!=this._mouseOverY||!this.mouseInBounds)){var t=null;this.mouseInBounds&&(t=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,3),this._mouseOverX=this.mouseX,this._mouseOverY=this.mouseY);var e=this._mouseOverTarget;if(e!=t){var i=this._getPointerData(-1);if(e&&(e.onMouseOut||e.hasEventListener("mouseout"))){var o=new createjs.MouseEvent("mouseout",i.x,i.y,e,null,-1,i.rawX,i.rawY);e.onMouseOut&&e.onMouseOut(o),e.dispatchEvent(o)}e&&(this.canvas.style.cursor=""),t&&(t.onMouseOver||t.hasEventListener("mouseover"))&&(o=new createjs.MouseEvent("mouseover",i.x,i.y,t,null,-1,i.rawX,i.rawY),t.onMouseOver&&t.onMouseOver(o),t.dispatchEvent(o)),t&&(this.canvas.style.cursor=t.cursor||""),this._mouseOverTarget=t}}},e._handleDoubleClick=function(t){var e=this._getPointerData(-1),i=this._getObjectsUnderPoint(e.x,e.y,null,this._mouseOverIntervalID?3:1);i&&(i.onDoubleClick||i.hasEventListener("dblclick"))&&(evt=new createjs.MouseEvent("dblclick",e.x,e.y,i,t,-1,!0,e.rawX,e.rawY),i.onDoubleClick&&i.onDoubleClick(evt),i.dispatchEvent(evt))},createjs.Stage=t}(),this.createjs=this.createjs||{},function(){var t=function(t){this.initialize(t)},e=t.prototype=new createjs.DisplayObject;e.image=null,e.snapToPixel=!0,e.sourceRect=null,e.DisplayObject_initialize=e.initialize,e.initialize=function(t){this.DisplayObject_initialize(),"string"==typeof t?(this.image=new Image,this.image.src=t):this.image=t},e.isVisible=function(){var t=this.cacheCanvas||this.image&&(this.image.complete||this.image.getContext||2<=this.image.readyState);return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&t)},e.DisplayObject_draw=e.draw,e.draw=function(t,e){if(this.DisplayObject_draw(t,e))return!0;var i=this.sourceRect;return i?t.drawImage(this.image,i.x,i.y,i.width,i.height,0,0,i.width,i.height):t.drawImage(this.image,0,0),!0},e.clone=function(){var e=new t(this.image);return this.sourceRect&&(e.sourceRect=this.sourceRect.clone()),this.cloneProps(e),e},e.toString=function(){return"[Bitmap (name="+this.name+")]"},createjs.Bitmap=t}(),this.createjs=this.createjs||{},function(){var t=function(t){this.initialize(t)},e=t.prototype=new createjs.DisplayObject;e.onAnimationEnd=null,e.currentFrame=-1,e.currentAnimation=null,e.paused=!0,e.spriteSheet=null,e.snapToPixel=!0,e.offset=0,e.currentAnimationFrame=0,e.addEventListener=null,e.removeEventListener=null,e.removeAllEventListeners=null,e.dispatchEvent=null,e.hasEventListener=null,e._listeners=null,createjs.EventDispatcher.initialize(e),e._advanceCount=0,e._animation=null,e.DisplayObject_initialize=e.initialize,e.initialize=function(t){this.DisplayObject_initialize(),this.spriteSheet=t},e.isVisible=function(){var t=this.cacheCanvas||this.spriteSheet.complete&&0<=this.currentFrame;return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&t)},e.DisplayObject_draw=e.draw,e.draw=function(t,e){if(this.DisplayObject_draw(t,e))return!0;this._normalizeFrame();var i=this.spriteSheet.getFrame(this.currentFrame);if(i){var o=i.rect;return t.drawImage(i.image,o.x,o.y,o.width,o.height,-i.regX,-i.regY,o.width,o.height),!0}},e.play=function(){this.paused=!1},e.stop=function(){this.paused=!0},e.gotoAndPlay=function(t){this.paused=!1,this._goto(t)},e.gotoAndStop=function(t){this.paused=!0,this._goto(t)},e.advance=function(){this._animation?this.currentAnimationFrame++:this.currentFrame++,this._normalizeFrame()},e.getBounds=function(){return this.spriteSheet.getFrameBounds(this.currentFrame)},e.clone=function(){var e=new t(this.spriteSheet);return this.cloneProps(e),e},e.toString=function(){return"[BitmapAnimation (name="+this.name+")]"},e.DisplayObject__tick=e._tick,e._tick=function(t){var e=this._animation?this._animation.frequency:1;!this.paused&&0==(++this._advanceCount+this.offset)%e&&this.advance(),this.DisplayObject__tick(t)},e._normalizeFrame=function(){var t,e=this._animation,i=this.currentFrame,o=this.paused;if(e)if(t=e.frames.length,this.currentAnimationFrame>=t){var n=e.next;this._dispatchAnimationEnd(e,i,o,n,t-1)||(n?this._goto(n):(this.paused=!0,this.currentAnimationFrame=e.frames.length-1,this.currentFrame=e.frames[this.currentAnimationFrame]))}else this.currentFrame=e.frames[this.currentAnimationFrame];else t=this.spriteSheet.getNumFrames(),i>=t&&!this._dispatchAnimationEnd(e,i,o,t-1)&&(this.currentFrame=0)},e._dispatchAnimationEnd=function(t,e,i,o,n){var s=t?t.name:null;return this.onAnimationEnd&&this.onAnimationEnd(this,s,o),this.dispatchEvent({type:"animationend",name:s,next:o}),!i&&this.paused&&(this.currentAnimationFrame=n),this.paused!=i||this._animation!=t||this.currentFrame!=e},e.DisplayObject_cloneProps=e.cloneProps,e.cloneProps=function(t){this.DisplayObject_cloneProps(t),t.onAnimationEnd=this.onAnimationEnd,t.currentFrame=this.currentFrame,t.currentAnimation=this.currentAnimation,t.paused=this.paused,t.offset=this.offset,t._animation=this._animation,t.currentAnimationFrame=this.currentAnimationFrame},e._goto=function(t){if(isNaN(t)){var e=this.spriteSheet.getAnimation(t);e&&(this.currentAnimationFrame=0,this._animation=e,this.currentAnimation=t,this._normalizeFrame())}else this.currentAnimation=this._animation=null,this.currentFrame=t},createjs.BitmapAnimation=t}(),this.createjs=this.createjs||{},function(){var t=function(t){this.initialize(t)},e=t.prototype=new createjs.DisplayObject;e.graphics=null,e.DisplayObject_initialize=e.initialize,e.initialize=function(t){this.DisplayObject_initialize(),this.graphics=t?t:new createjs.Graphics},e.isVisible=function(){var t=this.cacheCanvas||this.graphics&&!this.graphics.isEmpty();return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&t)},e.DisplayObject_draw=e.draw,e.draw=function(t,e){return this.DisplayObject_draw(t,e)?!0:(this.graphics.draw(t),!0)},e.clone=function(e){return e=new t(e&&this.graphics?this.graphics.clone():this.graphics),this.cloneProps(e),e},e.toString=function(){return"[Shape (name="+this.name+")]"},createjs.Shape=t}(),this.createjs=this.createjs||{},function(){var t=function(t,e,i){this.initialize(t,e,i)},e=t.prototype=new createjs.DisplayObject;t._workingContext=(createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")).getContext("2d"),e.text="",e.font=null,e.color="#000",e.textAlign="left",e.textBaseline="top",e.maxWidth=null,e.outline=!1,e.lineHeight=0,e.lineWidth=null,e.DisplayObject_initialize=e.initialize,e.initialize=function(t,e,i){this.DisplayObject_initialize(),this.text=t,this.font=e,this.color=i?i:"#000"},e.isVisible=function(){var t=this.cacheCanvas||null!=this.text&&""!==this.text;return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&t)},e.DisplayObject_draw=e.draw,e.draw=function(t,e){return this.DisplayObject_draw(t,e)?!0:(this.outline?t.strokeStyle=this.color:t.fillStyle=this.color,t.font=this.font,t.textAlign=this.textAlign||"start",t.textBaseline=this.textBaseline||"alphabetic",this._drawText(t),!0)},e.getMeasuredWidth=function(){return this._getWorkingContext().measureText(this.text).width},e.getMeasuredLineHeight=function(){return 1.2*this._getWorkingContext().measureText("M").width},e.getMeasuredHeight=function(){return this._drawText()*(this.lineHeight||this.getMeasuredLineHeight())},e.clone=function(){var e=new t(this.text,this.font,this.color);return this.cloneProps(e),e},e.toString=function(){return"[Text (text="+(20<this.text.length?this.text.substr(0,17)+"...":this.text)+")]"},e.DisplayObject_cloneProps=e.cloneProps,e.cloneProps=function(t){this.DisplayObject_cloneProps(t),t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.maxWidth=this.maxWidth,t.outline=this.outline,t.lineHeight=this.lineHeight,t.lineWidth=this.lineWidth},e._getWorkingContext=function(){var e=t._workingContext;return e.font=this.font,e.textAlign=this.textAlign||"start",e.textBaseline=this.textBaseline||"alphabetic",e},e._drawText=function(t){var e=!!t;e||(t=this._getWorkingContext());for(var i=String(this.text).split(/(?:\r\n|\r|\n)/),o=this.lineHeight||this.getMeasuredLineHeight(),n=0,s=0,r=i.length;r>s;s++){var a=t.measureText(i[s]).width;if(null==this.lineWidth||a<this.lineWidth)e&&this._drawTextLine(t,i[s],n*o);else{for(var a=i[s].split(/(\s)/),l=a[0],h=1,c=a.length;c>h;h+=2)t.measureText(l+a[h]+a[h+1]).width>this.lineWidth?(e&&this._drawTextLine(t,l,n*o),n++,l=a[h+1]):l+=a[h]+a[h+1];e&&this._drawTextLine(t,l,n*o)}n++}return n},e._drawTextLine=function(t,e,i){this.outline?t.strokeText(e,0,i,this.maxWidth||65535):t.fillText(e,0,i,this.maxWidth||65535)},createjs.Text=t}(),this.createjs=this.createjs||{},function(){var t=function(){throw"SpriteSheetUtils cannot be instantiated"};t._workingCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),t._workingContext=t._workingCanvas.getContext("2d"),t.addFlippedFrames=function(e,i,o,n){if(i||o||n){var s=0;i&&t._flip(e,++s,!0,!1),o&&t._flip(e,++s,!1,!0),n&&t._flip(e,++s,!0,!0)}},t.extractFrame=function(e,i){isNaN(i)&&(i=e.getAnimation(i).frames[0]);var o=e.getFrame(i);if(!o)return null;var n=o.rect,s=t._workingCanvas;return s.width=n.width,s.height=n.height,t._workingContext.drawImage(o.image,n.x,n.y,n.width,n.height,0,0,n.width,n.height),o=new Image,o.src=s.toDataURL("image/png"),o},t.mergeAlpha=function(t,e,i){i||(i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),i.width=Math.max(e.width,t.width),i.height=Math.max(e.height,t.height);var o=i.getContext("2d");return o.save(),o.drawImage(t,0,0),o.globalCompositeOperation="destination-in",o.drawImage(e,0,0),o.restore(),i},t._flip=function(e,i,o,n){for(var s=e._images,r=t._workingCanvas,a=t._workingContext,l=s.length/i,h=0;l>h;h++){var c=s[h];c.__tmp=h,a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,r.width+1,r.height+1),r.width=c.width,r.height=c.height,a.setTransform(o?-1:1,0,0,n?-1:1,o?c.width:0,n?c.height:0),a.drawImage(c,0,0);var m=new Image;m.src=r.toDataURL("image/png"),m.width=c.width,m.height=c.height,s.push(m)}for(a=e._frames,r=a.length/i,h=0;r>h;h++){var c=a[h],_=c.rect.clone(),m=s[c.image.__tmp+l*i],u={image:m,rect:_,regX:c.regX,regY:c.regY};o&&(_.x=m.width-_.x-_.width,u.regX=_.width-c.regX),n&&(_.y=m.height-_.y-_.height,u.regY=_.height-c.regY),a.push(u)}for(o="_"+(o?"h":"")+(n?"v":""),n=e._animations,e=e._data,s=n.length/i,h=0;s>h;h++){for(a=n[h],c=e[a],l={name:a+o,frequency:c.frequency,next:c.next,frames:[]},c.next&&(l.next+=o),a=c.frames,c=0,m=a.length;m>c;c++)l.frames.push(a[c]+r*i);e[l.name]=l,n.push(l.name)}},createjs.SpriteSheetUtils=t}(),this.createjs=this.createjs||{},function(){var t=function(){this.initialize()},e=t.prototype;t.ERR_DIMENSIONS="frame dimensions exceed max spritesheet dimensions",t.ERR_RUNNING="a build is already running",e.maxWidth=2048,e.maxHeight=2048,e.spriteSheet=null,e.scale=1,e.padding=1,e.timeSlice=.3,e.progress=-1,e.onComplete=null,e.onProgress=null,e.addEventListener=null,e.removeEventListener=null,e.removeAllEventListeners=null,e.dispatchEvent=null,e.hasEventListener=null,e._listeners=null,createjs.EventDispatcher.initialize(e),e._frames=null,e._animations=null,e._data=null,e._nextFrameIndex=0,e._index=0,e._timerID=null,e._scale=1,e.initialize=function(){this._frames=[],this._animations={}},e.addFrame=function(e,i,o,n,s,r){if(this._data)throw t.ERR_RUNNING;return i=i||e.bounds||e.nominalBounds,!i&&e.getBounds&&(i=e.getBounds()),i?(o=o||1,this._frames.push({source:e,sourceRect:i,scale:o,funct:n,params:s,scope:r,index:this._frames.length,height:i.height*o})-1):null},e.addAnimation=function(e,i,o,n){if(this._data)throw t.ERR_RUNNING;this._animations[e]={frames:i,next:o,frequency:n}},e.addMovieClip=function(e,i,o){if(this._data)throw t.ERR_RUNNING;var n=e.frameBounds,s=i||e.bounds||e.nominalBounds;if(!s&&e.getBounds&&(s=e.getBounds()),!s&&!n)return null;i=this._frames.length;for(var r=e.timeline.duration,a=0;r>a;a++)this.addFrame(e,n&&n[a]?n[a]:s,o,function(t){var e=this.actionsEnabled;this.actionsEnabled=!1,this.gotoAndStop(t),this.actionsEnabled=e},[a],e);a=e.timeline._labels,e=[];for(var l in a)e.push({index:a[l],label:l});if(e.length)for(e.sort(function(t,e){return t.index-e.index}),a=0,l=e.length;l>a;a++){o=e[a].label;for(var n=i+(a==l-1?r:e[a+1].index),s=[],h=i+e[a].index;n>h;h++)s.push(h);this.addAnimation(o,s,!0)}},e.build=function(){if(this._data)throw t.ERR_RUNNING;for(this._startBuild();this._drawNext(););return this._endBuild(),this.spriteSheet},e.buildAsync=function(e){if(this._data)throw t.ERR_RUNNING;this.timeSlice=e,this._startBuild();var i=this;this._timerID=setTimeout(function(){i._run()},50-50*Math.max(.01,Math.min(.99,this.timeSlice||.3)))},e.stopAsync=function(){clearTimeout(this._timerID),this._data=null},e.clone=function(){throw"SpriteSheetBuilder cannot be cloned."},e.toString=function(){return"[SpriteSheetBuilder]"},e._startBuild=function(){var e=this.padding||0;this.progress=0,this.spriteSheet=null,this._index=0,this._scale=this.scale;var i=[];this._data={images:[],frames:i,animations:this._animations};var o=this._frames.slice();if(o.sort(function(t,e){return t.height<=e.height?-1:1}),o[o.length-1].height+2*e>this.maxHeight)throw t.ERR_DIMENSIONS;for(var n=0,s=0,r=0;o.length;){var a=this._fillRow(o,n,r,i,e);if(a.w>s&&(s=a.w),n+=a.h,!a.h||!o.length){var l=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");l.width=this._getSize(s,this.maxWidth),l.height=this._getSize(n,this.maxHeight),this._data.images[r]=l,a.h||(s=n=0,r++)}}},e._getSize=function(t,e){for(var i=4;Math.pow(2,++i)<t;);return Math.min(e,Math.pow(2,i))},e._fillRow=function(e,i,o,n,s){var r=this.maxWidth,a=this.maxHeight;i+=s;for(var a=a-i,l=s,h=0,c=e.length-1;c>=0;c--){var m=e[c],_=this._scale*m.scale,u=m.sourceRect,p=m.source,y=Math.floor(_*u.x-s),x=Math.floor(_*u.y-s),d=Math.ceil(_*u.height+2*s),u=Math.ceil(_*u.width+2*s);if(u>r)throw t.ERR_DIMENSIONS;d>a||l+u>r||(m.img=o,m.rect=new createjs.Rectangle(l,i,u,d),h=h||d,e.splice(c,1),n[m.index]=[l,i,u,d,o,Math.round(-y+_*p.regX-s),Math.round(-x+_*p.regY-s)],l+=u)}return{w:l,h:h}},e._endBuild=function(){this.spriteSheet=new createjs.SpriteSheet(this._data),this._data=null,this.progress=1,this.onComplete&&this.onComplete(this),this.dispatchEvent("complete")},e._run=function(){for(var t=50*Math.max(.01,Math.min(.99,this.timeSlice||.3)),e=(new Date).getTime()+t,i=!1;e>(new Date).getTime();)if(!this._drawNext()){i=!0;break}if(i)this._endBuild();else{var o=this;this._timerID=setTimeout(function(){o._run()},50-t)}t=this.progress=this._index/this._frames.length,this.onProgress&&this.onProgress(this,t),this.dispatchEvent({type:"progress",progress:t})},e._drawNext=function(){var t=this._frames[this._index],e=t.scale*this._scale,i=t.rect,o=t.sourceRect,n=this._data.images[t.img].getContext("2d");return t.funct&&t.funct.apply(t.scope,t.params),n.save(),n.beginPath(),n.rect(i.x,i.y,i.width,i.height),n.clip(),n.translate(Math.ceil(i.x-o.x*e),Math.ceil(i.y-o.y*e)),n.scale(e,e),t.source.draw(n),n.restore(),++this._index<this._frames.length},createjs.SpriteSheetBuilder=t}(),this.createjs=this.createjs||{},function(){var t=function(t){this.initialize(t)},e=t.prototype=new createjs.DisplayObject;e.htmlElement=null,e._oldMtx=null,e.DisplayObject_initialize=e.initialize,e.initialize=function(t){"string"==typeof t&&(t=document.getElementById(t)),this.DisplayObject_initialize(),this.mouseEnabled=!1,this.htmlElement=t,t=t.style,t.position="absolute",t.transformOrigin=t.WebkitTransformOrigin=t.msTransformOrigin=t.MozTransformOrigin=t.OTransformOrigin="0% 0%"},e.isVisible=function(){return null!=this.htmlElement},e.draw=function(){if(null!=this.htmlElement){var t=this.getConcatenatedMatrix(this._matrix),e=this.htmlElement.style;if(!this.visible)return!0;e.visibility="visible";var i=this._oldMtx||{};return i.alpha!=t.alpha&&(e.opacity=""+t.alpha,i.alpha=t.alpha),(i.tx!=t.tx||i.ty!=t.ty||i.a!=t.a||i.b!=t.b||i.c!=t.c||i.d!=t.d)&&(e.transform=e.WebkitTransform=e.OTransform=e.msTransform=["matrix("+t.a,t.b,t.c,t.d,0|t.tx+.5,(0|t.ty+.5)+")"].join(),e.MozTransform=["matrix("+t.a,t.b,t.c,t.d,(0|t.tx+.5)+"px",(0|t.ty+.5)+"px)"].join(),this._oldMtx=t.clone()),!0}},e.cache=function(){},e.uncache=function(){},e.updateCache=function(){},e.hitTest=function(){},e.localToGlobal=function(){},e.globalToLocal=function(){},e.localToLocal=function(){},e.clone=function(){throw"DOMElement cannot be cloned."},e.toString=function(){return"[DOMElement (name="+this.name+")]"},e.DisplayObject__tick=e._tick,e._tick=function(t){this.htmlElement.style.visibility="hidden",this.DisplayObject__tick(t)},createjs.DOMElement=t}(),this.createjs=this.createjs||{},function(){var t=function(){this.initialize()},e=t.prototype;e.initialize=function(){},e.getBounds=function(){return new createjs.Rectangle(0,0,0,0)},e.applyFilter=function(){},e.toString=function(){return"[Filter]"},e.clone=function(){return new t},createjs.Filter=t}(),this.createjs=this.createjs||{},function(){var t=function(){throw"Touch cannot be instantiated"};t.isSupported=function(){return"ontouchstart"in window||window.navigator.msPointerEnabled},t.enable=function(e,i,o){return e&&e.canvas&&t.isSupported()?(e.__touch={pointers:{},multitouch:!i,preventDefault:!o,count:0},"ontouchstart"in window?t._IOS_enable(e):window.navigator.msPointerEnabled&&t._IE_enable(e),!0):!1},t.disable=function(e){e&&("ontouchstart"in window?t._IOS_disable(e):window.navigator.msPointerEnabled&&t._IE_disable(e))},t._IOS_enable=function(e){var i=e.canvas,o=e.__touch.f=function(i){t._IOS_handleEvent(e,i)};i.addEventListener("touchstart",o,!1),i.addEventListener("touchmove",o,!1),i.addEventListener("touchend",o,!1),i.addEventListener("touchcancel",o,!1)},t._IOS_disable=function(t){var e=t.canvas;e&&(t=t.__touch.f,e.removeEventListener("touchstart",t,!1),e.removeEventListener("touchmove",t,!1),e.removeEventListener("touchend",t,!1),e.removeEventListener("touchcancel",t,!1))},t._IOS_handleEvent=function(t,e){if(t){t.__touch.preventDefault&&e.preventDefault&&e.preventDefault();for(var i=e.changedTouches,o=e.type,n=0,s=i.length;s>n;n++){var r=i[n],a=r.identifier;r.target==t.canvas&&("touchstart"==o?this._handleStart(t,a,e,r.pageX,r.pageY):"touchmove"==o?this._handleMove(t,a,e,r.pageX,r.pageY):("touchend"==o||"touchcancel"==o)&&this._handleEnd(t,a,e))}}},t._IE_enable=function(e){var i=e.canvas,o=e.__touch.f=function(i){t._IE_handleEvent(e,i)};i.addEventListener("MSPointerDown",o,!1),window.addEventListener("MSPointerMove",o,!1),window.addEventListener("MSPointerUp",o,!1),window.addEventListener("MSPointerCancel",o,!1),e.__touch.preventDefault&&(i.style.msTouchAction="none"),e.__touch.activeIDs={}},t._IE_disable=function(t){var e=t.__touch.f;window.removeEventListener("MSPointerMove",e,!1),window.removeEventListener("MSPointerUp",e,!1),window.removeEventListener("MSPointerCancel",e,!1),t.canvas&&t.canvas.removeEventListener("MSPointerDown",e,!1)},t._IE_handleEvent=function(t,e){if(t){t.__touch.preventDefault&&e.preventDefault&&e.preventDefault();var i=e.type,o=e.pointerId,n=t.__touch.activeIDs;"MSPointerDown"==i?e.srcElement==t.canvas&&(n[o]=!0,this._handleStart(t,o,e,e.pageX,e.pageY)):n[o]&&("MSPointerMove"==i?this._handleMove(t,o,e,e.pageX,e.pageY):("MSPointerUp"==i||"MSPointerCancel"==i)&&(delete n[o],this._handleEnd(t,o,e)))}},t._handleStart=function(t,e,i,o,n){var s=t.__touch;if(s.multitouch||!s.count){var r=s.pointers;r[e]||(r[e]=!0,s.count++,t._handlePointerDown(e,i,o,n))}},t._handleMove=function(t,e,i,o,n){t.__touch.pointers[e]&&t._handlePointerMove(e,i,o,n)},t._handleEnd=function(t,e,i){var o=t.__touch,n=o.pointers;n[e]&&(o.count--,t._handlePointerUp(e,i,!0),delete n[e])},createjs.Touch=t}(),function(){var t=this.createjs=this.createjs||{},t=t.EaselJS=t.EaselJS||{};t.version="0.6.1",t.buildDate="Tue, 14 May 2013 21:43:02 GMT"}(),define("easeljs",function(t){return function(){var e;return e||t.createjs}}(this));var Box2D={};!function(t,e){function i(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(t,e,i){i.get instanceof Function&&t.__defineGetter__(e,i.get),i.set instanceof Function&&t.__defineSetter__(e,i.set)}),t.inherit=function(t,e){var o=t;i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=o},t.generateCallback=function(t,e){return function(){e.apply(t,arguments)}},t.NVector=function(t){t===e&&(t=0);for(var i=new Array(t||0),o=0;t>o;++o)i[o]=0;return i},t.is=function(t,i){return null===t?!1:i instanceof Function&&t instanceof i?!0:t.constructor.__implements!=e&&t.constructor.__implements[i]?!0:!1},t.parseUInt=function(t){return Math.abs(parseInt(t))}}(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;"undefined"==typeof Box2D&&(Box2D={}),"undefined"==typeof Box2D.Collision&&(Box2D.Collision={}),"undefined"==typeof Box2D.Collision.Shapes&&(Box2D.Collision.Shapes={}),"undefined"==typeof Box2D.Common&&(Box2D.Common={}),"undefined"==typeof Box2D.Common.Math&&(Box2D.Common.Math={}),"undefined"==typeof Box2D.Dynamics&&(Box2D.Dynamics={}),"undefined"==typeof Box2D.Dynamics.Contacts&&(Box2D.Dynamics.Contacts={}),"undefined"==typeof Box2D.Dynamics.Controllers&&(Box2D.Dynamics.Controllers={}),"undefined"==typeof Box2D.Dynamics.Joints&&(Box2D.Dynamics.Joints={}),function(){function t(){t.b2AABB.apply(this,arguments)}function e(){e.b2Bound.apply(this,arguments)}function i(){i.b2BoundValues.apply(this,arguments),this.constructor===i&&this.b2BoundValues.apply(this,arguments)}function o(){o.b2Collision.apply(this,arguments)}function n(){n.b2ContactID.apply(this,arguments),this.constructor===n&&this.b2ContactID.apply(this,arguments)}function s(){s.b2ContactPoint.apply(this,arguments)}function r(){r.b2Distance.apply(this,arguments)}function a(){a.b2DistanceInput.apply(this,arguments)}function l(){l.b2DistanceOutput.apply(this,arguments)}function h(){h.b2DistanceProxy.apply(this,arguments)}function c(){c.b2DynamicTree.apply(this,arguments),this.constructor===c&&this.b2DynamicTree.apply(this,arguments)}function m(){m.b2DynamicTreeBroadPhase.apply(this,arguments)}function _(){_.b2DynamicTreeNode.apply(this,arguments)}function u(){u.b2DynamicTreePair.apply(this,arguments)}function p(){p.b2Manifold.apply(this,arguments),this.constructor===p&&this.b2Manifold.apply(this,arguments)}function y(){y.b2ManifoldPoint.apply(this,arguments),this.constructor===y&&this.b2ManifoldPoint.apply(this,arguments)}function x(){x.b2Point.apply(this,arguments)}function d(){d.b2RayCastInput.apply(this,arguments),this.constructor===d&&this.b2RayCastInput.apply(this,arguments)}function f(){f.b2RayCastOutput.apply(this,arguments)}function v(){v.b2Segment.apply(this,arguments)}function b(){b.b2SeparationFunction.apply(this,arguments)}function g(){g.b2Simplex.apply(this,arguments),this.constructor===g&&this.b2Simplex.apply(this,arguments)
}function D(){D.b2SimplexCache.apply(this,arguments)}function C(){C.b2SimplexVertex.apply(this,arguments)}function B(){B.b2TimeOfImpact.apply(this,arguments)}function w(){w.b2TOIInput.apply(this,arguments)}function S(){S.b2WorldManifold.apply(this,arguments),this.constructor===S&&this.b2WorldManifold.apply(this,arguments)}function A(){A.ClipVertex.apply(this,arguments)}function M(){M.Features.apply(this,arguments)}function I(){I.b2CircleShape.apply(this,arguments),this.constructor===I&&this.b2CircleShape.apply(this,arguments)}function V(){V.b2EdgeChainDef.apply(this,arguments),this.constructor===V&&this.b2EdgeChainDef.apply(this,arguments)}function L(){L.b2EdgeShape.apply(this,arguments),this.constructor===L&&this.b2EdgeShape.apply(this,arguments)}function P(){P.b2MassData.apply(this,arguments)}function T(){T.b2PolygonShape.apply(this,arguments),this.constructor===T&&this.b2PolygonShape.apply(this,arguments)}function G(){G.b2Shape.apply(this,arguments),this.constructor===G&&this.b2Shape.apply(this,arguments)}function R(){R.b2Color.apply(this,arguments),this.constructor===R&&this.b2Color.apply(this,arguments)}function F(){F.b2Settings.apply(this,arguments)}function E(){E.b2Mat22.apply(this,arguments),this.constructor===E&&this.b2Mat22.apply(this,arguments)}function J(){J.b2Mat33.apply(this,arguments),this.constructor===J&&this.b2Mat33.apply(this,arguments)}function j(){j.b2Math.apply(this,arguments)}function k(){k.b2Sweep.apply(this,arguments)}function O(){O.b2Transform.apply(this,arguments),this.constructor===O&&this.b2Transform.apply(this,arguments)}function N(){N.b2Vec2.apply(this,arguments),this.constructor===N&&this.b2Vec2.apply(this,arguments)}function z(){z.b2Vec3.apply(this,arguments),this.constructor===z&&this.b2Vec3.apply(this,arguments)}function X(){X.b2Body.apply(this,arguments),this.constructor===X&&this.b2Body.apply(this,arguments)}function U(){U.b2BodyDef.apply(this,arguments),this.constructor===U&&this.b2BodyDef.apply(this,arguments)}function q(){q.b2ContactFilter.apply(this,arguments)}function W(){W.b2ContactImpulse.apply(this,arguments)}function Y(){Y.b2ContactListener.apply(this,arguments)}function K(){K.b2ContactManager.apply(this,arguments),this.constructor===K&&this.b2ContactManager.apply(this,arguments)}function Q(){Q.b2DebugDraw.apply(this,arguments),this.constructor===Q&&this.b2DebugDraw.apply(this,arguments)}function H(){H.b2DestructionListener.apply(this,arguments)}function Z(){Z.b2FilterData.apply(this,arguments)}function $(){$.b2Fixture.apply(this,arguments),this.constructor===$&&this.b2Fixture.apply(this,arguments)}function te(){te.b2FixtureDef.apply(this,arguments),this.constructor===te&&this.b2FixtureDef.apply(this,arguments)}function ee(){ee.b2Island.apply(this,arguments),this.constructor===ee&&this.b2Island.apply(this,arguments)}function ie(){ie.b2TimeStep.apply(this,arguments)}function oe(){oe.b2World.apply(this,arguments),this.constructor===oe&&this.b2World.apply(this,arguments)}function ne(){ne.b2CircleContact.apply(this,arguments)}function se(){se.b2Contact.apply(this,arguments),this.constructor===se&&this.b2Contact.apply(this,arguments)}function re(){re.b2ContactConstraint.apply(this,arguments),this.constructor===re&&this.b2ContactConstraint.apply(this,arguments)}function ae(){ae.b2ContactConstraintPoint.apply(this,arguments)}function le(){le.b2ContactEdge.apply(this,arguments)}function he(){he.b2ContactFactory.apply(this,arguments),this.constructor===he&&this.b2ContactFactory.apply(this,arguments)}function ce(){ce.b2ContactRegister.apply(this,arguments)}function me(){me.b2ContactResult.apply(this,arguments)}function _e(){_e.b2ContactSolver.apply(this,arguments),this.constructor===_e&&this.b2ContactSolver.apply(this,arguments)}function ue(){ue.b2EdgeAndCircleContact.apply(this,arguments)}function pe(){pe.b2NullContact.apply(this,arguments),this.constructor===pe&&this.b2NullContact.apply(this,arguments)}function ye(){ye.b2PolyAndCircleContact.apply(this,arguments)}function xe(){xe.b2PolyAndEdgeContact.apply(this,arguments)}function de(){de.b2PolygonContact.apply(this,arguments)}function fe(){fe.b2PositionSolverManifold.apply(this,arguments),this.constructor===fe&&this.b2PositionSolverManifold.apply(this,arguments)}function ve(){ve.b2BuoyancyController.apply(this,arguments)}function be(){be.b2ConstantAccelController.apply(this,arguments)}function ge(){ge.b2ConstantForceController.apply(this,arguments)}function De(){De.b2Controller.apply(this,arguments)}function Ce(){Ce.b2ControllerEdge.apply(this,arguments)}function Be(){Be.b2GravityController.apply(this,arguments)}function we(){we.b2TensorDampingController.apply(this,arguments)}function Se(){Se.b2DistanceJoint.apply(this,arguments),this.constructor===Se&&this.b2DistanceJoint.apply(this,arguments)}function Ae(){Ae.b2DistanceJointDef.apply(this,arguments),this.constructor===Ae&&this.b2DistanceJointDef.apply(this,arguments)}function Me(){Me.b2FrictionJoint.apply(this,arguments),this.constructor===Me&&this.b2FrictionJoint.apply(this,arguments)}function Ie(){Ie.b2FrictionJointDef.apply(this,arguments),this.constructor===Ie&&this.b2FrictionJointDef.apply(this,arguments)}function Ve(){Ve.b2GearJoint.apply(this,arguments),this.constructor===Ve&&this.b2GearJoint.apply(this,arguments)}function Le(){Le.b2GearJointDef.apply(this,arguments),this.constructor===Le&&this.b2GearJointDef.apply(this,arguments)}function Pe(){Pe.b2Jacobian.apply(this,arguments)}function Te(){Te.b2Joint.apply(this,arguments),this.constructor===Te&&this.b2Joint.apply(this,arguments)}function Ge(){Ge.b2JointDef.apply(this,arguments),this.constructor===Ge&&this.b2JointDef.apply(this,arguments)}function Re(){Re.b2JointEdge.apply(this,arguments)}function Fe(){Fe.b2LineJoint.apply(this,arguments),this.constructor===Fe&&this.b2LineJoint.apply(this,arguments)}function Ee(){Ee.b2LineJointDef.apply(this,arguments),this.constructor===Ee&&this.b2LineJointDef.apply(this,arguments)}function Je(){Je.b2MouseJoint.apply(this,arguments),this.constructor===Je&&this.b2MouseJoint.apply(this,arguments)}function je(){je.b2MouseJointDef.apply(this,arguments),this.constructor===je&&this.b2MouseJointDef.apply(this,arguments)}function ke(){ke.b2PrismaticJoint.apply(this,arguments),this.constructor===ke&&this.b2PrismaticJoint.apply(this,arguments)}function Oe(){Oe.b2PrismaticJointDef.apply(this,arguments),this.constructor===Oe&&this.b2PrismaticJointDef.apply(this,arguments)}function Ne(){Ne.b2PulleyJoint.apply(this,arguments),this.constructor===Ne&&this.b2PulleyJoint.apply(this,arguments)}function ze(){ze.b2PulleyJointDef.apply(this,arguments),this.constructor===ze&&this.b2PulleyJointDef.apply(this,arguments)}function Xe(){Xe.b2RevoluteJoint.apply(this,arguments),this.constructor===Xe&&this.b2RevoluteJoint.apply(this,arguments)}function Ue(){Ue.b2RevoluteJointDef.apply(this,arguments),this.constructor===Ue&&this.b2RevoluteJointDef.apply(this,arguments)}function qe(){qe.b2WeldJoint.apply(this,arguments),this.constructor===qe&&this.b2WeldJoint.apply(this,arguments)}function We(){We.b2WeldJointDef.apply(this,arguments),this.constructor===We&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Collision.b2AABB=t,Box2D.Collision.b2Bound=e,Box2D.Collision.b2BoundValues=i,Box2D.Collision.b2Collision=o,Box2D.Collision.b2ContactID=n,Box2D.Collision.b2ContactPoint=s,Box2D.Collision.b2Distance=r,Box2D.Collision.b2DistanceInput=a,Box2D.Collision.b2DistanceOutput=l,Box2D.Collision.b2DistanceProxy=h,Box2D.Collision.b2DynamicTree=c,Box2D.Collision.b2DynamicTreeBroadPhase=m,Box2D.Collision.b2DynamicTreeNode=_,Box2D.Collision.b2DynamicTreePair=u,Box2D.Collision.b2Manifold=p,Box2D.Collision.b2ManifoldPoint=y,Box2D.Collision.b2Point=x,Box2D.Collision.b2RayCastInput=d,Box2D.Collision.b2RayCastOutput=f,Box2D.Collision.b2Segment=v,Box2D.Collision.b2SeparationFunction=b,Box2D.Collision.b2Simplex=g,Box2D.Collision.b2SimplexCache=D,Box2D.Collision.b2SimplexVertex=C,Box2D.Collision.b2TimeOfImpact=B,Box2D.Collision.b2TOIInput=w,Box2D.Collision.b2WorldManifold=S,Box2D.Collision.ClipVertex=A,Box2D.Collision.Features=M,Box2D.Collision.Shapes.b2CircleShape=I,Box2D.Collision.Shapes.b2EdgeChainDef=V,Box2D.Collision.Shapes.b2EdgeShape=L,Box2D.Collision.Shapes.b2MassData=P,Box2D.Collision.Shapes.b2PolygonShape=T,Box2D.Collision.Shapes.b2Shape=G,Box2D.Common.b2internal="Box2D.Common.b2internal",Box2D.Common.b2Color=R,Box2D.Common.b2Settings=F,Box2D.Common.Math.b2Mat22=E,Box2D.Common.Math.b2Mat33=J,Box2D.Common.Math.b2Math=j,Box2D.Common.Math.b2Sweep=k,Box2D.Common.Math.b2Transform=O,Box2D.Common.Math.b2Vec2=N,Box2D.Common.Math.b2Vec3=z,Box2D.Dynamics.b2Body=X,Box2D.Dynamics.b2BodyDef=U,Box2D.Dynamics.b2ContactFilter=q,Box2D.Dynamics.b2ContactImpulse=W,Box2D.Dynamics.b2ContactListener=Y,Box2D.Dynamics.b2ContactManager=K,Box2D.Dynamics.b2DebugDraw=Q,Box2D.Dynamics.b2DestructionListener=H,Box2D.Dynamics.b2FilterData=Z,Box2D.Dynamics.b2Fixture=$,Box2D.Dynamics.b2FixtureDef=te,Box2D.Dynamics.b2Island=ee,Box2D.Dynamics.b2TimeStep=ie,Box2D.Dynamics.b2World=oe,Box2D.Dynamics.Contacts.b2CircleContact=ne,Box2D.Dynamics.Contacts.b2Contact=se,Box2D.Dynamics.Contacts.b2ContactConstraint=re,Box2D.Dynamics.Contacts.b2ContactConstraintPoint=ae,Box2D.Dynamics.Contacts.b2ContactEdge=le,Box2D.Dynamics.Contacts.b2ContactFactory=he,Box2D.Dynamics.Contacts.b2ContactRegister=ce,Box2D.Dynamics.Contacts.b2ContactResult=me,Box2D.Dynamics.Contacts.b2ContactSolver=_e,Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=ue,Box2D.Dynamics.Contacts.b2NullContact=pe,Box2D.Dynamics.Contacts.b2PolyAndCircleContact=ye,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=xe,Box2D.Dynamics.Contacts.b2PolygonContact=de,Box2D.Dynamics.Contacts.b2PositionSolverManifold=fe,Box2D.Dynamics.Controllers.b2BuoyancyController=ve,Box2D.Dynamics.Controllers.b2ConstantAccelController=be,Box2D.Dynamics.Controllers.b2ConstantForceController=ge,Box2D.Dynamics.Controllers.b2Controller=De,Box2D.Dynamics.Controllers.b2ControllerEdge=Ce,Box2D.Dynamics.Controllers.b2GravityController=Be,Box2D.Dynamics.Controllers.b2TensorDampingController=we,Box2D.Dynamics.Joints.b2DistanceJoint=Se,Box2D.Dynamics.Joints.b2DistanceJointDef=Ae,Box2D.Dynamics.Joints.b2FrictionJoint=Me,Box2D.Dynamics.Joints.b2FrictionJointDef=Ie,Box2D.Dynamics.Joints.b2GearJoint=Ve,Box2D.Dynamics.Joints.b2GearJointDef=Le,Box2D.Dynamics.Joints.b2Jacobian=Pe,Box2D.Dynamics.Joints.b2Joint=Te,Box2D.Dynamics.Joints.b2JointDef=Ge,Box2D.Dynamics.Joints.b2JointEdge=Re,Box2D.Dynamics.Joints.b2LineJoint=Fe,Box2D.Dynamics.Joints.b2LineJointDef=Ee,Box2D.Dynamics.Joints.b2MouseJoint=Je,Box2D.Dynamics.Joints.b2MouseJointDef=je,Box2D.Dynamics.Joints.b2PrismaticJoint=ke,Box2D.Dynamics.Joints.b2PrismaticJointDef=Oe,Box2D.Dynamics.Joints.b2PulleyJoint=Ne,Box2D.Dynamics.Joints.b2PulleyJointDef=ze,Box2D.Dynamics.Joints.b2RevoluteJoint=Xe,Box2D.Dynamics.Joints.b2RevoluteJointDef=Ue,Box2D.Dynamics.Joints.b2WeldJoint=qe,Box2D.Dynamics.Joints.b2WeldJointDef=We}(),Box2D.postDefs=[],function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape),i=Box2D.Collision.Shapes.b2Shape,o=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),n=(Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),s=Box2D.Common.Math.b2Sweep,r=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,l=(Box2D.Common.Math.b2Vec3,Box2D.Collision.b2AABB),h=Box2D.Collision.b2Bound,c=Box2D.Collision.b2BoundValues,m=Box2D.Collision.b2Collision,_=Box2D.Collision.b2ContactID,u=Box2D.Collision.b2ContactPoint,p=Box2D.Collision.b2Distance,y=Box2D.Collision.b2DistanceInput,x=Box2D.Collision.b2DistanceOutput,d=Box2D.Collision.b2DistanceProxy,f=Box2D.Collision.b2DynamicTree,v=Box2D.Collision.b2DynamicTreeBroadPhase,b=Box2D.Collision.b2DynamicTreeNode,g=Box2D.Collision.b2DynamicTreePair,D=Box2D.Collision.b2Manifold,C=Box2D.Collision.b2ManifoldPoint,B=Box2D.Collision.b2Point,w=Box2D.Collision.b2RayCastInput,S=Box2D.Collision.b2RayCastOutput,A=Box2D.Collision.b2Segment,M=Box2D.Collision.b2SeparationFunction,I=Box2D.Collision.b2Simplex,V=Box2D.Collision.b2SimplexCache,L=Box2D.Collision.b2SimplexVertex,P=Box2D.Collision.b2TimeOfImpact,T=Box2D.Collision.b2TOIInput,G=Box2D.Collision.b2WorldManifold,R=Box2D.Collision.ClipVertex,F=Box2D.Collision.Features,E=Box2D.Collision.IBroadPhase;l.b2AABB=function(){this.lowerBound=new a,this.upperBound=new a},l.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y,i=t>=0&&e>=0;return i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},l.prototype.GetCenter=function(){return new a((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},l.prototype.GetExtents=function(){return new a((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},l.prototype.Contains=function(t){var e=!0;return e=e&&this.lowerBound.x<=t.lowerBound.x,e=e&&this.lowerBound.y<=t.lowerBound.y,e=e&&t.upperBound.x<=this.upperBound.x,e=e&&t.upperBound.y<=this.upperBound.y},l.prototype.RayCast=function(t,e){var i=-Number.MAX_VALUE,o=Number.MAX_VALUE,n=e.p1.x,s=e.p1.y,r=e.p2.x-e.p1.x,a=e.p2.y-e.p1.y,l=Math.abs(r),h=Math.abs(a),c=t.normal,m=0,_=0,u=0,p=0,y=0;if(l<Number.MIN_VALUE){if(n<this.lowerBound.x||this.upperBound.x<n)return!1}else if(m=1/r,_=(this.lowerBound.x-n)*m,u=(this.upperBound.x-n)*m,y=-1,_>u&&(p=_,_=u,u=p,y=1),_>i&&(c.x=y,c.y=0,i=_),o=Math.min(o,u),i>o)return!1;if(h<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else if(m=1/a,_=(this.lowerBound.y-s)*m,u=(this.upperBound.y-s)*m,y=-1,_>u&&(p=_,_=u,u=p,y=1),_>i&&(c.y=y,c.x=0,i=_),o=Math.min(o,u),i>o)return!1;return t.fraction=i,!0},l.prototype.TestOverlap=function(t){var e=t.lowerBound.x-this.upperBound.x,i=t.lowerBound.y-this.upperBound.y,o=this.lowerBound.x-t.upperBound.x,n=this.lowerBound.y-t.upperBound.y;return e>0||i>0?!1:o>0||n>0?!1:!0},l.Combine=function(t,e){var i=new l;return i.Combine(t,e),i},l.prototype.Combine=function(t,e){this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x),this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y)},h.b2Bound=function(){},h.prototype.IsLower=function(){return 0==(1&this.value)},h.prototype.IsUpper=function(){return 1==(1&this.value)},h.prototype.Swap=function(t){var e=this.value,i=this.proxy,o=this.stabbingCount;this.value=t.value,this.proxy=t.proxy,this.stabbingCount=t.stabbingCount,t.value=e,t.proxy=i,t.stabbingCount=o},c.b2BoundValues=function(){},c.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Vector_a2j_Number,this.upperValues[0]=0,this.upperValues[1]=0},m.b2Collision=function(){},m.ClipSegmentToLine=function(t,e,i,o){void 0===o&&(o=0);var n,s=0;n=e[0];var r=n.v;n=e[1];var a=n.v,l=i.x*r.x+i.y*r.y-o,h=i.x*a.x+i.y*a.y-o;if(0>=l&&t[s++].Set(e[0]),0>=h&&t[s++].Set(e[1]),0>l*h){var c=l/(l-h);n=t[s];var m=n.v;m.x=r.x+c*(a.x-r.x),m.y=r.y+c*(a.y-r.y),n=t[s];var _;l>0?(_=e[0],n.id=_.id):(_=e[1],n.id=_.id),++s}return s},m.EdgeSeparation=function(t,e,i,o,n){void 0===i&&(i=0),parseInt(t.m_vertexCount);var s,r,a=t.m_vertices,l=t.m_normals,h=parseInt(o.m_vertexCount),c=o.m_vertices;s=e.R,r=l[i];var m=s.col1.x*r.x+s.col2.x*r.y,_=s.col1.y*r.x+s.col2.y*r.y;s=n.R;for(var u=s.col1.x*m+s.col1.y*_,p=s.col2.x*m+s.col2.y*_,y=0,x=Number.MAX_VALUE,d=0;h>d;++d){r=c[d];var f=r.x*u+r.y*p;x>f&&(x=f,y=d)}r=a[i],s=e.R;var v=e.position.x+(s.col1.x*r.x+s.col2.x*r.y),b=e.position.y+(s.col1.y*r.x+s.col2.y*r.y);r=c[y],s=n.R;var g=n.position.x+(s.col1.x*r.x+s.col2.x*r.y),D=n.position.y+(s.col1.y*r.x+s.col2.y*r.y);g-=v,D-=b;var C=g*m+D*_;return C},m.FindMaxSeparation=function(t,e,i,o,n){var s,r,a=parseInt(e.m_vertexCount),l=e.m_normals;r=n.R,s=o.m_centroid;var h=n.position.x+(r.col1.x*s.x+r.col2.x*s.y),c=n.position.y+(r.col1.y*s.x+r.col2.y*s.y);r=i.R,s=e.m_centroid,h-=i.position.x+(r.col1.x*s.x+r.col2.x*s.y),c-=i.position.y+(r.col1.y*s.x+r.col2.y*s.y);for(var _=h*i.R.col1.x+c*i.R.col1.y,u=h*i.R.col2.x+c*i.R.col2.y,p=0,y=-Number.MAX_VALUE,x=0;a>x;++x){s=l[x];var d=s.x*_+s.y*u;d>y&&(y=d,p=x)}var f=m.EdgeSeparation(e,i,p,o,n),v=parseInt(p-1>=0?p-1:a-1),b=m.EdgeSeparation(e,i,v,o,n),g=parseInt(a>p+1?p+1:0),D=m.EdgeSeparation(e,i,g,o,n),C=0,B=0,w=0;if(b>f&&b>D)w=-1,C=v,B=b;else{if(!(D>f))return t[0]=p,f;w=1,C=g,B=D}for(;;){if(p=-1==w?C-1>=0?C-1:a-1:a>C+1?C+1:0,f=m.EdgeSeparation(e,i,p,o,n),!(f>B))break;C=p,B=f}return t[0]=C,B},m.FindIncidentEdge=function(t,e,i,o,n,s){void 0===o&&(o=0),parseInt(e.m_vertexCount);var r,a,l=e.m_normals,h=parseInt(n.m_vertexCount),c=n.m_vertices,m=n.m_normals;r=i.R,a=l[o];var _=r.col1.x*a.x+r.col2.x*a.y,u=r.col1.y*a.x+r.col2.y*a.y;r=s.R;var p=r.col1.x*_+r.col1.y*u;u=r.col2.x*_+r.col2.y*u,_=p;for(var y=0,x=Number.MAX_VALUE,d=0;h>d;++d){a=m[d];var f=_*a.x+u*a.y;x>f&&(x=f,y=d)}var v,b=parseInt(y),g=parseInt(h>b+1?b+1:0);v=t[0],a=c[b],r=s.R,v.v.x=s.position.x+(r.col1.x*a.x+r.col2.x*a.y),v.v.y=s.position.y+(r.col1.y*a.x+r.col2.y*a.y),v.id.features.referenceEdge=o,v.id.features.incidentEdge=b,v.id.features.incidentVertex=0,v=t[1],a=c[g],r=s.R,v.v.x=s.position.x+(r.col1.x*a.x+r.col2.x*a.y),v.v.y=s.position.y+(r.col1.y*a.x+r.col2.y*a.y),v.id.features.referenceEdge=o,v.id.features.incidentEdge=g,v.id.features.incidentVertex=1},m.MakeClipPointVector=function(){var t=new Vector(2);return t[0]=new R,t[1]=new R,t},m.CollidePolygons=function(t,e,i,n,s){var r;t.m_pointCount=0;var a=e.m_radius+n.m_radius,l=0;m.s_edgeAO[0]=l;var h=m.FindMaxSeparation(m.s_edgeAO,e,i,n,s);if(l=m.s_edgeAO[0],!(h>a)){var c=0;m.s_edgeBO[0]=c;var _=m.FindMaxSeparation(m.s_edgeBO,n,s,e,i);if(c=m.s_edgeBO[0],!(_>a)){var u,p,y,x,d,f=0,v=0,b=.98,g=.001;_>b*h+g?(u=n,p=e,y=s,x=i,f=c,t.m_type=D.e_faceB,v=1):(u=e,p=n,y=i,x=s,f=l,t.m_type=D.e_faceA,v=0);var C=m.s_incidentEdge;m.FindIncidentEdge(C,u,y,f,p,x);var B,w=parseInt(u.m_vertexCount),S=u.m_vertices,A=S[f];B=w>f+1?S[parseInt(f+1)]:S[0];var M=m.s_localTangent;M.Set(B.x-A.x,B.y-A.y),M.Normalize();var I=m.s_localNormal;I.x=M.y,I.y=-M.x;var V=m.s_planePoint;V.Set(.5*(A.x+B.x),.5*(A.y+B.y));var L=m.s_tangent;d=y.R,L.x=d.col1.x*M.x+d.col2.x*M.y,L.y=d.col1.y*M.x+d.col2.y*M.y;var P=m.s_tangent2;P.x=-L.x,P.y=-L.y;var T=m.s_normal;T.x=L.y,T.y=-L.x;var G=m.s_v11,R=m.s_v12;G.x=y.position.x+(d.col1.x*A.x+d.col2.x*A.y),G.y=y.position.y+(d.col1.y*A.x+d.col2.y*A.y),R.x=y.position.x+(d.col1.x*B.x+d.col2.x*B.y),R.y=y.position.y+(d.col1.y*B.x+d.col2.y*B.y);var F=T.x*G.x+T.y*G.y,E=-L.x*G.x-L.y*G.y+a,J=L.x*R.x+L.y*R.y+a,j=m.s_clipPoints1,k=m.s_clipPoints2,O=0;if(O=m.ClipSegmentToLine(j,C,P,E),!(2>O||(O=m.ClipSegmentToLine(k,j,L,J),2>O))){t.m_localPlaneNormal.SetV(I),t.m_localPoint.SetV(V);for(var N=0,z=0;z<o.b2_maxManifoldPoints;++z){r=k[z];var X=T.x*r.v.x+T.y*r.v.y-F;if(a>=X){var U=t.m_points[N];d=x.R;var q=r.v.x-x.position.x,W=r.v.y-x.position.y;U.m_localPoint.x=q*d.col1.x+W*d.col1.y,U.m_localPoint.y=q*d.col2.x+W*d.col2.y,U.m_id.Set(r.id),U.m_id.features.flip=v,++N}}t.m_pointCount=N}}}},m.CollideCircles=function(t,e,i,o,n){t.m_pointCount=0;var s,r;s=i.R,r=e.m_p;var a=i.position.x+(s.col1.x*r.x+s.col2.x*r.y),l=i.position.y+(s.col1.y*r.x+s.col2.y*r.y);s=n.R,r=o.m_p;var h=n.position.x+(s.col1.x*r.x+s.col2.x*r.y),c=n.position.y+(s.col1.y*r.x+s.col2.y*r.y),m=h-a,_=c-l,u=m*m+_*_,p=e.m_radius+o.m_radius;u>p*p||(t.m_type=D.e_circles,t.m_localPoint.SetV(e.m_p),t.m_localPlaneNormal.SetZero(),t.m_pointCount=1,t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0)},m.CollidePolygonAndCircle=function(t,e,i,o,n){t.m_pointCount=0;var s,r,a=0,l=0;r=n.R,s=o.m_p;var h=n.position.x+(r.col1.x*s.x+r.col2.x*s.y),c=n.position.y+(r.col1.y*s.x+r.col2.y*s.y);a=h-i.position.x,l=c-i.position.y,r=i.R;for(var m=a*r.col1.x+l*r.col1.y,_=a*r.col2.x+l*r.col2.y,u=0,p=-Number.MAX_VALUE,y=e.m_radius+o.m_radius,x=parseInt(e.m_vertexCount),d=e.m_vertices,f=e.m_normals,v=0;x>v;++v){s=d[v],a=m-s.x,l=_-s.y,s=f[v];var b=s.x*a+s.y*l;if(b>y)return;b>p&&(p=b,u=v)}var g=parseInt(u),C=parseInt(x>g+1?g+1:0),B=d[g],w=d[C];if(p<Number.MIN_VALUE)return t.m_pointCount=1,t.m_type=D.e_faceA,t.m_localPlaneNormal.SetV(f[u]),t.m_localPoint.x=.5*(B.x+w.x),t.m_localPoint.y=.5*(B.y+w.y),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0,void 0;var S=(m-B.x)*(w.x-B.x)+(_-B.y)*(w.y-B.y),A=(m-w.x)*(B.x-w.x)+(_-w.y)*(B.y-w.y);if(0>=S){if((m-B.x)*(m-B.x)+(_-B.y)*(_-B.y)>y*y)return;t.m_pointCount=1,t.m_type=D.e_faceA,t.m_localPlaneNormal.x=m-B.x,t.m_localPlaneNormal.y=_-B.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(B),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0}else if(0>=A){if((m-w.x)*(m-w.x)+(_-w.y)*(_-w.y)>y*y)return;t.m_pointCount=1,t.m_type=D.e_faceA,t.m_localPlaneNormal.x=m-w.x,t.m_localPlaneNormal.y=_-w.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(w),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0}else{var M=.5*(B.x+w.x),I=.5*(B.y+w.y);if(p=(m-M)*f[g].x+(_-I)*f[g].y,p>y)return;t.m_pointCount=1,t.m_type=D.e_faceA,t.m_localPlaneNormal.x=f[g].x,t.m_localPlaneNormal.y=f[g].y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.Set(M,I),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.key=0}},m.TestOverlap=function(t,e){var i=e.lowerBound,o=t.upperBound,n=i.x-o.x,s=i.y-o.y;i=t.lowerBound,o=e.upperBound;var r=i.x-o.x,a=i.y-o.y;return n>0||s>0?!1:r>0||a>0?!1:!0},Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=m.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=m.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=m.MakeClipPointVector(),Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_localTangent=new a,Box2D.Collision.b2Collision.s_localNormal=new a,Box2D.Collision.b2Collision.s_planePoint=new a,Box2D.Collision.b2Collision.s_normal=new a,Box2D.Collision.b2Collision.s_tangent=new a,Box2D.Collision.b2Collision.s_tangent2=new a,Box2D.Collision.b2Collision.s_v11=new a,Box2D.Collision.b2Collision.s_v12=new a,Box2D.Collision.b2Collision.b2CollidePolyTempVec=new a,Box2D.Collision.b2Collision.b2_nullFeature=255}),_.b2ContactID=function(){this.features=new F},_.prototype.b2ContactID=function(){this.features._m_id=this},_.prototype.Set=function(t){this.key=t._key},_.prototype.Copy=function(){var t=new _;return t.key=this.key,t},Object.defineProperty(_.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(_.prototype,"key",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._key=t,this.features._referenceEdge=255&this._key,this.features._incidentEdge=255&(65280&this._key)>>8,this.features._incidentVertex=255&(16711680&this._key)>>16,this.features._flip=255&(4278190080&this._key)>>24}}),u.b2ContactPoint=function(){this.position=new a,this.velocity=new a,this.normal=new a,this.id=new _},p.b2Distance=function(){},p.Distance=function(t,e,i){++p.b2_gjkCalls;var s=i.proxyA,r=i.proxyB,l=i.transformA,h=i.transformB,c=p.s_simplex;c.ReadCache(e,s,l,r,h);for(var m,_=c.m_vertices,u=20,y=p.s_saveA,x=p.s_saveB,d=0,f=c.GetClosestPoint(),v=f.LengthSquared(),b=v,g=0,D=0;u>D;){for(d=c.m_count,g=0;d>g;g++)y[g]=_[g].indexA,x[g]=_[g].indexB;switch(c.m_count){case 1:break;case 2:c.Solve2();break;case 3:c.Solve3();break;default:o.b2Assert(!1)}if(3==c.m_count)break;m=c.GetClosestPoint(),b=m.LengthSquared(),v=b;var C=c.GetSearchDirection();if(C.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;var B=_[c.m_count];B.indexA=s.GetSupport(n.MulTMV(l.R,C.GetNegative())),B.wA=n.MulX(l,s.GetVertex(B.indexA)),B.indexB=r.GetSupport(n.MulTMV(h.R,C)),B.wB=n.MulX(h,r.GetVertex(B.indexB)),B.w=n.SubtractVV(B.wB,B.wA),++D,++p.b2_gjkIters;var w=!1;for(g=0;d>g;g++)if(B.indexA==y[g]&&B.indexB==x[g]){w=!0;break}if(w)break;++c.m_count}if(p.b2_gjkMaxIters=n.Max(p.b2_gjkMaxIters,D),c.GetWitnessPoints(t.pointA,t.pointB),t.distance=n.SubtractVV(t.pointA,t.pointB).Length(),t.iterations=D,c.WriteCache(e),i.useRadii){var S=s.m_radius,A=r.m_radius;if(t.distance>S+A&&t.distance>Number.MIN_VALUE){t.distance-=S+A;var M=n.SubtractVV(t.pointB,t.pointA);M.Normalize(),t.pointA.x+=S*M.x,t.pointA.y+=S*M.y,t.pointB.x-=A*M.x,t.pointB.y-=A*M.y}else m=new a,m.x=.5*(t.pointA.x+t.pointB.x),m.y=.5*(t.pointA.y+t.pointB.y),t.pointA.x=t.pointB.x=m.x,t.pointA.y=t.pointB.y=m.y,t.distance=0}},Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new I,Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3),Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}),y.b2DistanceInput=function(){},x.b2DistanceOutput=function(){this.pointA=new a,this.pointB=new a},d.b2DistanceProxy=function(){},d.prototype.Set=function(n){switch(n.GetType()){case i.e_circleShape:var s=n instanceof t?n:null;this.m_vertices=new Vector(1,!0),this.m_vertices[0]=s.m_p,this.m_count=1,this.m_radius=s.m_radius;break;case i.e_polygonShape:var r=n instanceof e?n:null;this.m_vertices=r.m_vertices,this.m_count=r.m_vertexCount,this.m_radius=r.m_radius;break;default:o.b2Assert(!1)}},d.prototype.GetSupport=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;o<this.m_count;++o){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;n>i&&(e=o,i=n)}return e},d.prototype.GetSupportVertex=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;o<this.m_count;++o){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;n>i&&(e=o,i=n)}return this.m_vertices[e]},d.prototype.GetVertexCount=function(){return this.m_count},d.prototype.GetVertex=function(t){return void 0===t&&(t=0),o.b2Assert(t>=0&&t<this.m_count),this.m_vertices[t]},f.b2DynamicTree=function(){},f.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},f.prototype.CreateProxy=function(t,e){var i=this.AllocateNode(),n=o.b2_aabbExtension,s=o.b2_aabbExtension;return i.aabb.lowerBound.x=t.lowerBound.x-n,i.aabb.lowerBound.y=t.lowerBound.y-s,i.aabb.upperBound.x=t.upperBound.x+n,i.aabb.upperBound.y=t.upperBound.y+s,i.userData=e,this.InsertLeaf(i),i},f.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),this.FreeNode(t)},f.prototype.MoveProxy=function(t,e,i){if(o.b2Assert(t.IsLeaf()),t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var n=o.b2_aabbExtension+o.b2_aabbMultiplier*(i.x>0?i.x:-i.x),s=o.b2_aabbExtension+o.b2_aabbMultiplier*(i.y>0?i.y:-i.y);return t.aabb.lowerBound.x=e.lowerBound.x-n,t.aabb.lowerBound.y=e.lowerBound.y-s,t.aabb.upperBound.x=e.upperBound.x+n,t.aabb.upperBound.y=e.upperBound.y+s,this.InsertLeaf(t),!0},f.prototype.Rebalance=function(t){if(void 0===t&&(t=0),null!=this.m_root)for(var e=0;t>e;e++){for(var i=this.m_root,o=0;0==i.IsLeaf();)i=1&this.m_path>>o?i.child2:i.child1,o=31&o+1;++this.m_path,this.RemoveLeaf(i),this.InsertLeaf(i)}},f.prototype.GetFatAABB=function(t){return t.aabb},f.prototype.GetUserData=function(t){return t.userData},f.prototype.Query=function(t,e){if(null!=this.m_root){var i=new Vector,o=0;for(i[o++]=this.m_root;o>0;){var n=i[--o];if(n.aabb.TestOverlap(e))if(n.IsLeaf()){var s=t(n);if(!s)return}else i[o++]=n.child1,i[o++]=n.child2}}},f.prototype.RayCast=function(t,e){if(null!=this.m_root){var i=e.p1,o=e.p2,s=n.SubtractVV(i,o);s.Normalize();var r=n.CrossFV(1,s),a=n.AbsV(r),h=e.maxFraction,c=new l,m=0,_=0;m=i.x+h*(o.x-i.x),_=i.y+h*(o.y-i.y),c.lowerBound.x=Math.min(i.x,m),c.lowerBound.y=Math.min(i.y,_),c.upperBound.x=Math.max(i.x,m),c.upperBound.y=Math.max(i.y,_);var u=new Vector,p=0;for(u[p++]=this.m_root;p>0;){var y=u[--p];if(0!=y.aabb.TestOverlap(c)){var x=y.aabb.GetCenter(),d=y.aabb.GetExtents(),f=Math.abs(r.x*(i.x-x.x)+r.y*(i.y-x.y))-a.x*d.x-a.y*d.y;if(!(f>0))if(y.IsLeaf()){var v=new w;if(v.p1=e.p1,v.p2=e.p2,v.maxFraction=e.maxFraction,h=t(v,y),0==h)return;h>0&&(m=i.x+h*(o.x-i.x),_=i.y+h*(o.y-i.y),c.lowerBound.x=Math.min(i.x,m),c.lowerBound.y=Math.min(i.y,_),c.upperBound.x=Math.max(i.x,m),c.upperBound.y=Math.max(i.y,_))}else u[p++]=y.child1,u[p++]=y.child2}}}},f.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t}return new b},f.prototype.FreeNode=function(t){t.parent=this.m_freeList,this.m_freeList=t},f.prototype.InsertLeaf=function(t){if(++this.m_insertionCount,null==this.m_root)return this.m_root=t,this.m_root.parent=null,void 0;var e=t.aabb.GetCenter(),i=this.m_root;if(0==i.IsLeaf())do{var o=i.child1,n=i.child2,s=Math.abs((o.aabb.lowerBound.x+o.aabb.upperBound.x)/2-e.x)+Math.abs((o.aabb.lowerBound.y+o.aabb.upperBound.y)/2-e.y),r=Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-e.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-e.y);i=r>s?o:n}while(0==i.IsLeaf());var a=i.parent,l=this.AllocateNode();if(l.parent=a,l.userData=null,l.aabb.Combine(t.aabb,i.aabb),a){i.parent.child1==i?a.child1=l:a.child2=l,l.child1=i,l.child2=t,i.parent=l,t.parent=l;do{if(a.aabb.Contains(l.aabb))break;a.aabb.Combine(a.child1.aabb,a.child2.aabb),l=a,a=a.parent}while(a)}else l.child1=i,l.child2=t,i.parent=l,t.parent=l,this.m_root=l},f.prototype.RemoveLeaf=function(t){if(t==this.m_root)return this.m_root=null,void 0;var e,i=t.parent,o=i.parent;if(e=i.child1==t?i.child2:i.child1,o)for(o.child1==i?o.child1=e:o.child2=e,e.parent=o,this.FreeNode(i);o;){var n=o.aabb;if(o.aabb=l.Combine(o.child1.aabb,o.child2.aabb),n.Contains(o.aabb))break;o=o.parent}else this.m_root=e,e.parent=null,this.FreeNode(i)},v.b2DynamicTreeBroadPhase=function(){this.m_tree=new f,this.m_moveBuffer=new Vector,this.m_pairBuffer=new Vector,this.m_pairCount=0},v.prototype.CreateProxy=function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i},v.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},v.prototype.MoveProxy=function(t,e,i){var o=this.m_tree.MoveProxy(t,e,i);o&&this.BufferMove(t)},v.prototype.TestOverlap=function(t,e){var i=this.m_tree.GetFatAABB(t),o=this.m_tree.GetFatAABB(e);return i.TestOverlap(o)},v.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)},v.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)},v.prototype.GetProxyCount=function(){return this.m_proxyCount},v.prototype.UpdatePairs=function(t){function e(t){if(t==o)return!0;i.m_pairCount==i.m_pairBuffer.length&&(i.m_pairBuffer[i.m_pairCount]=new g);var e=i.m_pairBuffer[i.m_pairCount];return e.proxyA=o>t?t:o,e.proxyB=t>=o?t:o,++i.m_pairCount,!0}var i=this;i.m_pairCount=0;var o,n=0;for(n=0;n<i.m_moveBuffer.length;++n){o=i.m_moveBuffer[n];var s=i.m_tree.GetFatAABB(o);i.m_tree.Query(e,s)}i.m_moveBuffer.length=0;for(var n=0;n<i.m_pairCount;){var r=i.m_pairBuffer[n],a=i.m_tree.GetUserData(r.proxyA),l=i.m_tree.GetUserData(r.proxyB);for(t(a,l),++n;n<i.m_pairCount;){var h=i.m_pairBuffer[n];if(h.proxyA!=r.proxyA||h.proxyB!=r.proxyB)break;++n}}},v.prototype.Query=function(t,e){this.m_tree.Query(t,e)},v.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)},v.prototype.Validate=function(){},v.prototype.Rebalance=function(t){void 0===t&&(t=0),this.m_tree.Rebalance(t)},v.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t},v.prototype.UnBufferMove=function(t){var e=parseInt(this.m_moveBuffer.indexOf(t));this.m_moveBuffer.splice(e,1)},v.prototype.ComparePairs=function(){return 0},v.__implements={},v.__implements[E]=!0,b.b2DynamicTreeNode=function(){this.aabb=new l},b.prototype.IsLeaf=function(){return null==this.child1},g.b2DynamicTreePair=function(){},D.b2Manifold=function(){this.m_pointCount=0},D.prototype.b2Manifold=function(){this.m_points=new Vector(o.b2_maxManifoldPoints);for(var t=0;t<o.b2_maxManifoldPoints;t++)this.m_points[t]=new C;this.m_localPlaneNormal=new a,this.m_localPoint=new a},D.prototype.Reset=function(){for(var t=0;t<o.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof C?this.m_points[t]:null).Reset();
this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},D.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var e=0;e<o.b2_maxManifoldPoints;e++)(this.m_points[e]instanceof C?this.m_points[e]:null).Set(t.m_points[e]);this.m_localPlaneNormal.SetV(t.m_localPlaneNormal),this.m_localPoint.SetV(t.m_localPoint),this.m_type=t.m_type},D.prototype.Copy=function(){var t=new D;return t.Set(this),t},Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4}),C.b2ManifoldPoint=function(){this.m_localPoint=new a,this.m_id=new _},C.prototype.b2ManifoldPoint=function(){this.Reset()},C.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},C.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint),this.m_normalImpulse=t.m_normalImpulse,this.m_tangentImpulse=t.m_tangentImpulse,this.m_id.Set(t.m_id)},B.b2Point=function(){this.p=new a},B.prototype.Support=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),this.p},B.prototype.GetFirstVertex=function(){return this.p},w.b2RayCastInput=function(){this.p1=new a,this.p2=new a},w.prototype.b2RayCastInput=function(t,e,i){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=1),t&&this.p1.SetV(t),e&&this.p2.SetV(e),this.maxFraction=i},S.b2RayCastOutput=function(){this.normal=new a},A.b2Segment=function(){this.p1=new a,this.p2=new a},A.prototype.TestSegment=function(t,e,i,o){void 0===o&&(o=0);var n=i.p1,s=i.p2.x-n.x,r=i.p2.y-n.y,a=this.p2.x-this.p1.x,l=this.p2.y-this.p1.y,h=l,c=-a,m=100*Number.MIN_VALUE,_=-(s*h+r*c);if(_>m){var u=n.x-this.p1.x,p=n.y-this.p1.y,y=u*h+p*c;if(y>=0&&o*_>=y){var x=-s*p+r*u;if(x>=-m*_&&_*(1+m)>=x){y/=_;var d=Math.sqrt(h*h+c*c);return h/=d,c/=d,t[0]=y,e.Set(h,c),!0}}}return!1},A.prototype.Extend=function(t){this.ExtendForward(t),this.ExtendBackward(t)},A.prototype.ExtendForward=function(t){var e=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y,o=Math.min(e>0?(t.upperBound.x-this.p1.x)/e:0>e?(t.lowerBound.x-this.p1.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p1.y)/i:0>i?(t.lowerBound.y-this.p1.y)/i:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+e*o,this.p2.y=this.p1.y+i*o},A.prototype.ExtendBackward=function(t){var e=-this.p2.x+this.p1.x,i=-this.p2.y+this.p1.y,o=Math.min(e>0?(t.upperBound.x-this.p2.x)/e:0>e?(t.lowerBound.x-this.p2.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p2.y)/i:0>i?(t.lowerBound.y-this.p2.y)/i:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+e*o,this.p1.y=this.p2.y+i*o},M.b2SeparationFunction=function(){this.m_localPoint=new a,this.m_axis=new a},M.prototype.Initialize=function(t,e,i,s,r){this.m_proxyA=e,this.m_proxyB=s;var l=parseInt(t.count);o.b2Assert(l>0&&3>l);var h,c,m,_,u,p,y,x,d=0,f=0,v=0,b=0,g=0,D=0,C=0,B=0;if(1==l)this.m_type=M.e_points,h=this.m_proxyA.GetVertex(t.indexA[0]),_=this.m_proxyB.GetVertex(t.indexB[0]),x=h,y=i.R,d=i.position.x+(y.col1.x*x.x+y.col2.x*x.y),f=i.position.y+(y.col1.y*x.x+y.col2.y*x.y),x=_,y=r.R,v=r.position.x+(y.col1.x*x.x+y.col2.x*x.y),b=r.position.y+(y.col1.y*x.x+y.col2.y*x.y),this.m_axis.x=v-d,this.m_axis.y=b-f,this.m_axis.Normalize();else if(t.indexB[0]==t.indexB[1])this.m_type=M.e_faceA,c=this.m_proxyA.GetVertex(t.indexA[0]),m=this.m_proxyA.GetVertex(t.indexA[1]),_=this.m_proxyB.GetVertex(t.indexB[0]),this.m_localPoint.x=.5*(c.x+m.x),this.m_localPoint.y=.5*(c.y+m.y),this.m_axis=n.CrossVF(n.SubtractVV(m,c),1),this.m_axis.Normalize(),x=this.m_axis,y=i.R,g=y.col1.x*x.x+y.col2.x*x.y,D=y.col1.y*x.x+y.col2.y*x.y,x=this.m_localPoint,y=i.R,d=i.position.x+(y.col1.x*x.x+y.col2.x*x.y),f=i.position.y+(y.col1.y*x.x+y.col2.y*x.y),x=_,y=r.R,v=r.position.x+(y.col1.x*x.x+y.col2.x*x.y),b=r.position.y+(y.col1.y*x.x+y.col2.y*x.y),C=(v-d)*g+(b-f)*D,0>C&&this.m_axis.NegativeSelf();else if(t.indexA[0]==t.indexA[0])this.m_type=M.e_faceB,u=this.m_proxyB.GetVertex(t.indexB[0]),p=this.m_proxyB.GetVertex(t.indexB[1]),h=this.m_proxyA.GetVertex(t.indexA[0]),this.m_localPoint.x=.5*(u.x+p.x),this.m_localPoint.y=.5*(u.y+p.y),this.m_axis=n.CrossVF(n.SubtractVV(p,u),1),this.m_axis.Normalize(),x=this.m_axis,y=r.R,g=y.col1.x*x.x+y.col2.x*x.y,D=y.col1.y*x.x+y.col2.y*x.y,x=this.m_localPoint,y=r.R,v=r.position.x+(y.col1.x*x.x+y.col2.x*x.y),b=r.position.y+(y.col1.y*x.x+y.col2.y*x.y),x=h,y=i.R,d=i.position.x+(y.col1.x*x.x+y.col2.x*x.y),f=i.position.y+(y.col1.y*x.x+y.col2.y*x.y),C=(d-v)*g+(f-b)*D,0>C&&this.m_axis.NegativeSelf();else{c=this.m_proxyA.GetVertex(t.indexA[0]),m=this.m_proxyA.GetVertex(t.indexA[1]),u=this.m_proxyB.GetVertex(t.indexB[0]),p=this.m_proxyB.GetVertex(t.indexB[1]),n.MulX(i,h);var w=n.MulMV(i.R,n.SubtractVV(m,c));n.MulX(r,_);var S=n.MulMV(r.R,n.SubtractVV(p,u)),A=w.x*w.x+w.y*w.y,I=S.x*S.x+S.y*S.y,V=n.SubtractVV(S,w),L=w.x*V.x+w.y*V.y,P=S.x*V.x+S.y*V.y,T=w.x*S.x+w.y*S.y,G=A*I-T*T;C=0,0!=G&&(C=n.Clamp((T*P-L*I)/G,0,1));var R=(T*C+P)/I;0>R&&(R=0,C=n.Clamp((T-L)/A,0,1)),h=new a,h.x=c.x+C*(m.x-c.x),h.y=c.y+C*(m.y-c.y),_=new a,_.x=u.x+C*(p.x-u.x),_.y=u.y+C*(p.y-u.y),0==C||1==C?(this.m_type=M.e_faceB,this.m_axis=n.CrossVF(n.SubtractVV(p,u),1),this.m_axis.Normalize(),this.m_localPoint=_,x=this.m_axis,y=r.R,g=y.col1.x*x.x+y.col2.x*x.y,D=y.col1.y*x.x+y.col2.y*x.y,x=this.m_localPoint,y=r.R,v=r.position.x+(y.col1.x*x.x+y.col2.x*x.y),b=r.position.y+(y.col1.y*x.x+y.col2.y*x.y),x=h,y=i.R,d=i.position.x+(y.col1.x*x.x+y.col2.x*x.y),f=i.position.y+(y.col1.y*x.x+y.col2.y*x.y),B=(d-v)*g+(f-b)*D,0>C&&this.m_axis.NegativeSelf()):(this.m_type=M.e_faceA,this.m_axis=n.CrossVF(n.SubtractVV(m,c),1),this.m_localPoint=h,x=this.m_axis,y=i.R,g=y.col1.x*x.x+y.col2.x*x.y,D=y.col1.y*x.x+y.col2.y*x.y,x=this.m_localPoint,y=i.R,d=i.position.x+(y.col1.x*x.x+y.col2.x*x.y),f=i.position.y+(y.col1.y*x.x+y.col2.y*x.y),x=_,y=r.R,v=r.position.x+(y.col1.x*x.x+y.col2.x*x.y),b=r.position.y+(y.col1.y*x.x+y.col2.y*x.y),B=(v-d)*g+(b-f)*D,0>C&&this.m_axis.NegativeSelf())}},M.prototype.Evaluate=function(t,e){var i,s,r,a,l,h,c,m=0;switch(this.m_type){case M.e_points:return i=n.MulTMV(t.R,this.m_axis),s=n.MulTMV(e.R,this.m_axis.GetNegative()),r=this.m_proxyA.GetSupportVertex(i),a=this.m_proxyB.GetSupportVertex(s),l=n.MulX(t,r),h=n.MulX(e,a),m=(h.x-l.x)*this.m_axis.x+(h.y-l.y)*this.m_axis.y;case M.e_faceA:return c=n.MulMV(t.R,this.m_axis),l=n.MulX(t,this.m_localPoint),s=n.MulTMV(e.R,c.GetNegative()),a=this.m_proxyB.GetSupportVertex(s),h=n.MulX(e,a),m=(h.x-l.x)*c.x+(h.y-l.y)*c.y;case M.e_faceB:return c=n.MulMV(e.R,this.m_axis),h=n.MulX(e,this.m_localPoint),i=n.MulTMV(t.R,c.GetNegative()),r=this.m_proxyA.GetSupportVertex(i),l=n.MulX(t,r),m=(l.x-h.x)*c.x+(l.y-h.y)*c.y;default:return o.b2Assert(!1),0}},Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4}),I.b2Simplex=function(){this.m_v1=new L,this.m_v2=new L,this.m_v3=new L,this.m_vertices=new Vector(3)},I.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},I.prototype.ReadCache=function(t,e,i,s,r){o.b2Assert(0<=t.count&&t.count<=3);var a,l;this.m_count=t.count;for(var h=this.m_vertices,c=0;c<this.m_count;c++){var m=h[c];m.indexA=t.indexA[c],m.indexB=t.indexB[c],a=e.GetVertex(m.indexA),l=s.GetVertex(m.indexB),m.wA=n.MulX(i,a),m.wB=n.MulX(r,l),m.w=n.SubtractVV(m.wB,m.wA),m.a=0}if(this.m_count>1){var _=t.metric,u=this.GetMetric();(.5*_>u||u>2*_||u<Number.MIN_VALUE)&&(this.m_count=0)}0==this.m_count&&(m=h[0],m.indexA=0,m.indexB=0,a=e.GetVertex(0),l=s.GetVertex(0),m.wA=n.MulX(i,a),m.wB=n.MulX(r,l),m.w=n.SubtractVV(m.wB,m.wA),this.m_count=1)},I.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=Box2D.parseUInt(this.m_count);for(var e=this.m_vertices,i=0;i<this.m_count;i++)t.indexA[i]=Box2D.parseUInt(e[i].indexA),t.indexB[i]=Box2D.parseUInt(e[i].indexB)},I.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var t=n.SubtractVV(this.m_v2.w,this.m_v1.w),e=n.CrossVV(t,this.m_v1.w.GetNegative());return e>0?n.CrossFV(1,t):n.CrossVF(t,1);default:return o.b2Assert(!1),new a}},I.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return o.b2Assert(!1),new a;case 1:return this.m_v1.w;case 2:return new a(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return o.b2Assert(!1),new a}},I.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:o.b2Assert(!1);break;case 1:t.SetV(this.m_v1.wA),e.SetV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:o.b2Assert(!1)}},I.prototype.GetMetric=function(){switch(this.m_count){case 0:return o.b2Assert(!1),0;case 1:return 0;case 2:return n.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return n.CrossVV(n.SubtractVV(this.m_v2.w,this.m_v1.w),n.SubtractVV(this.m_v3.w,this.m_v1.w));default:return o.b2Assert(!1),0}},I.prototype.Solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,i=n.SubtractVV(e,t),o=-(t.x*i.x+t.y*i.y);if(0>=o)return this.m_v1.a=1,this.m_count=1,void 0;var s=e.x*i.x+e.y*i.y;if(0>=s)return this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2),void 0;var r=1/(s+o);this.m_v1.a=s*r,this.m_v2.a=o*r,this.m_count=2},I.prototype.Solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,o=n.SubtractVV(e,t),s=n.Dot(t,o),r=n.Dot(e,o),a=r,l=-s,h=n.SubtractVV(i,t),c=n.Dot(t,h),m=n.Dot(i,h),_=m,u=-c,p=n.SubtractVV(i,e),y=n.Dot(e,p),x=n.Dot(i,p),d=x,f=-y,v=n.CrossVV(o,h),b=v*n.CrossVV(e,i),g=v*n.CrossVV(i,t),D=v*n.CrossVV(t,e);if(0>=l&&0>=u)return this.m_v1.a=1,this.m_count=1,void 0;if(a>0&&l>0&&0>=D){var C=1/(a+l);return this.m_v1.a=a*C,this.m_v2.a=l*C,this.m_count=2,void 0}if(_>0&&u>0&&0>=g){var B=1/(_+u);return this.m_v1.a=_*B,this.m_v3.a=u*B,this.m_count=2,this.m_v2.Set(this.m_v3),void 0}if(0>=a&&0>=f)return this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2),void 0;if(0>=_&&0>=d)return this.m_v3.a=1,this.m_count=1,this.m_v1.Set(this.m_v3),void 0;if(d>0&&f>0&&0>=b){var w=1/(d+f);return this.m_v2.a=d*w,this.m_v3.a=f*w,this.m_count=2,this.m_v1.Set(this.m_v3),void 0}var S=1/(b+g+D);this.m_v1.a=b*S,this.m_v2.a=g*S,this.m_v3.a=D*S,this.m_count=3},V.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3),this.indexB=new Vector_a2j_Number(3)},L.b2SimplexVertex=function(){},L.prototype.Set=function(t){this.wA.SetV(t.wA),this.wB.SetV(t.wB),this.w.SetV(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB},P.b2TimeOfImpact=function(){},P.TimeOfImpact=function(t){++P.b2_toiCalls;var e=t.proxyA,i=t.proxyB,s=t.sweepA,r=t.sweepB;o.b2Assert(s.t0==r.t0),o.b2Assert(1-s.t0>Number.MIN_VALUE);var a=e.m_radius+i.m_radius,l=t.tolerance,h=0,c=1e3,m=0,_=0;for(P.s_cache.count=0,P.s_distanceInput.useRadii=!1;;){if(s.GetTransform(P.s_xfA,h),r.GetTransform(P.s_xfB,h),P.s_distanceInput.proxyA=e,P.s_distanceInput.proxyB=i,P.s_distanceInput.transformA=P.s_xfA,P.s_distanceInput.transformB=P.s_xfB,p.Distance(P.s_distanceOutput,P.s_cache,P.s_distanceInput),P.s_distanceOutput.distance<=0){h=1;break}P.s_fcn.Initialize(P.s_cache,e,P.s_xfA,i,P.s_xfB);var u=P.s_fcn.Evaluate(P.s_xfA,P.s_xfB);if(0>=u){h=1;break}if(0==m&&(_=u>a?n.Max(a-l,.75*a):n.Max(u-l,.02*a)),.5*l>u-_){if(0==m){h=1;break}break}var y=h,x=h,d=1,f=u;s.GetTransform(P.s_xfA,d),r.GetTransform(P.s_xfB,d);var v=P.s_fcn.Evaluate(P.s_xfA,P.s_xfB);if(v>=_){h=1;break}for(var b=0;;){var g=0;g=1&b?x+(_-f)*(d-x)/(v-f):.5*(x+d),s.GetTransform(P.s_xfA,g),r.GetTransform(P.s_xfB,g);var D=P.s_fcn.Evaluate(P.s_xfA,P.s_xfB);if(n.Abs(D-_)<.025*l){y=g;break}if(D>_?(x=g,f=D):(d=g,v=D),++b,++P.b2_toiRootIters,50==b)break}if(P.b2_toiMaxRootIters=n.Max(P.b2_toiMaxRootIters,b),y<(1+100*Number.MIN_VALUE)*h)break;if(h=y,m++,++P.b2_toiIters,m==c)break}return P.b2_toiMaxIters=n.Max(P.b2_toiMaxIters,m),h},Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new V,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new y,Box2D.Collision.b2TimeOfImpact.s_xfA=new r,Box2D.Collision.b2TimeOfImpact.s_xfB=new r,Box2D.Collision.b2TimeOfImpact.s_fcn=new M,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new x}),T.b2TOIInput=function(){this.proxyA=new d,this.proxyB=new d,this.sweepA=new s,this.sweepB=new s},G.b2WorldManifold=function(){this.m_normal=new a},G.prototype.b2WorldManifold=function(){this.m_points=new Vector(o.b2_maxManifoldPoints);for(var t=0;t<o.b2_maxManifoldPoints;t++)this.m_points[t]=new a},G.prototype.Initialize=function(t,e,i,o,n){if(void 0===i&&(i=0),void 0===n&&(n=0),0!=t.m_pointCount){var s,r,a=0,l=0,h=0,c=0,m=0,_=0,u=0;switch(t.m_type){case D.e_circles:r=e.R,s=t.m_localPoint;var p=e.position.x+r.col1.x*s.x+r.col2.x*s.y,y=e.position.y+r.col1.y*s.x+r.col2.y*s.y;r=o.R,s=t.m_points[0].m_localPoint;var x=o.position.x+r.col1.x*s.x+r.col2.x*s.y,d=o.position.y+r.col1.y*s.x+r.col2.y*s.y,f=x-p,v=d-y,b=f*f+v*v;if(b>Number.MIN_VALUE*Number.MIN_VALUE){var g=Math.sqrt(b);this.m_normal.x=f/g,this.m_normal.y=v/g}else this.m_normal.x=1,this.m_normal.y=0;var C=p+i*this.m_normal.x,B=y+i*this.m_normal.y,w=x-n*this.m_normal.x,S=d-n*this.m_normal.y;this.m_points[0].x=.5*(C+w),this.m_points[0].y=.5*(B+S);break;case D.e_faceA:for(r=e.R,s=t.m_localPlaneNormal,l=r.col1.x*s.x+r.col2.x*s.y,h=r.col1.y*s.x+r.col2.y*s.y,r=e.R,s=t.m_localPoint,c=e.position.x+r.col1.x*s.x+r.col2.x*s.y,m=e.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_normal.x=l,this.m_normal.y=h,a=0;a<t.m_pointCount;a++)r=o.R,s=t.m_points[a].m_localPoint,_=o.position.x+r.col1.x*s.x+r.col2.x*s.y,u=o.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_points[a].x=_+.5*(i-(_-c)*l-(u-m)*h-n)*l,this.m_points[a].y=u+.5*(i-(_-c)*l-(u-m)*h-n)*h;break;case D.e_faceB:for(r=o.R,s=t.m_localPlaneNormal,l=r.col1.x*s.x+r.col2.x*s.y,h=r.col1.y*s.x+r.col2.y*s.y,r=o.R,s=t.m_localPoint,c=o.position.x+r.col1.x*s.x+r.col2.x*s.y,m=o.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_normal.x=-l,this.m_normal.y=-h,a=0;a<t.m_pointCount;a++)r=e.R,s=t.m_points[a].m_localPoint,_=e.position.x+r.col1.x*s.x+r.col2.x*s.y,u=e.position.y+r.col1.y*s.x+r.col2.y*s.y,this.m_points[a].x=_+.5*(n-(_-c)*l-(u-m)*h-i)*l,this.m_points[a].y=u+.5*(n-(_-c)*l-(u-m)*h-i)*h}}},R.ClipVertex=function(){this.v=new a,this.id=new _},R.prototype.Set=function(t){this.v.SetV(t.v),this.id.Set(t.id)},F.Features=function(){},Object.defineProperty(F.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(F.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._referenceEdge=t,this._m_id._key=4294967040&this._m_id._key|255&this._referenceEdge}}),Object.defineProperty(F.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(F.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._incidentEdge=t,this._m_id._key=4294902015&this._m_id._key|65280&this._incidentEdge<<8}}),Object.defineProperty(F.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(F.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._incidentVertex=t,this._m_id._key=4278255615&this._m_id._key|16711680&this._incidentVertex<<16}}),Object.defineProperty(F.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(F.prototype,"flip",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._flip=t,this._m_id._key=16777215&this._m_id._key|4278190080&this._flip<<24}})}(),function(){var t=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),e=Box2D.Collision.Shapes.b2CircleShape,i=Box2D.Collision.Shapes.b2EdgeChainDef,o=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2MassData,s=Box2D.Collision.Shapes.b2PolygonShape,r=Box2D.Collision.Shapes.b2Shape,a=Box2D.Common.Math.b2Mat22,l=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),h=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform),c=Box2D.Common.Math.b2Vec2,m=(Box2D.Common.Math.b2Vec3,Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World,Box2D.Collision.b2AABB,Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision,Box2D.Collision.b2ContactID,Box2D.Collision.b2ContactPoint,Box2D.Collision.b2Distance),_=Box2D.Collision.b2DistanceInput,u=Box2D.Collision.b2DistanceOutput,p=Box2D.Collision.b2DistanceProxy,y=(Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold,Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput,Box2D.Collision.b2RayCastOutput,Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache);Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact,Box2D.Collision.b2TOIInput,Box2D.Collision.b2WorldManifold,Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase,Box2D.inherit(e,Box2D.Collision.Shapes.b2Shape),e.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,e.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new c},e.prototype.Copy=function(){var t=new e;return t.Set(this),t},e.prototype.Set=function(t){if(this.__super.Set.call(this,t),Box2D.is(t,e)){var i=t instanceof e?t:null;this.m_p.SetV(i.m_p)}},e.prototype.TestPoint=function(t,e){var i=t.R,o=t.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),n=t.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);return o=e.x-o,n=e.y-n,o*o+n*n<=this.m_radius*this.m_radius},e.prototype.RayCast=function(t,e,i){var o=i.R,n=i.position.x+(o.col1.x*this.m_p.x+o.col2.x*this.m_p.y),s=i.position.y+(o.col1.y*this.m_p.x+o.col2.y*this.m_p.y),r=e.p1.x-n,a=e.p1.y-s,l=r*r+a*a-this.m_radius*this.m_radius,h=e.p2.x-e.p1.x,c=e.p2.y-e.p1.y,m=r*h+a*c,_=h*h+c*c,u=m*m-_*l;if(0>u||_<Number.MIN_VALUE)return!1;var p=-(m+Math.sqrt(u));return p>=0&&p<=e.maxFraction*_?(p/=_,t.fraction=p,t.normal.x=r+p*h,t.normal.y=a+p*c,t.normal.Normalize(),!0):!1},e.prototype.ComputeAABB=function(t,e){var i=e.R,o=e.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),n=e.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);t.lowerBound.Set(o-this.m_radius,n-this.m_radius),t.upperBound.Set(o+this.m_radius,n+this.m_radius)},e.prototype.ComputeMass=function(e,i){void 0===i&&(i=0),e.mass=i*t.b2_pi*this.m_radius*this.m_radius,e.center.SetV(this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},e.prototype.ComputeSubmergedArea=function(t,e,i,o){void 0===e&&(e=0);var n=l.MulX(i,this.m_p),s=-(l.Dot(t,n)-e);if(s<-this.m_radius+Number.MIN_VALUE)return 0;if(s>this.m_radius)return o.SetV(n),Math.PI*this.m_radius*this.m_radius;var r=this.m_radius*this.m_radius,a=s*s,h=r*(Math.asin(s/this.m_radius)+Math.PI/2)+s*Math.sqrt(r-a),c=-2/3*Math.pow(r-a,1.5)/h;return o.x=n.x+t.x*c,o.y=n.y+t.y*c,h},e.prototype.GetLocalPosition=function(){return this.m_p},e.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)},e.prototype.GetRadius=function(){return this.m_radius},e.prototype.SetRadius=function(t){void 0===t&&(t=0),this.m_radius=t},e.prototype.b2CircleShape=function(t){void 0===t&&(t=0),this.__super.b2Shape.call(this),this.m_type=r.e_circleShape,this.m_radius=t},i.b2EdgeChainDef=function(){},i.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.inherit(o,Box2D.Collision.Shapes.b2Shape),o.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,o.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new c,this.m_v1=new c,this.m_v2=new c,this.m_coreV1=new c,this.m_coreV2=new c,this.m_normal=new c,this.m_direction=new c,this.m_cornerDir1=new c,this.m_cornerDir2=new c},o.prototype.TestPoint=function(){return!1},o.prototype.RayCast=function(t,e,i){var o,n=e.p2.x-e.p1.x,s=e.p2.y-e.p1.y;o=i.R;var r=i.position.x+(o.col1.x*this.m_v1.x+o.col2.x*this.m_v1.y),a=i.position.y+(o.col1.y*this.m_v1.x+o.col2.y*this.m_v1.y),l=i.position.y+(o.col1.y*this.m_v2.x+o.col2.y*this.m_v2.y)-a,h=-(i.position.x+(o.col1.x*this.m_v2.x+o.col2.x*this.m_v2.y)-r),c=100*Number.MIN_VALUE,m=-(n*l+s*h);if(m>c){var _=e.p1.x-r,u=e.p1.y-a,p=_*l+u*h;if(p>=0&&p<=e.maxFraction*m){var y=-n*u+s*_;if(y>=-c*m&&m*(1+c)>=y){p/=m,t.fraction=p;var x=Math.sqrt(l*l+h*h);return t.normal.x=l/x,t.normal.y=h/x,!0}}}return!1},o.prototype.ComputeAABB=function(t,e){var i=e.R,o=e.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y),n=e.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y),s=e.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y),r=e.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);s>o?(t.lowerBound.x=o,t.upperBound.x=s):(t.lowerBound.x=s,t.upperBound.x=o),r>n?(t.lowerBound.y=n,t.upperBound.y=r):(t.lowerBound.y=r,t.upperBound.y=n)},o.prototype.ComputeMass=function(t,e){void 0===e&&(e=0),t.mass=0,t.center.SetV(this.m_v1),t.I=0},o.prototype.ComputeSubmergedArea=function(t,e,i,o){void 0===e&&(e=0);var n=new c(t.x*e,t.y*e),s=l.MulX(i,this.m_v1),r=l.MulX(i,this.m_v2),a=l.Dot(t,s)-e,h=l.Dot(t,r)-e;if(a>0){if(h>0)return 0;s.x=-h/(a-h)*s.x+a/(a-h)*r.x,s.y=-h/(a-h)*s.y+a/(a-h)*r.y}else h>0&&(r.x=-h/(a-h)*s.x+a/(a-h)*r.x,r.y=-h/(a-h)*s.y+a/(a-h)*r.y);return o.x=(n.x+s.x+r.x)/3,o.y=(n.y+s.y+r.y)/3,.5*((s.x-n.x)*(r.y-n.y)-(s.y-n.y)*(r.x-n.x))},o.prototype.GetLength=function(){return this.m_length},o.prototype.GetVertex1=function(){return this.m_v1},o.prototype.GetVertex2=function(){return this.m_v2},o.prototype.GetCoreVertex1=function(){return this.m_coreV1},o.prototype.GetCoreVertex2=function(){return this.m_coreV2},o.prototype.GetNormalVector=function(){return this.m_normal},o.prototype.GetDirectionVector=function(){return this.m_direction},o.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},o.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},o.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},o.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},o.prototype.GetFirstVertex=function(t){var e=t.R;return new c(t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y))},o.prototype.GetNextEdge=function(){return this.m_nextEdge},o.prototype.GetPrevEdge=function(){return this.m_prevEdge},o.prototype.Support=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var o=t.R,n=t.position.x+(o.col1.x*this.m_coreV1.x+o.col2.x*this.m_coreV1.y),s=t.position.y+(o.col1.y*this.m_coreV1.x+o.col2.y*this.m_coreV1.y),r=t.position.x+(o.col1.x*this.m_coreV2.x+o.col2.x*this.m_coreV2.y),a=t.position.y+(o.col1.y*this.m_coreV2.x+o.col2.y*this.m_coreV2.y);return n*e+s*i>r*e+a*i?(this.s_supportVec.x=n,this.s_supportVec.y=s):(this.s_supportVec.x=r,this.s_supportVec.y=a),this.s_supportVec},o.prototype.b2EdgeShape=function(e,i){this.__super.b2Shape.call(this),this.m_type=r.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=e,this.m_v2=i,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-t.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-t.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-t.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-t.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},o.prototype.SetPrevEdge=function(t,e,i,o){this.m_prevEdge=t,this.m_coreV1=e,this.m_cornerDir1=i,this.m_cornerConvex1=o},o.prototype.SetNextEdge=function(t,e,i,o){this.m_nextEdge=t,this.m_coreV2=e,this.m_cornerDir2=i,this.m_cornerConvex2=o},n.b2MassData=function(){this.mass=0,this.center=new c(0,0),this.I=0},Box2D.inherit(s,Box2D.Collision.Shapes.b2Shape),s.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,s.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},s.prototype.Copy=function(){var t=new s;return t.Set(this),t},s.prototype.Set=function(t){if(this.__super.Set.call(this,t),Box2D.is(t,s)){var e=t instanceof s?t:null;this.m_centroid.SetV(e.m_centroid),this.m_vertexCount=e.m_vertexCount,this.Reserve(this.m_vertexCount);for(var i=0;i<this.m_vertexCount;i++)this.m_vertices[i].SetV(e.m_vertices[i]),this.m_normals[i].SetV(e.m_normals[i])}},s.prototype.SetAsArray=function(t,e){void 0===e&&(e=0);var i,o=new Vector,n=0;for(n=0;n<t.length;++n)i=t[n],o.push(i);this.SetAsVector(o,e)},s.AsArray=function(t,e){void 0===e&&(e=0);var i=new s;return i.SetAsArray(t,e),i},s.prototype.SetAsVector=function(e,i){void 0===i&&(i=0),0==i&&(i=e.length),t.b2Assert(i>=2),this.m_vertexCount=i,this.Reserve(i);var o=0;for(o=0;o<this.m_vertexCount;o++)this.m_vertices[o].SetV(e[o]);for(o=0;o<this.m_vertexCount;++o){var n=parseInt(o),r=parseInt(o+1<this.m_vertexCount?o+1:0),a=l.SubtractVV(this.m_vertices[r],this.m_vertices[n]);t.b2Assert(a.LengthSquared()>Number.MIN_VALUE),this.m_normals[o].SetV(l.CrossVF(a,1)),this.m_normals[o].Normalize()}this.m_centroid=s.ComputeCentroid(this.m_vertices,this.m_vertexCount)},s.AsVector=function(t,e){void 0===e&&(e=0);var i=new s;return i.SetAsVector(t,e),i},s.prototype.SetAsBox=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},s.AsBox=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=new s;return i.SetAsBox(t,e),i},s.prototype.SetAsOrientedBox=function(t,e,i,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=null),void 0===o&&(o=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=i;var n=new h;n.position=i,n.R.Set(o);for(var s=0;s<this.m_vertexCount;++s)this.m_vertices[s]=l.MulX(n,this.m_vertices[s]),this.m_normals[s]=l.MulMV(n.R,this.m_normals[s])},s.AsOrientedBox=function(t,e,i,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=null),void 0===o&&(o=0);var n=new s;return n.SetAsOrientedBox(t,e,i,o),n},s.prototype.SetAsEdge=function(t,e){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(t),this.m_vertices[1].SetV(e),this.m_centroid.x=.5*(t.x+e.x),this.m_centroid.y=.5*(t.y+e.y),this.m_normals[0]=l.CrossVF(l.SubtractVV(e,t),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},s.AsEdge=function(t,e){var i=new s;return i.SetAsEdge(t,e),i},s.prototype.TestPoint=function(t,e){for(var i,o=t.R,n=e.x-t.position.x,s=e.y-t.position.y,r=n*o.col1.x+s*o.col1.y,a=n*o.col2.x+s*o.col2.y,l=0;l<this.m_vertexCount;++l){i=this.m_vertices[l],n=r-i.x,s=a-i.y,i=this.m_normals[l];var h=i.x*n+i.y*s;if(h>0)return!1}return!0},s.prototype.RayCast=function(t,e,i){var o,n,s=0,r=e.maxFraction,a=0,l=0;a=e.p1.x-i.position.x,l=e.p1.y-i.position.y,o=i.R;var h=a*o.col1.x+l*o.col1.y,c=a*o.col2.x+l*o.col2.y;a=e.p2.x-i.position.x,l=e.p2.y-i.position.y,o=i.R;for(var m=a*o.col1.x+l*o.col1.y,_=a*o.col2.x+l*o.col2.y,u=m-h,p=_-c,y=parseInt(-1),x=0;x<this.m_vertexCount;++x){n=this.m_vertices[x],a=n.x-h,l=n.y-c,n=this.m_normals[x];var d=n.x*a+n.y*l,f=n.x*u+n.y*p;if(0==f){if(0>d)return!1}else 0>f&&s*f>d?(s=d/f,y=x):f>0&&r*f>d&&(r=d/f);if(r<s-Number.MIN_VALUE)return!1}return y>=0?(t.fraction=s,o=i.R,n=this.m_normals[y],t.normal.x=o.col1.x*n.x+o.col2.x*n.y,t.normal.y=o.col1.y*n.x+o.col2.y*n.y,!0):!1},s.prototype.ComputeAABB=function(t,e){for(var i=e.R,o=this.m_vertices[0],n=e.position.x+(i.col1.x*o.x+i.col2.x*o.y),s=e.position.y+(i.col1.y*o.x+i.col2.y*o.y),r=n,a=s,l=1;l<this.m_vertexCount;++l){o=this.m_vertices[l];var h=e.position.x+(i.col1.x*o.x+i.col2.x*o.y),c=e.position.y+(i.col1.y*o.x+i.col2.y*o.y);n=h>n?n:h,s=c>s?s:c,r=r>h?r:h,a=a>c?a:c}t.lowerBound.x=n-this.m_radius,t.lowerBound.y=s-this.m_radius,t.upperBound.x=r+this.m_radius,t.upperBound.y=a+this.m_radius},s.prototype.ComputeMass=function(t,e){if(void 0===e&&(e=0),2==this.m_vertexCount)return t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),t.mass=0,t.I=0,void 0;for(var i=0,o=0,n=0,s=0,r=0,a=0,l=1/3,h=0;h<this.m_vertexCount;++h){var c=this.m_vertices[h],m=h+1<this.m_vertexCount?this.m_vertices[parseInt(h+1)]:this.m_vertices[0],_=c.x-r,u=c.y-a,p=m.x-r,y=m.y-a,x=_*y-u*p,d=.5*x;n+=d,i+=d*l*(r+c.x+m.x),o+=d*l*(a+c.y+m.y);var f=r,v=a,b=_,g=u,D=p,C=y,B=l*(.25*(b*b+D*b+D*D)+(f*b+f*D))+.5*f*f,w=l*(.25*(g*g+C*g+C*C)+(v*g+v*C))+.5*v*v;s+=x*(B+w)}t.mass=e*n,i*=1/n,o*=1/n,t.center.Set(i,o),t.I=e*s},s.prototype.ComputeSubmergedArea=function(t,e,i,o){void 0===e&&(e=0);var s=l.MulTMV(i.R,t),r=e-l.Dot(t,i.position),a=new Vector_a2j_Number,h=0,m=parseInt(-1),_=parseInt(-1),u=!1,p=0;for(p=0;p<this.m_vertexCount;++p){a[p]=l.Dot(s,this.m_vertices[p])-r;var y=a[p]<-Number.MIN_VALUE;p>0&&(y?u||(m=p-1,h++):u&&(_=p-1,h++)),u=y}switch(h){case 0:if(u){var x=new n;return this.ComputeMass(x,1),o.SetV(l.MulX(i,x.center)),x.mass}return 0;case 1:-1==m?m=this.m_vertexCount-1:_=this.m_vertexCount-1}var d,f=parseInt((m+1)%this.m_vertexCount),v=parseInt((_+1)%this.m_vertexCount),b=(0-a[m])/(a[f]-a[m]),g=(0-a[_])/(a[v]-a[_]),D=new c(this.m_vertices[m].x*(1-b)+this.m_vertices[f].x*b,this.m_vertices[m].y*(1-b)+this.m_vertices[f].y*b),C=new c(this.m_vertices[_].x*(1-g)+this.m_vertices[v].x*g,this.m_vertices[_].y*(1-g)+this.m_vertices[v].y*g),B=0,w=new c,S=this.m_vertices[f];for(p=f;p!=v;){p=(p+1)%this.m_vertexCount,d=p==v?C:this.m_vertices[p];var A=.5*((S.x-D.x)*(d.y-D.y)-(S.y-D.y)*(d.x-D.x));B+=A,w.x+=A*(D.x+S.x+d.x)/3,w.y+=A*(D.y+S.y+d.y)/3,S=d}return w.Multiply(1/B),o.SetV(l.MulX(i,w)),B},s.prototype.GetVertexCount=function(){return this.m_vertexCount},s.prototype.GetVertices=function(){return this.m_vertices},s.prototype.GetNormals=function(){return this.m_normals},s.prototype.GetSupport=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;o<this.m_vertexCount;++o){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;n>i&&(e=o,i=n)}return e},s.prototype.GetSupportVertex=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;o<this.m_vertexCount;++o){var n=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;n>i&&(e=o,i=n)}return this.m_vertices[e]},s.prototype.Validate=function(){return!1},s.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=r.e_polygonShape,this.m_centroid=new c,this.m_vertices=new Vector,this.m_normals=new Vector},s.prototype.Reserve=function(t){void 0===t&&(t=0);for(var e=parseInt(this.m_vertices.length);t>e;e++)this.m_vertices[e]=new c,this.m_normals[e]=new c
},s.ComputeCentroid=function(t,e){void 0===e&&(e=0);for(var i=new c,o=0,n=0,s=0,r=1/3,a=0;e>a;++a){var l=t[a],h=e>a+1?t[parseInt(a+1)]:t[0],m=l.x-n,_=l.y-s,u=h.x-n,p=h.y-s,y=m*p-_*u,x=.5*y;o+=x,i.x+=x*r*(n+l.x+h.x),i.y+=x*r*(s+l.y+h.y)}return i.x*=1/o,i.y*=1/o,i},s.ComputeOBB=function(t,e,i){void 0===i&&(i=0);var o=0,n=new Vector(i+1);for(o=0;i>o;++o)n[o]=e[o];n[i]=n[0];var s=Number.MAX_VALUE;for(o=1;i>=o;++o){var r=n[parseInt(o-1)],a=n[o].x-r.x,l=n[o].y-r.y,h=Math.sqrt(a*a+l*l);a/=h,l/=h;for(var c=-l,m=a,_=Number.MAX_VALUE,u=Number.MAX_VALUE,p=-Number.MAX_VALUE,y=-Number.MAX_VALUE,x=0;i>x;++x){var d=n[x].x-r.x,f=n[x].y-r.y,v=a*d+l*f,b=c*d+m*f;_>v&&(_=v),u>b&&(u=b),v>p&&(p=v),b>y&&(y=b)}var g=(p-_)*(y-u);if(.95*s>g){s=g,t.R.col1.x=a,t.R.col1.y=l,t.R.col2.x=c,t.R.col2.y=m;var D=.5*(_+p),C=.5*(u+y),B=t.R;t.center.x=r.x+(B.col1.x*D+B.col2.x*C),t.center.y=r.y+(B.col1.y*D+B.col2.y*C),t.extents.x=.5*(p-_),t.extents.y=.5*(y-u)}}},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new a}),r.b2Shape=function(){},r.prototype.Copy=function(){return null},r.prototype.Set=function(t){this.m_radius=t.m_radius},r.prototype.GetType=function(){return this.m_type},r.prototype.TestPoint=function(){return!1},r.prototype.RayCast=function(){return!1},r.prototype.ComputeAABB=function(){},r.prototype.ComputeMass=function(t,e){void 0===e&&(e=0)},r.prototype.ComputeSubmergedArea=function(t,e){return void 0===e&&(e=0),0},r.TestOverlap=function(t,e,i,o){var n=new _;n.proxyA=new p,n.proxyA.Set(t),n.proxyB=new p,n.proxyB.Set(i),n.transformA=e,n.transformB=o,n.useRadii=!0;var s=new y;s.count=0;var r=new u;return m.Distance(r,s,n),r.distance<10*Number.MIN_VALUE},r.prototype.b2Shape=function(){this.m_type=r.e_unknownShape,this.m_radius=t.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),Box2D.Collision.Shapes.b2Shape.e_circleShape=0,Box2D.Collision.Shapes.b2Shape.e_polygonShape=1,Box2D.Collision.Shapes.b2Shape.e_edgeShape=2,Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var t=Box2D.Common.b2Color,e=(Box2D.Common.b2internal,Box2D.Common.b2Settings),i=(Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math);Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2,Box2D.Common.Math.b2Vec3,t.b2Color=function(){this._r=0,this._g=0,this._b=0},t.prototype.b2Color=function(t,e,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0),this._r=Box2D.parseUInt(255*i.Clamp(t,0,1)),this._g=Box2D.parseUInt(255*i.Clamp(e,0,1)),this._b=Box2D.parseUInt(255*i.Clamp(o,0,1))},t.prototype.Set=function(t,e,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0),this._r=Box2D.parseUInt(255*i.Clamp(t,0,1)),this._g=Box2D.parseUInt(255*i.Clamp(e,0,1)),this._b=Box2D.parseUInt(255*i.Clamp(o,0,1))},Object.defineProperty(t.prototype,"r",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._r=Box2D.parseUInt(255*i.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"g",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._g=Box2D.parseUInt(255*i.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"b",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._b=Box2D.parseUInt(255*i.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),e.b2Settings=function(){},e.b2MixFriction=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),Math.sqrt(t*e)},e.b2MixRestitution=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),t>e?t:e},e.b2Assert=function(t){if(!t)throw"Assertion Failed"},Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_pi=Math.PI,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*e.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*e.b2_pi,Box2D.Common.b2Settings.b2_toiSlop=8*e.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*e.b2_pi,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=e.b2_maxTranslation*e.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*e.b2_pi,Box2D.Common.b2Settings.b2_maxRotationSquared=e.b2_maxRotation*e.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*e.b2_pi})}(),function(){var t=(Box2D.Collision.b2AABB,Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings,Box2D.Common.Math.b2Mat22),e=Box2D.Common.Math.b2Mat33,i=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Sweep,n=Box2D.Common.Math.b2Transform,s=Box2D.Common.Math.b2Vec2,r=Box2D.Common.Math.b2Vec3;t.b2Mat22=function(){this.col1=new s,this.col2=new s},t.prototype.b2Mat22=function(){this.SetIdentity()},t.FromAngle=function(e){void 0===e&&(e=0);var i=new t;return i.Set(e),i},t.FromVV=function(e,i){var o=new t;return o.SetVV(e,i),o},t.prototype.Set=function(t){void 0===t&&(t=0);var e=Math.cos(t),i=Math.sin(t);this.col1.x=e,this.col2.x=-i,this.col1.y=i,this.col2.y=e},t.prototype.SetVV=function(t,e){this.col1.SetV(t),this.col2.SetV(e)},t.prototype.Copy=function(){var e=new t;return e.SetM(this),e},t.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2)},t.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y},t.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},t.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},t.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},t.prototype.GetInverse=function(t){var e=this.col1.x,i=this.col2.x,o=this.col1.y,n=this.col2.y,s=e*n-i*o;return 0!=s&&(s=1/s),t.col1.x=s*n,t.col2.x=-s*i,t.col1.y=-s*o,t.col2.y=s*e,t},t.prototype.Solve=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var o=this.col1.x,n=this.col2.x,s=this.col1.y,r=this.col2.y,a=o*r-n*s;return 0!=a&&(a=1/a),t.x=a*(r*e-n*i),t.y=a*(o*i-s*e),t},t.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},e.b2Mat33=function(){this.col1=new r,this.col2=new r,this.col3=new r},e.prototype.b2Mat33=function(t,e,i){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),t||e||i?(this.col1.SetV(t),this.col2.SetV(e),this.col3.SetV(i)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},e.prototype.SetVVV=function(t,e,i){this.col1.SetV(t),this.col2.SetV(e),this.col3.SetV(i)},e.prototype.Copy=function(){return new e(this.col1,this.col2,this.col3)},e.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2),this.col3.SetV(t.col3)},e.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col1.z+=t.col1.z,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y,this.col2.z+=t.col2.z,this.col3.x+=t.col3.x,this.col3.y+=t.col3.y,this.col3.z+=t.col3.z},e.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},e.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},e.prototype.Solve22=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var o=this.col1.x,n=this.col2.x,s=this.col1.y,r=this.col2.y,a=o*r-n*s;return 0!=a&&(a=1/a),t.x=a*(r*e-n*i),t.y=a*(o*i-s*e),t},e.prototype.Solve33=function(t,e,i,o){void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o=0);var n=this.col1.x,s=this.col1.y,r=this.col1.z,a=this.col2.x,l=this.col2.y,h=this.col2.z,c=this.col3.x,m=this.col3.y,_=this.col3.z,u=n*(l*_-h*m)+s*(h*c-a*_)+r*(a*m-l*c);return 0!=u&&(u=1/u),t.x=u*(e*(l*_-h*m)+i*(h*c-a*_)+o*(a*m-l*c)),t.y=u*(n*(i*_-o*m)+s*(o*c-e*_)+r*(e*m-i*c)),t.z=u*(n*(l*o-h*i)+s*(h*e-a*o)+r*(a*i-l*e)),t},i.b2Math=function(){},i.IsValid=function(t){return void 0===t&&(t=0),isFinite(t)},i.Dot=function(t,e){return t.x*e.x+t.y*e.y},i.CrossVV=function(t,e){return t.x*e.y-t.y*e.x},i.CrossVF=function(t,e){void 0===e&&(e=0);var i=new s(e*t.y,-e*t.x);return i},i.CrossFV=function(t,e){void 0===t&&(t=0);var i=new s(-t*e.y,t*e.x);return i},i.MulMV=function(t,e){var i=new s(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return i},i.MulTMV=function(t,e){var o=new s(i.Dot(e,t.col1),i.Dot(e,t.col2));return o},i.MulX=function(t,e){var o=i.MulMV(t.R,e);return o.x+=t.position.x,o.y+=t.position.y,o},i.MulXT=function(t,e){var o=i.SubtractVV(e,t.position),n=o.x*t.R.col1.x+o.y*t.R.col1.y;return o.y=o.x*t.R.col2.x+o.y*t.R.col2.y,o.x=n,o},i.AddVV=function(t,e){var i=new s(t.x+e.x,t.y+e.y);return i},i.SubtractVV=function(t,e){var i=new s(t.x-e.x,t.y-e.y);return i},i.Distance=function(t,e){var i=t.x-e.x,o=t.y-e.y;return Math.sqrt(i*i+o*o)},i.DistanceSquared=function(t,e){var i=t.x-e.x,o=t.y-e.y;return i*i+o*o},i.MulFV=function(t,e){void 0===t&&(t=0);var i=new s(t*e.x,t*e.y);return i},i.AddMM=function(e,o){var n=t.FromVV(i.AddVV(e.col1,o.col1),i.AddVV(e.col2,o.col2));return n},i.MulMM=function(e,o){var n=t.FromVV(i.MulMV(e,o.col1),i.MulMV(e,o.col2));return n},i.MulTMM=function(e,o){var n=new s(i.Dot(e.col1,o.col1),i.Dot(e.col2,o.col1)),r=new s(i.Dot(e.col1,o.col2),i.Dot(e.col2,o.col2)),a=t.FromVV(n,r);return a},i.Abs=function(t){return void 0===t&&(t=0),t>0?t:-t},i.AbsV=function(t){var e=new s(i.Abs(t.x),i.Abs(t.y));return e},i.AbsM=function(e){var o=t.FromVV(i.AbsV(e.col1),i.AbsV(e.col2));return o},i.Min=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),e>t?t:e},i.MinV=function(t,e){var o=new s(i.Min(t.x,e.x),i.Min(t.y,e.y));return o},i.Max=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),t>e?t:e},i.MaxV=function(t,e){var o=new s(i.Max(t.x,e.x),i.Max(t.y,e.y));return o},i.Clamp=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),e>t?e:t>i?i:t},i.ClampV=function(t,e,o){return i.MaxV(e,i.MinV(t,o))},i.Swap=function(t,e){var i=t[0];t[0]=e[0],e[0]=i},i.Random=function(){return 2*Math.random()-1},i.RandomRange=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=Math.random();return i=(e-t)*i+t},i.NextPowerOfTwo=function(t){return void 0===t&&(t=0),t|=2147483647&t>>1,t|=1073741823&t>>2,t|=268435455&t>>4,t|=16777215&t>>8,t|=65535&t>>16,t+1},i.IsPowerOfTwo=function(t){void 0===t&&(t=0);var e=t>0&&0==(t&t-1);return e},Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new s(0,0),Box2D.Common.Math.b2Math.b2Mat22_identity=t.FromVV(new s(1,0),new s(0,1)),Box2D.Common.Math.b2Math.b2Transform_identity=new n(i.b2Vec2_zero,i.b2Mat22_identity)}),o.b2Sweep=function(){this.localCenter=new s,this.c0=new s,this.c=new s},o.prototype.Set=function(t){this.localCenter.SetV(t.localCenter),this.c0.SetV(t.c0),this.c.SetV(t.c),this.a0=t.a0,this.a=t.a,this.t0=t.t0},o.prototype.Copy=function(){var t=new o;return t.localCenter.SetV(this.localCenter),t.c0.SetV(this.c0),t.c.SetV(this.c),t.a0=this.a0,t.a=this.a,t.t0=this.t0,t},o.prototype.GetTransform=function(t,e){void 0===e&&(e=0),t.position.x=(1-e)*this.c0.x+e*this.c.x,t.position.y=(1-e)*this.c0.y+e*this.c.y;var i=(1-e)*this.a0+e*this.a;t.R.Set(i);var o=t.R;t.position.x-=o.col1.x*this.localCenter.x+o.col2.x*this.localCenter.y,t.position.y-=o.col1.y*this.localCenter.x+o.col2.y*this.localCenter.y},o.prototype.Advance=function(t){if(void 0===t&&(t=0),this.t0<t&&1-this.t0>Number.MIN_VALUE){var e=(t-this.t0)/(1-this.t0);this.c0.x=(1-e)*this.c0.x+e*this.c.x,this.c0.y=(1-e)*this.c0.y+e*this.c.y,this.a0=(1-e)*this.a0+e*this.a,this.t0=t}},n.b2Transform=function(){this.position=new s,this.R=new t},n.prototype.b2Transform=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),t&&(this.position.SetV(t),this.R.SetM(e))},n.prototype.Initialize=function(t,e){this.position.SetV(t),this.R.SetM(e)},n.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},n.prototype.Set=function(t){this.position.SetV(t.position),this.R.SetM(t.R)},n.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},s.b2Vec2=function(){},s.prototype.b2Vec2=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e},s.prototype.SetZero=function(){this.x=0,this.y=0},s.prototype.Set=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e},s.prototype.SetV=function(t){this.x=t.x,this.y=t.y},s.prototype.GetNegative=function(){return new s(-this.x,-this.y)},s.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},s.Make=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),new s(t,e)},s.prototype.Copy=function(){return new s(this.x,this.y)},s.prototype.Add=function(t){this.x+=t.x,this.y+=t.y},s.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y},s.prototype.Multiply=function(t){void 0===t&&(t=0),this.x*=t,this.y*=t},s.prototype.MulM=function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y,this.y=t.col1.y*e+t.col2.y*this.y},s.prototype.MulTM=function(t){var e=i.Dot(this,t.col1);this.y=i.Dot(this,t.col2),this.x=e},s.prototype.CrossVF=function(t){void 0===t&&(t=0);var e=this.x;this.x=t*this.y,this.y=-t*e},s.prototype.CrossFV=function(t){void 0===t&&(t=0);var e=this.x;this.x=-t*this.y,this.y=t*e},s.prototype.MinV=function(t){this.x=this.x<t.x?this.x:t.x,this.y=this.y<t.y?this.y:t.y},s.prototype.MaxV=function(t){this.x=this.x>t.x?this.x:t.x,this.y=this.y>t.y?this.y:t.y},s.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},s.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},s.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},s.prototype.Normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t<Number.MIN_VALUE)return 0;var e=1/t;return this.x*=e,this.y*=e,t},s.prototype.IsValid=function(){return i.IsValid(this.x)&&i.IsValid(this.y)},r.b2Vec3=function(){},r.prototype.b2Vec3=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=i},r.prototype.SetZero=function(){this.x=this.y=this.z=0},r.prototype.Set=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=i},r.prototype.SetV=function(t){this.x=t.x,this.y=t.y,this.z=t.z},r.prototype.GetNegative=function(){return new r(-this.x,-this.y,-this.z)},r.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},r.prototype.Copy=function(){return new r(this.x,this.y,this.z)},r.prototype.Add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},r.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},r.prototype.Multiply=function(t){void 0===t&&(t=0),this.x*=t,this.y*=t,this.z*=t}}(),function(){var t=(Box2D.Dynamics.Controllers.b2ControllerEdge,Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),e=Box2D.Common.Math.b2Sweep,i=Box2D.Common.Math.b2Transform,o=Box2D.Common.Math.b2Vec2,n=(Box2D.Common.Math.b2Vec3,Box2D.Common.b2Color),s=(Box2D.Common.b2internal,Box2D.Common.b2Settings),r=Box2D.Collision.b2AABB,a=(Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision,Box2D.Collision.b2ContactID,Box2D.Collision.b2ContactPoint),l=(Box2D.Collision.b2Distance,Box2D.Collision.b2DistanceInput,Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2DistanceProxy,Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase),h=(Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold,Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput),c=Box2D.Collision.b2RayCastOutput,m=(Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache,Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact,Box2D.Collision.b2TOIInput,Box2D.Collision.b2WorldManifold,Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase,Box2D.Collision.Shapes.b2CircleShape),_=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape),u=Box2D.Collision.Shapes.b2MassData,p=Box2D.Collision.Shapes.b2PolygonShape,y=Box2D.Collision.Shapes.b2Shape,x=Box2D.Dynamics.b2Body,d=Box2D.Dynamics.b2BodyDef,f=Box2D.Dynamics.b2ContactFilter,v=Box2D.Dynamics.b2ContactImpulse,b=Box2D.Dynamics.b2ContactListener,g=Box2D.Dynamics.b2ContactManager,D=Box2D.Dynamics.b2DebugDraw,C=Box2D.Dynamics.b2DestructionListener,B=Box2D.Dynamics.b2FilterData,w=Box2D.Dynamics.b2Fixture,S=Box2D.Dynamics.b2FixtureDef,A=Box2D.Dynamics.b2Island,M=Box2D.Dynamics.b2TimeStep,I=Box2D.Dynamics.b2World,V=(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Dynamics.Contacts.b2Contact),L=(Box2D.Dynamics.Contacts.b2ContactConstraint,Box2D.Dynamics.Contacts.b2ContactConstraintPoint,Box2D.Dynamics.Contacts.b2ContactEdge,Box2D.Dynamics.Contacts.b2ContactFactory),P=(Box2D.Dynamics.Contacts.b2ContactRegister,Box2D.Dynamics.Contacts.b2ContactResult,Box2D.Dynamics.Contacts.b2ContactSolver),T=(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2NullContact,Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Dynamics.Contacts.b2PositionSolverManifold,Box2D.Dynamics.Controllers.b2Controller,Box2D.Dynamics.Joints.b2DistanceJoint,Box2D.Dynamics.Joints.b2DistanceJointDef,Box2D.Dynamics.Joints.b2FrictionJoint,Box2D.Dynamics.Joints.b2FrictionJointDef,Box2D.Dynamics.Joints.b2GearJoint,Box2D.Dynamics.Joints.b2GearJointDef,Box2D.Dynamics.Joints.b2Jacobian,Box2D.Dynamics.Joints.b2Joint),G=(Box2D.Dynamics.Joints.b2JointDef,Box2D.Dynamics.Joints.b2JointEdge,Box2D.Dynamics.Joints.b2LineJoint,Box2D.Dynamics.Joints.b2LineJointDef,Box2D.Dynamics.Joints.b2MouseJoint,Box2D.Dynamics.Joints.b2MouseJointDef,Box2D.Dynamics.Joints.b2PrismaticJoint,Box2D.Dynamics.Joints.b2PrismaticJointDef,Box2D.Dynamics.Joints.b2PulleyJoint);Box2D.Dynamics.Joints.b2PulleyJointDef,Box2D.Dynamics.Joints.b2RevoluteJoint,Box2D.Dynamics.Joints.b2RevoluteJointDef,Box2D.Dynamics.Joints.b2WeldJoint,Box2D.Dynamics.Joints.b2WeldJointDef,x.b2Body=function(){this.m_xf=new i,this.m_sweep=new e,this.m_linearVelocity=new o,this.m_force=new o},x.prototype.connectEdges=function(e,i,o){void 0===o&&(o=0);var n=Math.atan2(i.GetDirectionVector().y,i.GetDirectionVector().x),r=Math.tan(.5*(n-o)),a=t.MulFV(r,i.GetDirectionVector());a=t.SubtractVV(a,i.GetNormalVector()),a=t.MulFV(s.b2_toiSlop,a),a=t.AddVV(a,i.GetVertex1());var l=t.AddVV(e.GetDirectionVector(),i.GetDirectionVector());l.Normalize();var h=t.Dot(e.GetDirectionVector(),i.GetNormalVector())>0;return e.SetNextEdge(i,a,l,h),i.SetPrevEdge(e,a,l,h),n},x.prototype.CreateFixture=function(t){if(1==this.m_world.IsLocked())return null;var e=new w;if(e.Create(this,this.m_xf,t),this.m_flags&x.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;e.CreateProxy(i,this.m_xf)}return e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_body=this,e.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=I.e_newFixture,e},x.prototype.CreateFixture2=function(t,e){void 0===e&&(e=0);var i=new S;return i.shape=t,i.density=e,this.CreateFixture(i)},x.prototype.DestroyFixture=function(t){if(1!=this.m_world.IsLocked()){for(var e=this.m_fixtureList,i=null,o=!1;null!=e;){if(e==t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next,o=!0;break}i=e,e=e.m_next}for(var n=this.m_contactList;n;){var s=n.contact;n=n.next;var r=s.GetFixtureA(),a=s.GetFixtureB();(t==r||t==a)&&this.m_world.m_contactManager.Destroy(s)}if(this.m_flags&x.e_activeFlag){var l=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxy(l)}t.Destroy(),t.m_body=null,t.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},x.prototype.SetPositionAndAngle=function(t,e){void 0===e&&(e=0);var i;if(1!=this.m_world.IsLocked()){this.m_xf.R.Set(e),this.m_xf.position.SetV(t);var o=this.m_xf.R,n=this.m_sweep.localCenter;this.m_sweep.c.x=o.col1.x*n.x+o.col2.x*n.y,this.m_sweep.c.y=o.col1.y*n.x+o.col2.y*n.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=e;var s=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(s,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},x.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())},x.prototype.GetTransform=function(){return this.m_xf},x.prototype.GetPosition=function(){return this.m_xf.position},x.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())},x.prototype.GetAngle=function(){return this.m_sweep.a},x.prototype.SetAngle=function(t){void 0===t&&(t=0),this.SetPositionAndAngle(this.GetPosition(),t)},x.prototype.GetWorldCenter=function(){return this.m_sweep.c},x.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},x.prototype.SetLinearVelocity=function(t){this.m_type!=x.b2_staticBody&&this.m_linearVelocity.SetV(t)},x.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},x.prototype.SetAngularVelocity=function(t){void 0===t&&(t=0),this.m_type!=x.b2_staticBody&&(this.m_angularVelocity=t)},x.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},x.prototype.GetDefinition=function(){var t=new d;return t.type=this.GetType(),t.allowSleep=(this.m_flags&x.e_allowSleepFlag)==x.e_allowSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=(this.m_flags&x.e_fixedRotationFlag)==x.e_fixedRotationFlag,t.bullet=(this.m_flags&x.e_bulletFlag)==x.e_bulletFlag,t.awake=(this.m_flags&x.e_awakeFlag)==x.e_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.SetV(this.GetLinearVelocity()),t.position=this.GetPosition(),t.userData=this.GetUserData(),t},x.prototype.ApplyForce=function(t,e){this.m_type==x.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)},x.prototype.ApplyTorque=function(t){void 0===t&&(t=0),this.m_type==x.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=t)},x.prototype.ApplyImpulse=function(t,e){this.m_type==x.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))},x.prototype.Split=function(e){for(var i,o=this.GetLinearVelocity().Copy(),n=this.GetAngularVelocity(),s=this.GetWorldCenter(),r=this,a=this.m_world.CreateBody(this.GetDefinition()),l=r.m_fixtureList;l;)if(e(l)){var h=l.m_next;i?i.m_next=h:r.m_fixtureList=h,r.m_fixtureCount--,l.m_next=a.m_fixtureList,a.m_fixtureList=l,a.m_fixtureCount++,l.m_body=a,l=h}else i=l,l=l.m_next;r.ResetMassData(),a.ResetMassData();var c=r.GetWorldCenter(),m=a.GetWorldCenter(),_=t.AddVV(o,t.CrossFV(n,t.SubtractVV(c,s))),u=t.AddVV(o,t.CrossFV(n,t.SubtractVV(m,s)));return r.SetLinearVelocity(_),a.SetLinearVelocity(u),r.SetAngularVelocity(n),a.SetAngularVelocity(n),r.SynchronizeFixtures(),a.SynchronizeFixtures(),a},x.prototype.Merge=function(t){var e;for(e=t.m_fixtureList;e;){var i=e.m_next;t.m_fixtureCount--,e.m_next=this.m_fixtureList,this.m_fixtureList=e,this.m_fixtureCount++,e.m_body=n,e=i}o.m_fixtureCount=0;var o=this,n=t;o.GetWorldCenter(),n.GetWorldCenter(),o.GetLinearVelocity().Copy(),n.GetLinearVelocity().Copy(),o.GetAngularVelocity(),n.GetAngularVelocity(),o.ResetMassData(),this.SynchronizeFixtures()},x.prototype.GetMass=function(){return this.m_mass},x.prototype.GetInertia=function(){return this.m_I},x.prototype.GetMassData=function(t){t.mass=this.m_mass,t.I=this.m_I,t.center.SetV(this.m_sweep.localCenter)},x.prototype.SetMassData=function(e){if(s.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==x.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&0==(this.m_flags&x.e_fixedRotationFlag)&&(this.m_I=e.I-this.m_mass*(e.center.x*e.center.x+e.center.y*e.center.y),this.m_invI=1/this.m_I);var i=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e.center),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-i.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-i.x)}},x.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=x.b2_staticBody&&this.m_type!=x.b2_kinematicBody){for(var e=o.Make(0,0),i=this.m_fixtureList;i;i=i.m_next)if(0!=i.m_density){var n=i.GetMassData();this.m_mass+=n.mass,e.x+=n.center.x*n.mass,e.y+=n.center.y*n.mass,this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==(this.m_flags&x.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(e.x*e.x+e.y*e.y),this.m_I*=this.m_inertiaScale,s.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var r=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-r.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-r.x)}},x.prototype.GetWorldPoint=function(t){var e=this.m_xf.R,i=new o(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);return i.x+=this.m_xf.position.x,i.y+=this.m_xf.position.y,i},x.prototype.GetWorldVector=function(e){return t.MulMV(this.m_xf.R,e)},x.prototype.GetLocalPoint=function(e){return t.MulXT(this.m_xf,e)},x.prototype.GetLocalVector=function(e){return t.MulTMV(this.m_xf.R,e)},x.prototype.GetLinearVelocityFromWorldPoint=function(t){return new o(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},x.prototype.GetLinearVelocityFromLocalPoint=function(t){var e=this.m_xf.R,i=new o(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);return i.x+=this.m_xf.position.x,i.y+=this.m_xf.position.y,new o(this.m_linearVelocity.x-this.m_angularVelocity*(i.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(i.x-this.m_sweep.c.x))},x.prototype.GetLinearDamping=function(){return this.m_linearDamping},x.prototype.SetLinearDamping=function(t){void 0===t&&(t=0),this.m_linearDamping=t},x.prototype.GetAngularDamping=function(){return this.m_angularDamping},x.prototype.SetAngularDamping=function(t){void 0===t&&(t=0),this.m_angularDamping=t},x.prototype.SetType=function(t){if(void 0===t&&(t=0),this.m_type!=t){this.m_type=t,this.ResetMassData(),this.m_type==x.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var e=this.m_contactList;e;e=e.next)e.contact.FlagForFiltering()}},x.prototype.GetType=function(){return this.m_type},x.prototype.SetBullet=function(t){t?this.m_flags|=x.e_bulletFlag:this.m_flags&=~x.e_bulletFlag},x.prototype.IsBullet=function(){return(this.m_flags&x.e_bulletFlag)==x.e_bulletFlag},x.prototype.SetSleepingAllowed=function(t){t?this.m_flags|=x.e_allowSleepFlag:(this.m_flags&=~x.e_allowSleepFlag,this.SetAwake(!0))},x.prototype.SetAwake=function(t){t?(this.m_flags|=x.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~x.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},x.prototype.IsAwake=function(){return(this.m_flags&x.e_awakeFlag)==x.e_awakeFlag},x.prototype.SetFixedRotation=function(t){t?this.m_flags|=x.e_fixedRotationFlag:this.m_flags&=~x.e_fixedRotationFlag,this.ResetMassData()},x.prototype.IsFixedRotation=function(){return(this.m_flags&x.e_fixedRotationFlag)==x.e_fixedRotationFlag},x.prototype.SetActive=function(t){if(t!=this.IsActive()){var e,i;if(t)for(this.m_flags|=x.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.CreateProxy(e,this.m_xf);else{for(this.m_flags&=~x.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxy(e);for(var o=this.m_contactList;o;){var n=o;o=o.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}}},x.prototype.IsActive=function(){return(this.m_flags&x.e_activeFlag)==x.e_activeFlag},x.prototype.IsSleepingAllowed=function(){return(this.m_flags&x.e_allowSleepFlag)==x.e_allowSleepFlag},x.prototype.GetFixtureList=function(){return this.m_fixtureList},x.prototype.GetJointList=function(){return this.m_jointList},x.prototype.GetControllerList=function(){return this.m_controllerList},x.prototype.GetContactList=function(){return this.m_contactList},x.prototype.GetNext=function(){return this.m_next},x.prototype.GetUserData=function(){return this.m_userData},x.prototype.SetUserData=function(t){this.m_userData=t},x.prototype.GetWorld=function(){return this.m_world},x.prototype.b2Body=function(t,e){this.m_flags=0,t.bullet&&(this.m_flags|=x.e_bulletFlag),t.fixedRotation&&(this.m_flags|=x.e_fixedRotationFlag),t.allowSleep&&(this.m_flags|=x.e_allowSleepFlag),t.awake&&(this.m_flags|=x.e_awakeFlag),t.active&&(this.m_flags|=x.e_activeFlag),this.m_world=e,this.m_xf.position.SetV(t.position),this.m_xf.R.Set(t.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=t.angle;var i=this.m_xf.R,o=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*o.x+i.col2.x*o.y,this.m_sweep.c.y=i.col1.y*o.x+i.col2.y*o.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(t.linearVelocity),this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type,this.m_type==x.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=t.inertiaScale,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0},x.prototype.SynchronizeFixtures=function(){var t=x.s_xf1;t.R.Set(this.m_sweep.a0);var e=t.R,i=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(e.col1.x*i.x+e.col2.x*i.y),t.position.y=this.m_sweep.c0.y-(e.col1.y*i.x+e.col2.y*i.y);var o,n=this.m_world.m_contactManager.m_broadPhase;for(o=this.m_fixtureList;o;o=o.m_next)o.Synchronize(n,t,this.m_xf)},x.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R,e=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*e.x+t.col2.x*e.y),this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*e.x+t.col2.y*e.y)},x.prototype.ShouldCollide=function(t){if(this.m_type!=x.b2_dynamicBody&&t.m_type!=x.b2_dynamicBody)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},x.prototype.Advance=function(t){void 0===t&&(t=0),this.m_sweep.Advance(t),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new i,Box2D.Dynamics.b2Body.e_islandFlag=1,Box2D.Dynamics.b2Body.e_awakeFlag=2,Box2D.Dynamics.b2Body.e_allowSleepFlag=4,Box2D.Dynamics.b2Body.e_bulletFlag=8,Box2D.Dynamics.b2Body.e_fixedRotationFlag=16,Box2D.Dynamics.b2Body.e_activeFlag=32,Box2D.Dynamics.b2Body.b2_staticBody=0,Box2D.Dynamics.b2Body.b2_kinematicBody=1,Box2D.Dynamics.b2Body.b2_dynamicBody=2
}),d.b2BodyDef=function(){this.position=new o,this.linearVelocity=new o},d.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=x.b2_staticBody,this.active=!0,this.inertiaScale=1},f.b2ContactFilter=function(){},f.prototype.ShouldCollide=function(t,e){var i=t.GetFilterData(),o=e.GetFilterData();if(i.groupIndex==o.groupIndex&&0!=i.groupIndex)return i.groupIndex>0;var n=0!=(i.maskBits&o.categoryBits)&&0!=(i.categoryBits&o.maskBits);return n},f.prototype.RayCollide=function(t,e){return t?this.ShouldCollide(t instanceof w?t:null,e):!0},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new f}),v.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(s.b2_maxManifoldPoints),this.tangentImpulses=new Vector_a2j_Number(s.b2_maxManifoldPoints)},b.b2ContactListener=function(){},b.prototype.BeginContact=function(){},b.prototype.EndContact=function(){},b.prototype.PreSolve=function(){},b.prototype.PostSolve=function(){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new b}),g.b2ContactManager=function(){},g.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=f.b2_defaultFilter,this.m_contactListener=b.b2_defaultListener,this.m_contactFactory=new L(this.m_allocator),this.m_broadPhase=new l},g.prototype.AddPair=function(t,e){var i=t instanceof w?t:null,o=e instanceof w?e:null,n=i.GetBody(),s=o.GetBody();if(n!=s){for(var r=s.GetContactList();r;){if(r.other==n){var a=r.contact.GetFixtureA(),l=r.contact.GetFixtureB();if(a==i&&l==o)return;if(a==o&&l==i)return}r=r.next}if(0!=s.ShouldCollide(n)&&0!=this.m_contactFilter.ShouldCollide(i,o)){var h=this.m_contactFactory.Create(i,o);i=h.GetFixtureA(),o=h.GetFixtureB(),n=i.m_body,s=o.m_body,h.m_prev=null,h.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=h),this.m_world.m_contactList=h,h.m_nodeA.contact=h,h.m_nodeA.other=s,h.m_nodeA.prev=null,h.m_nodeA.next=n.m_contactList,null!=n.m_contactList&&(n.m_contactList.prev=h.m_nodeA),n.m_contactList=h.m_nodeA,h.m_nodeB.contact=h,h.m_nodeB.other=n,h.m_nodeB.prev=null,h.m_nodeB.next=s.m_contactList,null!=s.m_contactList&&(s.m_contactList.prev=h.m_nodeB),s.m_contactList=h.m_nodeB,++this.m_world.m_contactCount}}},g.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))},g.prototype.Destroy=function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),o=e.GetBody(),n=i.GetBody();t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_world.m_contactList&&(this.m_world.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==o.m_contactList&&(o.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount},g.prototype.Collide=function(){for(var t=this.m_world.m_contactList;t;){var e=t.GetFixtureA(),i=t.GetFixtureB(),o=e.GetBody(),n=i.GetBody();if(0!=o.IsAwake()||0!=n.IsAwake()){if(t.m_flags&V.e_filterFlag){if(0==n.ShouldCollide(o)){var s=t;t=s.GetNext(),this.Destroy(s);continue}if(0==this.m_contactFilter.ShouldCollide(e,i)){s=t,t=s.GetNext(),this.Destroy(s);continue}t.m_flags&=~V.e_filterFlag}var r=e.m_proxy,a=i.m_proxy,l=this.m_broadPhase.TestOverlap(r,a);0!=l?(t.Update(this.m_contactListener),t=t.GetNext()):(s=t,t=s.GetNext(),this.Destroy(s))}else t=t.GetNext()}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new a}),D.b2DebugDraw=function(){},D.prototype.b2DebugDraw=function(){},D.prototype.SetFlags=function(t){void 0===t&&(t=0)},D.prototype.GetFlags=function(){},D.prototype.AppendFlags=function(t){void 0===t&&(t=0)},D.prototype.ClearFlags=function(t){void 0===t&&(t=0)},D.prototype.SetSprite=function(){},D.prototype.GetSprite=function(){},D.prototype.SetDrawScale=function(t){void 0===t&&(t=0)},D.prototype.GetDrawScale=function(){},D.prototype.SetLineThickness=function(t){void 0===t&&(t=0)},D.prototype.GetLineThickness=function(){},D.prototype.SetAlpha=function(t){void 0===t&&(t=0)},D.prototype.GetAlpha=function(){},D.prototype.SetFillAlpha=function(t){void 0===t&&(t=0)},D.prototype.GetFillAlpha=function(){},D.prototype.SetXFormScale=function(t){void 0===t&&(t=0)},D.prototype.GetXFormScale=function(){},D.prototype.DrawPolygon=function(t,e){void 0===e&&(e=0)},D.prototype.DrawSolidPolygon=function(t,e){void 0===e&&(e=0)},D.prototype.DrawCircle=function(t,e){void 0===e&&(e=0)},D.prototype.DrawSolidCircle=function(t,e){void 0===e&&(e=0)},D.prototype.DrawSegment=function(){},D.prototype.DrawTransform=function(){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32}),C.b2DestructionListener=function(){},C.prototype.SayGoodbyeJoint=function(){},C.prototype.SayGoodbyeFixture=function(){},B.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},B.prototype.Copy=function(){var t=new B;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},w.b2Fixture=function(){this.m_filter=new B},w.prototype.GetType=function(){return this.m_shape.GetType()},w.prototype.GetShape=function(){return this.m_shape},w.prototype.SetSensor=function(t){if(this.m_isSensor!=t&&(this.m_isSensor=t,null!=this.m_body))for(var e=this.m_body.GetContactList();e;){var i=e.contact,o=i.GetFixtureA(),n=i.GetFixtureB();(o==this||n==this)&&i.SetSensor(o.IsSensor()||n.IsSensor()),e=e.next}},w.prototype.IsSensor=function(){return this.m_isSensor},w.prototype.SetFilterData=function(t){if(this.m_filter=t.Copy(),!this.m_body)for(var e=this.m_body.GetContactList();e;){var i=e.contact,o=i.GetFixtureA(),n=i.GetFixtureB();(o==this||n==this)&&i.FlagForFiltering(),e=e.next}},w.prototype.GetFilterData=function(){return this.m_filter.Copy()},w.prototype.GetBody=function(){return this.m_body},w.prototype.GetNext=function(){return this.m_next},w.prototype.GetUserData=function(){return this.m_userData},w.prototype.SetUserData=function(t){this.m_userData=t},w.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},w.prototype.RayCast=function(t,e){return this.m_shape.RayCast(t,e,this.m_body.GetTransform())},w.prototype.GetMassData=function(t){return void 0===t&&(t=null),null==t&&(t=new u),this.m_shape.ComputeMass(t,this.m_density),t},w.prototype.SetDensity=function(t){void 0===t&&(t=0),this.m_density=t},w.prototype.GetDensity=function(){return this.m_density},w.prototype.GetFriction=function(){return this.m_friction},w.prototype.SetFriction=function(t){void 0===t&&(t=0),this.m_friction=t},w.prototype.GetRestitution=function(){return this.m_restitution},w.prototype.SetRestitution=function(t){void 0===t&&(t=0),this.m_restitution=t},w.prototype.GetAABB=function(){return this.m_aabb},w.prototype.b2Fixture=function(){this.m_aabb=new r,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},w.prototype.Create=function(t,e,i){this.m_userData=i.userData,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_body=t,this.m_next=null,this.m_filter=i.filter.Copy(),this.m_isSensor=i.isSensor,this.m_shape=i.shape.Copy(),this.m_density=i.density},w.prototype.Destroy=function(){this.m_shape=null},w.prototype.CreateProxy=function(t,e){this.m_shape.ComputeAABB(this.m_aabb,e),this.m_proxy=t.CreateProxy(this.m_aabb,this)},w.prototype.DestroyProxy=function(t){null!=this.m_proxy&&(t.DestroyProxy(this.m_proxy),this.m_proxy=null)},w.prototype.Synchronize=function(e,i,o){if(this.m_proxy){var n=new r,s=new r;this.m_shape.ComputeAABB(n,i),this.m_shape.ComputeAABB(s,o),this.m_aabb.Combine(n,s);var a=t.SubtractVV(o.position,i.position);e.MoveProxy(this.m_proxy,this.m_aabb,a)}},S.b2FixtureDef=function(){this.filter=new B},S.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},A.b2Island=function(){},A.prototype.b2Island=function(){this.m_bodies=new Vector,this.m_contacts=new Vector,this.m_joints=new Vector},A.prototype.Initialize=function(t,e,i,o,n,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var r=0;for(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=o,this.m_listener=n,this.m_contactSolver=s,r=this.m_bodies.length;t>r;r++)this.m_bodies[r]=null;for(r=this.m_contacts.length;e>r;r++)this.m_contacts[r]=null;for(r=this.m_joints.length;i>r;r++)this.m_joints[r]=null},A.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},A.prototype.Solve=function(e,i,o){var n,r,a=0,l=0;for(a=0;a<this.m_bodyCount;++a)n=this.m_bodies[a],n.GetType()==x.b2_dynamicBody&&(n.m_linearVelocity.x+=e.dt*(i.x+n.m_invMass*n.m_force.x),n.m_linearVelocity.y+=e.dt*(i.y+n.m_invMass*n.m_force.y),n.m_angularVelocity+=e.dt*n.m_invI*n.m_torque,n.m_linearVelocity.Multiply(t.Clamp(1-e.dt*n.m_linearDamping,0,1)),n.m_angularVelocity*=t.Clamp(1-e.dt*n.m_angularDamping,0,1));this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var h=this.m_contactSolver;for(h.InitVelocityConstraints(e),a=0;a<this.m_jointCount;++a)r=this.m_joints[a],r.InitVelocityConstraints(e);for(a=0;a<e.velocityIterations;++a){for(l=0;l<this.m_jointCount;++l)r=this.m_joints[l],r.SolveVelocityConstraints(e);h.SolveVelocityConstraints()}for(a=0;a<this.m_jointCount;++a)r=this.m_joints[a],r.FinalizeVelocityConstraints();for(h.FinalizeVelocityConstraints(),a=0;a<this.m_bodyCount;++a)if(n=this.m_bodies[a],n.GetType()!=x.b2_staticBody){var c=e.dt*n.m_linearVelocity.x,m=e.dt*n.m_linearVelocity.y;c*c+m*m>s.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=s.b2_maxTranslation*e.inv_dt,n.m_linearVelocity.y*=s.b2_maxTranslation*e.inv_dt);var _=e.dt*n.m_angularVelocity;_*_>s.b2_maxRotationSquared&&(n.m_angularVelocity=n.m_angularVelocity<0?-s.b2_maxRotation*e.inv_dt:s.b2_maxRotation*e.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=e.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=e.dt*n.m_linearVelocity.y,n.m_sweep.a+=e.dt*n.m_angularVelocity,n.SynchronizeTransform()}for(a=0;a<e.positionIterations;++a){var u=h.SolvePositionConstraints(s.b2_contactBaumgarte),p=!0;for(l=0;l<this.m_jointCount;++l){r=this.m_joints[l];var y=r.SolvePositionConstraints(s.b2_contactBaumgarte);p=p&&y}if(u&&p)break}if(this.Report(h.m_constraints),o){var d=Number.MAX_VALUE,f=s.b2_linearSleepTolerance*s.b2_linearSleepTolerance,v=s.b2_angularSleepTolerance*s.b2_angularSleepTolerance;for(a=0;a<this.m_bodyCount;++a)n=this.m_bodies[a],n.GetType()!=x.b2_staticBody&&(0==(n.m_flags&x.e_allowSleepFlag)&&(n.m_sleepTime=0,d=0),0==(n.m_flags&x.e_allowSleepFlag)||n.m_angularVelocity*n.m_angularVelocity>v||t.Dot(n.m_linearVelocity,n.m_linearVelocity)>f?(n.m_sleepTime=0,d=0):(n.m_sleepTime+=e.dt,d=t.Min(d,n.m_sleepTime)));if(d>=s.b2_timeToSleep)for(a=0;a<this.m_bodyCount;++a)n=this.m_bodies[a],n.SetAwake(!1)}},A.prototype.SolveTOI=function(t){var e=0,i=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var o=this.m_contactSolver;for(e=0;e<this.m_jointCount;++e)this.m_joints[e].InitVelocityConstraints(t);for(e=0;e<t.velocityIterations;++e)for(o.SolveVelocityConstraints(),i=0;i<this.m_jointCount;++i)this.m_joints[i].SolveVelocityConstraints(t);for(e=0;e<this.m_bodyCount;++e){var n=this.m_bodies[e];if(n.GetType()!=x.b2_staticBody){var r=t.dt*n.m_linearVelocity.x,a=t.dt*n.m_linearVelocity.y;r*r+a*a>s.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=s.b2_maxTranslation*t.inv_dt,n.m_linearVelocity.y*=s.b2_maxTranslation*t.inv_dt);var l=t.dt*n.m_angularVelocity;l*l>s.b2_maxRotationSquared&&(n.m_angularVelocity=n.m_angularVelocity<0?-s.b2_maxRotation*t.inv_dt:s.b2_maxRotation*t.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=t.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=t.dt*n.m_linearVelocity.y,n.m_sweep.a+=t.dt*n.m_angularVelocity,n.SynchronizeTransform()}}var h=.75;for(e=0;e<t.positionIterations;++e){var c=o.SolvePositionConstraints(h),m=!0;for(i=0;i<this.m_jointCount;++i){var _=this.m_joints[i].SolvePositionConstraints(s.b2_contactBaumgarte);m=m&&_}if(c&&m)break}this.Report(o.m_constraints)},A.prototype.Report=function(t){if(null!=this.m_listener)for(var e=0;e<this.m_contactCount;++e){for(var i=this.m_contacts[e],o=t[e],n=0;n<o.pointCount;++n)A.s_impulse.normalImpulses[n]=o.points[n].normalImpulse,A.s_impulse.tangentImpulses[n]=o.points[n].tangentImpulse;this.m_listener.PostSolve(i,A.s_impulse)}},A.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},A.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t},A.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new v}),M.b2TimeStep=function(){},M.prototype.Set=function(t){this.dt=t.dt,this.inv_dt=t.inv_dt,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.warmStarting=t.warmStarting},I.b2World=function(){this.s_stack=new Vector,this.m_contactManager=new g,this.m_contactSolver=new P,this.m_island=new A},I.prototype.b2World=function(t,e){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,I.m_warmStarting=!0,I.m_continuousPhysics=!0,this.m_allowSleep=e,this.m_gravity=t,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var i=new d;this.m_groundBody=this.CreateBody(i)},I.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},I.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},I.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},I.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},I.prototype.SetBroadPhase=function(t){var e=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var i=this.m_bodyList;i;i=i.m_next)for(var o=i.m_fixtureList;o;o=o.m_next)o.m_proxy=t.CreateProxy(e.GetFatAABB(o.m_proxy),o)},I.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},I.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},I.prototype.CreateBody=function(t){if(1==this.IsLocked())return null;var e=new x(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e},I.prototype.DestroyBody=function(t){if(1!=this.IsLocked()){for(var e=t.m_jointList;e;){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint)}for(var o=t.m_controllerList;o;){var n=o;o=o.nextController,n.controller.RemoveBody(t)}for(var s=t.m_contactList;s;){var r=s;s=s.next,this.m_contactManager.Destroy(r.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var l=a;a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(l),l.DestroyProxy(this.m_contactManager.m_broadPhase),l.Destroy()}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},I.prototype.CreateJoint=function(t){var e=T.Create(t,null);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.joint=e,e.m_edgeA.other=e.m_bodyB,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.joint=e,e.m_edgeB.other=e.m_bodyA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;var i=t.bodyA,o=t.bodyB;if(0==t.collideConnected)for(var n=o.GetContactList();n;)n.other==i&&n.contact.FlagForFiltering(),n=n.next;return e},I.prototype.DestroyJoint=function(t){var e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_bodyA,o=t.m_bodyB;if(i.SetAwake(!0),o.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==o.m_jointList&&(o.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,T.Destroy(t,null),--this.m_jointCount,0==e)for(var n=o.GetContactList();n;)n.other==i&&n.contact.FlagForFiltering(),n=n.next},I.prototype.AddController=function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList=t,t.m_world=this,this.m_controllerCount++,t},I.prototype.RemoveController=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList==t&&(this.m_controllerList=t.m_next),this.m_controllerCount--},I.prototype.CreateController=function(t){if(t.m_world!=this)throw new Error("Controller can only be a member of one world");return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t.m_world=this,t},I.prototype.DestroyController=function(t){t.Clear(),t.m_next&&(t.m_next.m_prev=t.m_prev),t.m_prev&&(t.m_prev.m_next=t.m_next),t==this.m_controllerList&&(this.m_controllerList=t.m_next),--this.m_controllerCount},I.prototype.SetWarmStarting=function(t){I.m_warmStarting=t},I.prototype.SetContinuousPhysics=function(t){I.m_continuousPhysics=t},I.prototype.GetBodyCount=function(){return this.m_bodyCount},I.prototype.GetJointCount=function(){return this.m_jointCount},I.prototype.GetContactCount=function(){return this.m_contactCount},I.prototype.SetGravity=function(t){this.m_gravity=t},I.prototype.GetGravity=function(){return this.m_gravity},I.prototype.GetGroundBody=function(){return this.m_groundBody},I.prototype.Step=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.m_flags&I.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~I.e_newFixture),this.m_flags|=I.e_locked;var o=I.s_timestep2;o.dt=t,o.velocityIterations=e,o.positionIterations=i,o.inv_dt=t>0?1/t:0,o.dtRatio=this.m_inv_dt0*t,o.warmStarting=I.m_warmStarting,this.m_contactManager.Collide(),o.dt>0&&this.Solve(o),I.m_continuousPhysics&&o.dt>0&&this.SolveTOI(o),o.dt>0&&(this.m_inv_dt0=o.inv_dt),this.m_flags&=~I.e_locked},I.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},I.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var t,e,i,s,a,l=this.m_debugDraw.GetFlags();new o,new o,new o;var h;new r,new r;var c=[new o,new o,new o,new o],m=new n(0,0,0);if(l&D.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next)for(h=t.m_xf,e=t.GetFixtureList();e;e=e.m_next)i=e.GetShape(),0==t.IsActive()?(m.Set(.5,.5,.3),this.DrawShape(i,h,m)):t.GetType()==x.b2_staticBody?(m.Set(.5,.9,.5),this.DrawShape(i,h,m)):t.GetType()==x.b2_kinematicBody?(m.Set(.5,.5,.9),this.DrawShape(i,h,m)):0==t.IsAwake()?(m.Set(.6,.6,.6),this.DrawShape(i,h,m)):(m.Set(.9,.7,.7),this.DrawShape(i,h,m));if(l&D.e_jointBit)for(s=this.m_jointList;s;s=s.m_next)this.DrawJoint(s);if(l&D.e_controllerBit)for(var _=this.m_controllerList;_;_=_.m_next)_.Draw(this.m_debugDraw);if(l&D.e_pairBit){m.Set(.3,.9,.9);for(var u=this.m_contactManager.m_contactList;u;u=u.GetNext()){var p=u.GetFixtureA(),y=u.GetFixtureB(),d=p.GetAABB().GetCenter(),f=y.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(d,f,m)}}if(l&D.e_aabbBit)for(a=this.m_contactManager.m_broadPhase,c=[new o,new o,new o,new o],t=this.m_bodyList;t;t=t.GetNext())if(0!=t.IsActive())for(e=t.GetFixtureList();e;e=e.GetNext()){var v=a.GetFatAABB(e.m_proxy);c[0].Set(v.lowerBound.x,v.lowerBound.y),c[1].Set(v.upperBound.x,v.lowerBound.y),c[2].Set(v.upperBound.x,v.upperBound.y),c[3].Set(v.lowerBound.x,v.upperBound.y),this.m_debugDraw.DrawPolygon(c,4,m)}if(l&D.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next)h=I.s_xf,h.R=t.m_xf.R,h.position=t.GetWorldCenter(),this.m_debugDraw.DrawTransform(h)}},I.prototype.QueryAABB=function(t,e){function i(e){return t(n.GetUserData(e))}var o=this,n=o.m_contactManager.m_broadPhase;n.Query(i,e)},I.prototype.QueryShape=function(t,e,o){function n(i){var n=a.GetUserData(i)instanceof w?a.GetUserData(i):null;return y.TestOverlap(e,o,n.GetShape(),n.GetBody().GetTransform())?t(n):!0}var s=this;void 0===o&&(o=null),null==o&&(o=new i,o.SetIdentity());var a=s.m_contactManager.m_broadPhase,l=new r;e.ComputeAABB(l,o),a.Query(n,l)},I.prototype.QueryPoint=function(t,e){function i(i){var o=n.GetUserData(i)instanceof w?n.GetUserData(i):null;return o.TestPoint(e)?t(o):!0}var o=this,n=o.m_contactManager.m_broadPhase,a=new r;a.lowerBound.Set(e.x-s.b2_linearSlop,e.y-s.b2_linearSlop),a.upperBound.Set(e.x+s.b2_linearSlop,e.y+s.b2_linearSlop),n.Query(i,a)},I.prototype.RayCast=function(t,e,i){function n(n,s){var a=new c,l=r.GetUserData(s),h=l instanceof w?l:null,m=h.RayCast(a,n);if(m){var _=a.fraction,u=new o((1-_)*e.x+_*i.x,(1-_)*e.y+_*i.y);return t(h,u,a.normal,_)}return n.maxFraction}var s=this,r=s.m_contactManager.m_broadPhase,a=new h(e,i);r.RayCast(n,a)},I.prototype.RayCastOne=function(t,e){function i(t,e,i,n){return void 0===n&&(n=0),o=t,n}var o,n=this;return n.RayCast(i,t,e),o},I.prototype.RayCastAll=function(t,e){function i(t,e,i,o){return void 0===o&&(o=0),n[n.length]=t,1}var o=this,n=new Vector;return o.RayCast(i,t,e),n},I.prototype.GetBodyList=function(){return this.m_bodyList},I.prototype.GetJointList=function(){return this.m_jointList},I.prototype.GetContactList=function(){return this.m_contactList},I.prototype.IsLocked=function(){return(this.m_flags&I.e_locked)>0},I.prototype.Solve=function(t){for(var e,i=this.m_controllerList;i;i=i.m_next)i.Step(t);var o=this.m_island;for(o.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),e=this.m_bodyList;e;e=e.m_next)e.m_flags&=~x.e_islandFlag;for(var n=this.m_contactList;n;n=n.m_next)n.m_flags&=~V.e_islandFlag;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var r=this.s_stack,a=this.m_bodyList;a;a=a.m_next)if(!(a.m_flags&x.e_islandFlag)&&0!=a.IsAwake()&&0!=a.IsActive()&&a.GetType()!=x.b2_staticBody){o.Clear();var l=0;for(r[l++]=a,a.m_flags|=x.e_islandFlag;l>0;)if(e=r[--l],o.AddBody(e),0==e.IsAwake()&&e.SetAwake(!0),e.GetType()!=x.b2_staticBody){for(var h,c=e.m_contactList;c;c=c.next)c.contact.m_flags&V.e_islandFlag||1!=c.contact.IsSensor()&&0!=c.contact.IsEnabled()&&0!=c.contact.IsTouching()&&(o.AddContact(c.contact),c.contact.m_flags|=V.e_islandFlag,h=c.other,h.m_flags&x.e_islandFlag||(r[l++]=h,h.m_flags|=x.e_islandFlag));for(var m=e.m_jointList;m;m=m.next)1!=m.joint.m_islandFlag&&(h=m.other,0!=h.IsActive()&&(o.AddJoint(m.joint),m.joint.m_islandFlag=!0,h.m_flags&x.e_islandFlag||(r[l++]=h,h.m_flags|=x.e_islandFlag)))}o.Solve(t,this.m_gravity,this.m_allowSleep);for(var _=0;_<o.m_bodyCount;++_)e=o.m_bodies[_],e.GetType()==x.b2_staticBody&&(e.m_flags&=~x.e_islandFlag)}for(_=0;_<r.length&&r[_];++_)r[_]=null;for(e=this.m_bodyList;e;e=e.m_next)0!=e.IsAwake()&&0!=e.IsActive()&&e.GetType()!=x.b2_staticBody&&e.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},I.prototype.SolveTOI=function(t){var e,i,o,n,r,a,l,h=this.m_island;h.Initialize(this.m_bodyCount,s.b2_maxTOIContactsPerIsland,s.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var c=I.s_queue;for(e=this.m_bodyList;e;e=e.m_next)e.m_flags&=~x.e_islandFlag,e.m_sweep.t0=0;var m;for(m=this.m_contactList;m;m=m.m_next)m.m_flags&=~(V.e_toiFlag|V.e_islandFlag);for(l=this.m_jointList;l;l=l.m_next)l.m_islandFlag=!1;for(;;){var _=null,u=1;for(m=this.m_contactList;m;m=m.m_next)if(1!=m.IsSensor()&&0!=m.IsEnabled()&&0!=m.IsContinuous()){var p=1;if(m.m_flags&V.e_toiFlag)p=m.m_toi;else{if(i=m.m_fixtureA,o=m.m_fixtureB,n=i.m_body,r=o.m_body,!(n.GetType()==x.b2_dynamicBody&&0!=n.IsAwake()||r.GetType()==x.b2_dynamicBody&&0!=r.IsAwake()))continue;var y=n.m_sweep.t0;n.m_sweep.t0<r.m_sweep.t0?(y=r.m_sweep.t0,n.m_sweep.Advance(y)):r.m_sweep.t0<n.m_sweep.t0&&(y=n.m_sweep.t0,r.m_sweep.Advance(y)),p=m.ComputeTOI(n.m_sweep,r.m_sweep),s.b2Assert(p>=0&&1>=p),p>0&&1>p&&(p=(1-p)*y+p,p>1&&(p=1)),m.m_toi=p,m.m_flags|=V.e_toiFlag}Number.MIN_VALUE<p&&u>p&&(_=m,u=p)}if(null==_||1-100*Number.MIN_VALUE<u)break;if(i=_.m_fixtureA,o=_.m_fixtureB,n=i.m_body,r=o.m_body,I.s_backupA.Set(n.m_sweep),I.s_backupB.Set(r.m_sweep),n.Advance(u),r.Advance(u),_.Update(this.m_contactManager.m_contactListener),_.m_flags&=~V.e_toiFlag,1!=_.IsSensor()&&0!=_.IsEnabled()){if(0!=_.IsTouching()){var d=n;d.GetType()!=x.b2_dynamicBody&&(d=r),h.Clear();var f=0,v=0;for(c[f+v++]=d,d.m_flags|=x.e_islandFlag;v>0;)if(e=c[f++],--v,h.AddBody(e),0==e.IsAwake()&&e.SetAwake(!0),e.GetType()==x.b2_dynamicBody){for(a=e.m_contactList;a&&h.m_contactCount!=h.m_contactCapacity;a=a.next)if(!(a.contact.m_flags&V.e_islandFlag)&&1!=a.contact.IsSensor()&&0!=a.contact.IsEnabled()&&0!=a.contact.IsTouching()){h.AddContact(a.contact),a.contact.m_flags|=V.e_islandFlag;var b=a.other;b.m_flags&x.e_islandFlag||(b.GetType()!=x.b2_staticBody&&(b.Advance(u),b.SetAwake(!0)),c[f+v]=b,++v,b.m_flags|=x.e_islandFlag)}for(var g=e.m_jointList;g;g=g.next)h.m_jointCount!=h.m_jointCapacity&&1!=g.joint.m_islandFlag&&(b=g.other,0!=b.IsActive()&&(h.AddJoint(g.joint),g.joint.m_islandFlag=!0,b.m_flags&x.e_islandFlag||(b.GetType()!=x.b2_staticBody&&(b.Advance(u),b.SetAwake(!0)),c[f+v]=b,++v,b.m_flags|=x.e_islandFlag)))}var D=I.s_timestep;D.warmStarting=!1,D.dt=(1-u)*t.dt,D.inv_dt=1/D.dt,D.dtRatio=0,D.velocityIterations=t.velocityIterations,D.positionIterations=t.positionIterations,h.SolveTOI(D);var C=0;for(C=0;C<h.m_bodyCount;++C)if(e=h.m_bodies[C],e.m_flags&=~x.e_islandFlag,0!=e.IsAwake()&&e.GetType()==x.b2_dynamicBody)for(e.SynchronizeFixtures(),a=e.m_contactList;a;a=a.next)a.contact.m_flags&=~V.e_toiFlag;for(C=0;C<h.m_contactCount;++C)m=h.m_contacts[C],m.m_flags&=~(V.e_toiFlag|V.e_islandFlag);for(C=0;C<h.m_jointCount;++C)l=h.m_joints[C],l.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else n.m_sweep.Set(I.s_backupA),r.m_sweep.Set(I.s_backupB),n.SynchronizeTransform(),r.SynchronizeTransform()}},I.prototype.DrawJoint=function(t){var e=t.GetBodyA(),i=t.GetBodyB(),o=e.m_xf,n=i.m_xf,s=o.position,r=n.position,a=t.GetAnchorA(),l=t.GetAnchorB(),h=I.s_jointColor;switch(t.m_type){case T.e_distanceJoint:this.m_debugDraw.DrawSegment(a,l,h);break;case T.e_pulleyJoint:var c=t instanceof G?t:null,m=c.GetGroundAnchorA(),_=c.GetGroundAnchorB();this.m_debugDraw.DrawSegment(m,a,h),this.m_debugDraw.DrawSegment(_,l,h),this.m_debugDraw.DrawSegment(m,_,h);break;case T.e_mouseJoint:this.m_debugDraw.DrawSegment(a,l,h);break;default:e!=this.m_groundBody&&this.m_debugDraw.DrawSegment(s,a,h),this.m_debugDraw.DrawSegment(a,l,h),i!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,l,h)}},I.prototype.DrawShape=function(e,i,o){switch(e.m_type){case y.e_circleShape:var n=e instanceof m?e:null,s=t.MulX(i,n.m_p),r=n.m_radius,a=i.R.col1;this.m_debugDraw.DrawSolidCircle(s,r,a,o);break;case y.e_polygonShape:var l=0,h=e instanceof p?e:null,c=parseInt(h.GetVertexCount()),u=h.GetVertices(),x=new Vector(c);for(l=0;c>l;++l)x[l]=t.MulX(i,u[l]);this.m_debugDraw.DrawSolidPolygon(x,c,o);break;case y.e_edgeShape:var d=e instanceof _?e:null;this.m_debugDraw.DrawSegment(t.MulX(i,d.GetVertex1()),t.MulX(i,d.GetVertex2()),o)}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new M,Box2D.Dynamics.b2World.s_xf=new i,Box2D.Dynamics.b2World.s_backupA=new e,Box2D.Dynamics.b2World.s_backupB=new e,Box2D.Dynamics.b2World.s_timestep=new M,Box2D.Dynamics.b2World.s_queue=new Vector,Box2D.Dynamics.b2World.s_jointColor=new n(.5,.8,.8),Box2D.Dynamics.b2World.e_newFixture=1,Box2D.Dynamics.b2World.e_locked=2})}(),function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape),i=(Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape),o=Box2D.Collision.Shapes.b2Shape,n=Box2D.Dynamics.Contacts.b2CircleContact,s=Box2D.Dynamics.Contacts.b2Contact,r=Box2D.Dynamics.Contacts.b2ContactConstraint,a=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,l=Box2D.Dynamics.Contacts.b2ContactEdge,h=Box2D.Dynamics.Contacts.b2ContactFactory,c=Box2D.Dynamics.Contacts.b2ContactRegister,m=Box2D.Dynamics.Contacts.b2ContactResult,_=Box2D.Dynamics.Contacts.b2ContactSolver,u=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,p=Box2D.Dynamics.Contacts.b2NullContact,y=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,x=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,d=Box2D.Dynamics.Contacts.b2PolygonContact,f=Box2D.Dynamics.Contacts.b2PositionSolverManifold,v=Box2D.Dynamics.b2Body,b=(Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep),g=(Box2D.Dynamics.b2World,Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),D=Box2D.Common.Math.b2Mat22,C=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),B=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),w=(Box2D.Common.Math.b2Vec3,Box2D.Collision.b2AABB,Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision),S=Box2D.Collision.b2ContactID,A=(Box2D.Collision.b2ContactPoint,Box2D.Collision.b2Distance,Box2D.Collision.b2DistanceInput,Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2DistanceProxy,Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold),M=(Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput,Box2D.Collision.b2RayCastOutput,Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache,Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact),I=Box2D.Collision.b2TOIInput,V=Box2D.Collision.b2WorldManifold;Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase,Box2D.inherit(n,Box2D.Dynamics.Contacts.b2Contact),n.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,n.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},n.Create=function(){return new n},n.Destroy=function(){},n.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},n.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody();
w.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)},s.b2Contact=function(){this.m_nodeA=new l,this.m_nodeB=new l,this.m_manifold=new A,this.m_oldManifold=new A},s.prototype.GetManifold=function(){return this.m_manifold},s.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),o=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),o.m_radius,i.GetTransform(),n.m_radius)},s.prototype.IsTouching=function(){return(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag},s.prototype.IsContinuous=function(){return(this.m_flags&s.e_continuousFlag)==s.e_continuousFlag},s.prototype.SetSensor=function(t){t?this.m_flags|=s.e_sensorFlag:this.m_flags&=~s.e_sensorFlag},s.prototype.IsSensor=function(){return(this.m_flags&s.e_sensorFlag)==s.e_sensorFlag},s.prototype.SetEnabled=function(t){t?this.m_flags|=s.e_enabledFlag:this.m_flags&=~s.e_enabledFlag},s.prototype.IsEnabled=function(){return(this.m_flags&s.e_enabledFlag)==s.e_enabledFlag},s.prototype.GetNext=function(){return this.m_next},s.prototype.GetFixtureA=function(){return this.m_fixtureA},s.prototype.GetFixtureB=function(){return this.m_fixtureB},s.prototype.FlagForFiltering=function(){this.m_flags|=s.e_filterFlag},s.prototype.b2Contact=function(){},s.prototype.Reset=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=null),this.m_flags=s.e_enabledFlag,!t||!e)return this.m_fixtureA=null,this.m_fixtureB=null,void 0;(t.IsSensor()||e.IsSensor())&&(this.m_flags|=s.e_sensorFlag);var i=t.GetBody(),o=e.GetBody();(i.GetType()!=v.b2_dynamicBody||i.IsBullet()||o.GetType()!=v.b2_dynamicBody||o.IsBullet())&&(this.m_flags|=s.e_continuousFlag),this.m_fixtureA=t,this.m_fixtureB=e,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},s.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_flags|=s.e_enabledFlag;var i=!1,n=(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag,r=this.m_fixtureA.m_body,a=this.m_fixtureB.m_body,l=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&s.e_sensorFlag){if(l){var h=this.m_fixtureA.GetShape(),c=this.m_fixtureB.GetShape(),m=r.GetTransform(),_=a.GetTransform();i=o.TestOverlap(h,m,c,_)}this.m_manifold.m_pointCount=0}else{if(r.GetType()!=v.b2_dynamicBody||r.IsBullet()||a.GetType()!=v.b2_dynamicBody||a.IsBullet()?this.m_flags|=s.e_continuousFlag:this.m_flags&=~s.e_continuousFlag,l){this.Evaluate(),i=this.m_manifold.m_pointCount>0;for(var u=0;u<this.m_manifold.m_pointCount;++u){var p=this.m_manifold.m_points[u];p.m_normalImpulse=0,p.m_tangentImpulse=0;for(var y=p.m_id,x=0;x<this.m_oldManifold.m_pointCount;++x){var d=this.m_oldManifold.m_points[x];if(d.m_id.key==y.key){p.m_normalImpulse=d.m_normalImpulse,p.m_tangentImpulse=d.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;i!=n&&(r.SetAwake(!0),a.SetAwake(!0))}i?this.m_flags|=s.e_touchingFlag:this.m_flags&=~s.e_touchingFlag,0==n&&1==i&&t.BeginContact(this),1==n&&0==i&&t.EndContact(this),0==(this.m_flags&s.e_sensorFlag)&&t.PreSolve(this,this.m_oldManifold)},s.prototype.Evaluate=function(){},s.prototype.ComputeTOI=function(t,e){return s.s_input.proxyA.Set(this.m_fixtureA.GetShape()),s.s_input.proxyB.Set(this.m_fixtureB.GetShape()),s.s_input.sweepA=t,s.s_input.sweepB=e,s.s_input.tolerance=g.b2_linearSlop,M.TimeOfImpact(s.s_input)},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1,Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2,Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4,Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8,Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16,Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32,Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64,Box2D.Dynamics.Contacts.b2Contact.s_input=new I}),r.b2ContactConstraint=function(){this.localPlaneNormal=new B,this.localPoint=new B,this.normal=new B,this.normalMass=new D,this.K=new D},r.prototype.b2ContactConstraint=function(){this.points=new Vector(g.b2_maxManifoldPoints);for(var t=0;t<g.b2_maxManifoldPoints;t++)this.points[t]=new a},a.b2ContactConstraintPoint=function(){this.localPoint=new B,this.rA=new B,this.rB=new B},l.b2ContactEdge=function(){},h.b2ContactFactory=function(){},h.prototype.b2ContactFactory=function(t){this.m_allocator=t,this.InitializeRegisters()},h.prototype.AddType=function(t,e,i,o){void 0===i&&(i=0),void 0===o&&(o=0),this.m_registers[i][o].createFcn=t,this.m_registers[i][o].destroyFcn=e,this.m_registers[i][o].primary=!0,i!=o&&(this.m_registers[o][i].createFcn=t,this.m_registers[o][i].destroyFcn=e,this.m_registers[o][i].primary=!1)},h.prototype.InitializeRegisters=function(){this.m_registers=new Vector(o.e_shapeTypeCount);for(var t=0;t<o.e_shapeTypeCount;t++){this.m_registers[t]=new Vector(o.e_shapeTypeCount);for(var e=0;e<o.e_shapeTypeCount;e++)this.m_registers[t][e]=new c}this.AddType(n.Create,n.Destroy,o.e_circleShape,o.e_circleShape),this.AddType(y.Create,y.Destroy,o.e_polygonShape,o.e_circleShape),this.AddType(d.Create,d.Destroy,o.e_polygonShape,o.e_polygonShape),this.AddType(u.Create,u.Destroy,o.e_edgeShape,o.e_circleShape),this.AddType(x.Create,x.Destroy,o.e_polygonShape,o.e_edgeShape)},h.prototype.Create=function(t,e){var i,o=parseInt(t.GetType()),n=parseInt(e.GetType()),s=this.m_registers[o][n];if(s.pool)return i=s.pool,s.pool=i.m_next,s.poolCount--,i.Reset(t,e),i;var r=s.createFcn;return null!=r?s.primary?(i=r(this.m_allocator),i.Reset(t,e),i):(i=r(this.m_allocator),i.Reset(e,t),i):null},h.prototype.Destroy=function(t){t.m_manifold.m_pointCount>0&&(t.m_fixtureA.m_body.SetAwake(!0),t.m_fixtureB.m_body.SetAwake(!0));var e=parseInt(t.m_fixtureA.GetType()),i=parseInt(t.m_fixtureB.GetType()),o=this.m_registers[e][i];o.poolCount++,t.m_next=o.pool,o.pool=t;var n=o.destroyFcn;n(t,this.m_allocator)},c.b2ContactRegister=function(){},m.b2ContactResult=function(){this.position=new B,this.normal=new B,this.id=new S},_.b2ContactSolver=function(){this.m_step=new b,this.m_constraints=new Vector},_.prototype.b2ContactSolver=function(){},_.prototype.Initialize=function(t,e,i,o){void 0===i&&(i=0);var n;this.m_step.Set(t),this.m_allocator=o;var s=0;for(this.m_constraintCount=i;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new r;for(s=0;i>s;++s){n=e[s];var a=n.m_fixtureA,l=n.m_fixtureB,h=a.m_shape,c=l.m_shape,m=h.m_radius,u=c.m_radius,p=a.m_body,y=l.m_body,x=n.GetManifold(),d=g.b2MixFriction(a.GetFriction(),l.GetFriction()),f=g.b2MixRestitution(a.GetRestitution(),l.GetRestitution()),v=p.m_linearVelocity.x,b=p.m_linearVelocity.y,D=y.m_linearVelocity.x,C=y.m_linearVelocity.y,B=p.m_angularVelocity,w=y.m_angularVelocity;g.b2Assert(x.m_pointCount>0),_.s_worldManifold.Initialize(x,p.m_xf,m,y.m_xf,u);var S=_.s_worldManifold.m_normal.x,A=_.s_worldManifold.m_normal.y,M=this.m_constraints[s];M.bodyA=p,M.bodyB=y,M.manifold=x,M.normal.x=S,M.normal.y=A,M.pointCount=x.m_pointCount,M.friction=d,M.restitution=f,M.localPlaneNormal.x=x.m_localPlaneNormal.x,M.localPlaneNormal.y=x.m_localPlaneNormal.y,M.localPoint.x=x.m_localPoint.x,M.localPoint.y=x.m_localPoint.y,M.radius=m+u,M.type=x.m_type;for(var I=0;I<M.pointCount;++I){var V=x.m_points[I],L=M.points[I];L.normalImpulse=V.m_normalImpulse,L.tangentImpulse=V.m_tangentImpulse,L.localPoint.SetV(V.m_localPoint);var P=L.rA.x=_.s_worldManifold.m_points[I].x-p.m_sweep.c.x,T=L.rA.y=_.s_worldManifold.m_points[I].y-p.m_sweep.c.y,G=L.rB.x=_.s_worldManifold.m_points[I].x-y.m_sweep.c.x,R=L.rB.y=_.s_worldManifold.m_points[I].y-y.m_sweep.c.y,F=P*A-T*S,E=G*A-R*S;F*=F,E*=E;var J=p.m_invMass+y.m_invMass+p.m_invI*F+y.m_invI*E;L.normalMass=1/J;var j=p.m_mass*p.m_invMass+y.m_mass*y.m_invMass;j+=p.m_mass*p.m_invI*F+y.m_mass*y.m_invI*E,L.equalizedMass=1/j;var k=A,O=-S,N=P*O-T*k,z=G*O-R*k;N*=N,z*=z;var X=p.m_invMass+y.m_invMass+p.m_invI*N+y.m_invI*z;L.tangentMass=1/X,L.velocityBias=0;var U=D+-w*R-v- -B*T,q=C+w*G-b-B*P,W=M.normal.x*U+M.normal.y*q;W<-g.b2_velocityThreshold&&(L.velocityBias+=-M.restitution*W)}if(2==M.pointCount){var Y=M.points[0],K=M.points[1],Q=p.m_invMass,H=p.m_invI,Z=y.m_invMass,$=y.m_invI,te=Y.rA.x*A-Y.rA.y*S,ee=Y.rB.x*A-Y.rB.y*S,ie=K.rA.x*A-K.rA.y*S,oe=K.rB.x*A-K.rB.y*S,ne=Q+Z+H*te*te+$*ee*ee,se=Q+Z+H*ie*ie+$*oe*oe,re=Q+Z+H*te*ie+$*ee*oe,ae=100;ae*(ne*se-re*re)>ne*ne?(M.K.col1.Set(ne,re),M.K.col2.Set(re,se),M.K.GetInverse(M.normalMass)):M.pointCount=1}}},_.prototype.InitVelocityConstraints=function(t){for(var e=0;e<this.m_constraintCount;++e){var i=this.m_constraints[e],o=i.bodyA,n=i.bodyB,s=o.m_invMass,r=o.m_invI,a=n.m_invMass,l=n.m_invI,h=i.normal.x,c=i.normal.y,m=c,_=-h,u=0,p=0;if(t.warmStarting)for(p=i.pointCount,u=0;p>u;++u){var y=i.points[u];y.normalImpulse*=t.dtRatio,y.tangentImpulse*=t.dtRatio;var x=y.normalImpulse*h+y.tangentImpulse*m,d=y.normalImpulse*c+y.tangentImpulse*_;o.m_angularVelocity-=r*(y.rA.x*d-y.rA.y*x),o.m_linearVelocity.x-=s*x,o.m_linearVelocity.y-=s*d,n.m_angularVelocity+=l*(y.rB.x*d-y.rB.y*x),n.m_linearVelocity.x+=a*x,n.m_linearVelocity.y+=a*d}else for(p=i.pointCount,u=0;p>u;++u){var f=i.points[u];f.normalImpulse=0,f.tangentImpulse=0}}},_.prototype.SolveVelocityConstraints=function(){for(var t,e,i=0,o=0,n=0,s=0,r=0,a=0,l=0,h=0,c=0,m=0,_=0,u=0,p=0,y=0,x=0,d=0,f=0;f<this.m_constraintCount;++f){var v=this.m_constraints[f],b=v.bodyA,g=v.bodyB,D=b.m_angularVelocity,B=g.m_angularVelocity,w=b.m_linearVelocity,S=g.m_linearVelocity,A=b.m_invMass,M=b.m_invI,I=g.m_invMass,V=g.m_invI,L=v.normal.x,P=v.normal.y,T=P,G=-L,R=v.friction;for(i=0;i<v.pointCount;i++)t=v.points[i],o=S.x-B*t.rB.y-w.x+D*t.rA.y,n=S.y+B*t.rB.x-w.y-D*t.rA.x,r=o*T+n*G,a=t.tangentMass*-r,l=R*t.normalImpulse,h=C.Clamp(t.tangentImpulse+a,-l,l),a=h-t.tangentImpulse,c=a*T,m=a*G,w.x-=A*c,w.y-=A*m,D-=M*(t.rA.x*m-t.rA.y*c),S.x+=I*c,S.y+=I*m,B+=V*(t.rB.x*m-t.rB.y*c),t.tangentImpulse=h;if(parseInt(v.pointCount),1==v.pointCount)t=v.points[0],o=S.x+-B*t.rB.y-w.x- -D*t.rA.y,n=S.y+B*t.rB.x-w.y-D*t.rA.x,s=o*L+n*P,a=-t.normalMass*(s-t.velocityBias),h=t.normalImpulse+a,h=h>0?h:0,a=h-t.normalImpulse,c=a*L,m=a*P,w.x-=A*c,w.y-=A*m,D-=M*(t.rA.x*m-t.rA.y*c),S.x+=I*c,S.y+=I*m,B+=V*(t.rB.x*m-t.rB.y*c),t.normalImpulse=h;else{var F=v.points[0],E=v.points[1],J=F.normalImpulse,j=E.normalImpulse,k=S.x-B*F.rB.y-w.x+D*F.rA.y,O=S.y+B*F.rB.x-w.y-D*F.rA.x,N=S.x-B*E.rB.y-w.x+D*E.rA.y,z=S.y+B*E.rB.x-w.y-D*E.rA.x,X=k*L+O*P,U=N*L+z*P,q=X-F.velocityBias,W=U-E.velocityBias;for(e=v.K,q-=e.col1.x*J+e.col2.x*j,W-=e.col1.y*J+e.col2.y*j;;){e=v.normalMass;var Y=-(e.col1.x*q+e.col2.x*W),K=-(e.col1.y*q+e.col2.y*W);if(Y>=0&&K>=0){_=Y-J,u=K-j,p=_*L,y=_*P,x=u*L,d=u*P,w.x-=A*(p+x),w.y-=A*(y+d),D-=M*(F.rA.x*y-F.rA.y*p+E.rA.x*d-E.rA.y*x),S.x+=I*(p+x),S.y+=I*(y+d),B+=V*(F.rB.x*y-F.rB.y*p+E.rB.x*d-E.rB.y*x),F.normalImpulse=Y,E.normalImpulse=K;break}if(Y=-F.normalMass*q,K=0,X=0,U=v.K.col1.y*Y+W,Y>=0&&U>=0){_=Y-J,u=K-j,p=_*L,y=_*P,x=u*L,d=u*P,w.x-=A*(p+x),w.y-=A*(y+d),D-=M*(F.rA.x*y-F.rA.y*p+E.rA.x*d-E.rA.y*x),S.x+=I*(p+x),S.y+=I*(y+d),B+=V*(F.rB.x*y-F.rB.y*p+E.rB.x*d-E.rB.y*x),F.normalImpulse=Y,E.normalImpulse=K;break}if(Y=0,K=-E.normalMass*W,X=v.K.col2.x*K+q,U=0,K>=0&&X>=0){_=Y-J,u=K-j,p=_*L,y=_*P,x=u*L,d=u*P,w.x-=A*(p+x),w.y-=A*(y+d),D-=M*(F.rA.x*y-F.rA.y*p+E.rA.x*d-E.rA.y*x),S.x+=I*(p+x),S.y+=I*(y+d),B+=V*(F.rB.x*y-F.rB.y*p+E.rB.x*d-E.rB.y*x),F.normalImpulse=Y,E.normalImpulse=K;break}if(Y=0,K=0,X=q,U=W,X>=0&&U>=0){_=Y-J,u=K-j,p=_*L,y=_*P,x=u*L,d=u*P,w.x-=A*(p+x),w.y-=A*(y+d),D-=M*(F.rA.x*y-F.rA.y*p+E.rA.x*d-E.rA.y*x),S.x+=I*(p+x),S.y+=I*(y+d),B+=V*(F.rB.x*y-F.rB.y*p+E.rB.x*d-E.rB.y*x),F.normalImpulse=Y,E.normalImpulse=K;break}break}}b.m_angularVelocity=D,g.m_angularVelocity=B}},_.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t)for(var e=this.m_constraints[t],i=e.manifold,o=0;o<e.pointCount;++o){var n=i.m_points[o],s=e.points[o];n.m_normalImpulse=s.normalImpulse,n.m_tangentImpulse=s.tangentImpulse}},_.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);for(var e=0,i=0;i<this.m_constraintCount;i++){var o=this.m_constraints[i],n=o.bodyA,s=o.bodyB,r=n.m_mass*n.m_invMass,a=n.m_mass*n.m_invI,l=s.m_mass*s.m_invMass,h=s.m_mass*s.m_invI;_.s_psm.Initialize(o);for(var c=_.s_psm.m_normal,m=0;m<o.pointCount;m++){var u=o.points[m],p=_.s_psm.m_points[m],y=_.s_psm.m_separations[m],x=p.x-n.m_sweep.c.x,d=p.y-n.m_sweep.c.y,f=p.x-s.m_sweep.c.x,v=p.y-s.m_sweep.c.y;e=y>e?e:y;var b=C.Clamp(t*(y+g.b2_linearSlop),-g.b2_maxLinearCorrection,0),D=-u.equalizedMass*b,B=D*c.x,w=D*c.y;n.m_sweep.c.x-=r*B,n.m_sweep.c.y-=r*w,n.m_sweep.a-=a*(x*w-d*B),n.SynchronizeTransform(),s.m_sweep.c.x+=l*B,s.m_sweep.c.y+=l*w,s.m_sweep.a+=h*(f*w-v*B),s.SynchronizeTransform()}}return e>-1.5*g.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new V,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new f}),Box2D.inherit(u,Box2D.Dynamics.Contacts.b2Contact),u.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,u.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},u.Create=function(){return new u},u.Destroy=function(){},u.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},u.prototype.Evaluate=function(){var i=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,i.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,o.m_xf)},u.prototype.b2CollideEdgeAndCircle=function(){},Box2D.inherit(p,Box2D.Dynamics.Contacts.b2Contact),p.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,p.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},p.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},p.prototype.Evaluate=function(){},Box2D.inherit(y,Box2D.Dynamics.Contacts.b2Contact),y.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,y.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},y.Create=function(){return new y},y.Destroy=function(){},y.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e),g.b2Assert(t.GetType()==o.e_polygonShape),g.b2Assert(e.GetType()==o.e_circleShape)},y.prototype.Evaluate=function(){var e=this.m_fixtureA.m_body,o=this.m_fixtureB.m_body;w.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,o.m_xf)},Box2D.inherit(x,Box2D.Dynamics.Contacts.b2Contact),x.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,x.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},x.Create=function(){return new x},x.Destroy=function(){},x.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e),g.b2Assert(t.GetType()==o.e_polygonShape),g.b2Assert(e.GetType()==o.e_edgeShape)},x.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,o.m_xf)},x.prototype.b2CollidePolyAndEdge=function(){},Box2D.inherit(d,Box2D.Dynamics.Contacts.b2Contact),d.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,d.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},d.Create=function(){return new d},d.Destroy=function(){},d.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},d.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody();w.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,e.m_xf)},f.b2PositionSolverManifold=function(){},f.prototype.b2PositionSolverManifold=function(){this.m_normal=new B,this.m_separations=new Vector_a2j_Number(g.b2_maxManifoldPoints),this.m_points=new Vector(g.b2_maxManifoldPoints);for(var t=0;t<g.b2_maxManifoldPoints;t++)this.m_points[t]=new B},f.prototype.Initialize=function(t){g.b2Assert(t.pointCount>0);var e,i,o=0,n=0,s=0,r=0,a=0;switch(t.type){case A.e_circles:e=t.bodyA.m_xf.R,i=t.localPoint;var l=t.bodyA.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),h=t.bodyA.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y);e=t.bodyB.m_xf.R,i=t.points[0].localPoint;var c=t.bodyB.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),m=t.bodyB.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),_=c-l,u=m-h,p=_*_+u*u;if(p>Number.MIN_VALUE*Number.MIN_VALUE){var y=Math.sqrt(p);this.m_normal.x=_/y,this.m_normal.y=u/y}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(l+c),this.m_points[0].y=.5*(h+m),this.m_separations[0]=_*this.m_normal.x+u*this.m_normal.y-t.radius;break;case A.e_faceA:for(e=t.bodyA.m_xf.R,i=t.localPlaneNormal,this.m_normal.x=e.col1.x*i.x+e.col2.x*i.y,this.m_normal.y=e.col1.y*i.x+e.col2.y*i.y,e=t.bodyA.m_xf.R,i=t.localPoint,r=t.bodyA.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),a=t.bodyA.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),e=t.bodyB.m_xf.R,o=0;o<t.pointCount;++o)i=t.points[o].localPoint,n=t.bodyB.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),s=t.bodyB.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),this.m_separations[o]=(n-r)*this.m_normal.x+(s-a)*this.m_normal.y-t.radius,this.m_points[o].x=n,this.m_points[o].y=s;break;case A.e_faceB:for(e=t.bodyB.m_xf.R,i=t.localPlaneNormal,this.m_normal.x=e.col1.x*i.x+e.col2.x*i.y,this.m_normal.y=e.col1.y*i.x+e.col2.y*i.y,e=t.bodyB.m_xf.R,i=t.localPoint,r=t.bodyB.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),a=t.bodyB.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),e=t.bodyA.m_xf.R,o=0;o<t.pointCount;++o)i=t.points[o].localPoint,n=t.bodyA.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),s=t.bodyA.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),this.m_separations[o]=(n-r)*this.m_normal.x+(s-a)*this.m_normal.y-t.radius,this.m_points[o].Set(n,s);this.m_normal.x*=-1,this.m_normal.y*=-1}},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new B,Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new B})}(),function(){var t=(Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World,Box2D.Common.Math.b2Mat22),e=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),i=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),o=(Box2D.Common.Math.b2Vec3,Box2D.Common.b2Color),n=(Box2D.Common.b2internal,Box2D.Common.b2Settings,Box2D.Collision.Shapes.b2CircleShape,Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape,Box2D.Collision.Shapes.b2Shape,Box2D.Dynamics.Controllers.b2BuoyancyController),s=Box2D.Dynamics.Controllers.b2ConstantAccelController,r=Box2D.Dynamics.Controllers.b2ConstantForceController,a=Box2D.Dynamics.Controllers.b2Controller,l=Box2D.Dynamics.Controllers.b2ControllerEdge,h=Box2D.Dynamics.Controllers.b2GravityController,c=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(n,Box2D.Dynamics.Controllers.b2Controller),n.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,n.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new i(0,-1),this.offset=0,this.density=0,this.velocity=new i(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},n.prototype.Step=function(){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;if(0!=e.IsAwake()){for(var o=new i,n=new i,s=0,r=0,a=e.GetFixtureList();a;a=a.GetNext()){var l=new i,h=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,e.GetTransform(),l);s+=h,o.x+=h*l.x,o.y+=h*l.y;var c=0;c=this.useDensity?1:1,r+=h*c,n.x+=h*l.x*c,n.y+=h*l.y*c}if(o.x/=s,o.y/=s,n.x/=r,n.y/=r,!(s<Number.MIN_VALUE)){var m=this.gravity.GetNegative();m.Multiply(this.density*s),e.ApplyForce(m,n);var _=e.GetLinearVelocityFromWorldPoint(o);_.Subtract(this.velocity),_.Multiply(-this.linearDrag*s),e.ApplyForce(_,o),e.ApplyTorque(-e.GetInertia()/e.GetMass()*s*e.GetAngularVelocity()*this.angularDrag)}}}}},n.prototype.Draw=function(t){var e=1e3,n=new i,s=new i;n.x=this.normal.x*this.offset+this.normal.y*e,n.y=this.normal.y*this.offset-this.normal.x*e,s.x=this.normal.x*this.offset-this.normal.y*e,s.y=this.normal.y*this.offset+this.normal.x*e;var r=new o(0,0,1);t.DrawSegment(n,s,r)},Box2D.inherit(s,Box2D.Dynamics.Controllers.b2Controller),s.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,s.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new i(0,0)},s.prototype.Step=function(t){for(var e=new i(this.A.x*t.dt,this.A.y*t.dt),o=this.m_bodyList;o;o=o.nextBody){var n=o.body;n.IsAwake()&&n.SetLinearVelocity(new i(n.GetLinearVelocity().x+e.x,n.GetLinearVelocity().y+e.y))}},Box2D.inherit(r,Box2D.Dynamics.Controllers.b2Controller),r.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,r.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new i(0,0)},r.prototype.Step=function(){for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;e.IsAwake()&&e.ApplyForce(this.F,e.GetWorldCenter())}},a.b2Controller=function(){},a.prototype.Step=function(){},a.prototype.Draw=function(){},a.prototype.AddBody=function(t){var e=new l;e.controller=this,e.body=t,e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList=e,e.nextBody&&(e.nextBody.prevBody=e),this.m_bodyCount++,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList=e,e.nextController&&(e.nextController.prevController=e),t.m_controllerCount++},a.prototype.RemoveBody=function(t){for(var e=t.m_controllerList;e&&e.controller!=this;)e=e.nextController;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),this.m_bodyList==e&&(this.m_bodyList=e.nextBody),t.m_controllerList==e&&(t.m_controllerList=e.nextController),t.m_controllerCount--,this.m_bodyCount--},a.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},a.prototype.GetNext=function(){return this.m_next},a.prototype.GetWorld=function(){return this.m_world},a.prototype.GetBodyList=function(){return this.m_bodyList},l.b2ControllerEdge=function(){},Box2D.inherit(h,Box2D.Dynamics.Controllers.b2Controller),h.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,h.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},h.prototype.Step=function(){var t=null,e=null,o=null,n=0,s=null,r=null,a=null,l=0,h=0,c=0,m=null;if(this.invSqr)for(t=this.m_bodyList;t;t=t.nextBody)for(e=t.body,o=e.GetWorldCenter(),n=e.GetMass(),s=this.m_bodyList;s!=t;s=s.nextBody)r=s.body,a=r.GetWorldCenter(),l=a.x-o.x,h=a.y-o.y,c=l*l+h*h,c<Number.MIN_VALUE||(m=new i(l,h),m.Multiply(this.G/c/Math.sqrt(c)*n*r.GetMass()),e.IsAwake()&&e.ApplyForce(m,o),m.Multiply(-1),r.IsAwake()&&r.ApplyForce(m,a));else for(t=this.m_bodyList;t;t=t.nextBody)for(e=t.body,o=e.GetWorldCenter(),n=e.GetMass(),s=this.m_bodyList;s!=t;s=s.nextBody)r=s.body,a=r.GetWorldCenter(),l=a.x-o.x,h=a.y-o.y,c=l*l+h*h,c<Number.MIN_VALUE||(m=new i(l,h),m.Multiply(this.G/c*n*r.GetMass()),e.IsAwake()&&e.ApplyForce(m,o),m.Multiply(-1),r.IsAwake()&&r.ApplyForce(m,a))},Box2D.inherit(c,Box2D.Dynamics.Controllers.b2Controller),c.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,c.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new t,this.maxTimestep=0},c.prototype.SetAxisAligned=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.T.col1.x=-t,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-e,this.maxTimestep=t>0||e>0?1/Math.max(t,e):0},c.prototype.Step=function(t){var o=t.dt;if(!(o<=Number.MIN_VALUE)){o>this.maxTimestep&&this.maxTimestep>0&&(o=this.maxTimestep);for(var n=this.m_bodyList;n;n=n.nextBody){var s=n.body;if(s.IsAwake()){var r=s.GetWorldVector(e.MulMV(this.T,s.GetLocalVector(s.GetLinearVelocity())));s.SetLinearVelocity(new i(s.GetLinearVelocity().x+r.x*o,s.GetLinearVelocity().y+r.y*o))}}}}}(),function(){var t=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),e=Box2D.Common.Math.b2Mat22,i=Box2D.Common.Math.b2Mat33,o=Box2D.Common.Math.b2Math,n=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),s=Box2D.Common.Math.b2Vec3,r=Box2D.Dynamics.Joints.b2DistanceJoint,a=Box2D.Dynamics.Joints.b2DistanceJointDef,l=Box2D.Dynamics.Joints.b2FrictionJoint,h=Box2D.Dynamics.Joints.b2FrictionJointDef,c=Box2D.Dynamics.Joints.b2GearJoint,m=Box2D.Dynamics.Joints.b2GearJointDef,_=Box2D.Dynamics.Joints.b2Jacobian,u=Box2D.Dynamics.Joints.b2Joint,p=Box2D.Dynamics.Joints.b2JointDef,y=Box2D.Dynamics.Joints.b2JointEdge,x=Box2D.Dynamics.Joints.b2LineJoint,d=Box2D.Dynamics.Joints.b2LineJointDef,f=Box2D.Dynamics.Joints.b2MouseJoint,v=Box2D.Dynamics.Joints.b2MouseJointDef,b=Box2D.Dynamics.Joints.b2PrismaticJoint,g=Box2D.Dynamics.Joints.b2PrismaticJointDef,D=Box2D.Dynamics.Joints.b2PulleyJoint,C=Box2D.Dynamics.Joints.b2PulleyJointDef,B=Box2D.Dynamics.Joints.b2RevoluteJoint,w=Box2D.Dynamics.Joints.b2RevoluteJointDef,S=Box2D.Dynamics.Joints.b2WeldJoint,A=Box2D.Dynamics.Joints.b2WeldJointDef;Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World,Box2D.inherit(r,Box2D.Dynamics.Joints.b2Joint),r.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,r.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_u=new n},r.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},r.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},r.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)},r.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},r.prototype.GetLength=function(){return this.m_length},r.prototype.SetLength=function(t){void 0===t&&(t=0),this.m_length=t},r.prototype.GetFrequency=function(){return this.m_frequencyHz},r.prototype.SetFrequency=function(t){void 0===t&&(t=0),this.m_frequencyHz=t},r.prototype.GetDampingRatio=function(){return this.m_dampingRatio},r.prototype.SetDampingRatio=function(t){void 0===t&&(t=0),this.m_dampingRatio=t},r.prototype.b2DistanceJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_length=t.length,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},r.prototype.InitVelocityConstraints=function(e){var i,o=0,n=this.m_bodyA,s=this.m_bodyB;i=n.m_xf.R;var r=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y;o=i.col1.x*r+i.col2.x*a,a=i.col1.y*r+i.col2.y*a,r=o,i=s.m_xf.R;var l=this.m_localAnchor2.x-s.m_sweep.localCenter.x,h=this.m_localAnchor2.y-s.m_sweep.localCenter.y;o=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=o,this.m_u.x=s.m_sweep.c.x+l-n.m_sweep.c.x-r,this.m_u.y=s.m_sweep.c.y+h-n.m_sweep.c.y-a;var c=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);c>t.b2_linearSlop?this.m_u.Multiply(1/c):this.m_u.SetZero();var m=r*this.m_u.y-a*this.m_u.x,_=l*this.m_u.y-h*this.m_u.x,u=n.m_invMass+n.m_invI*m*m+s.m_invMass+s.m_invI*_*_;if(this.m_mass=0!=u?1/u:0,this.m_frequencyHz>0){var p=c-this.m_length,y=2*Math.PI*this.m_frequencyHz,x=2*this.m_mass*this.m_dampingRatio*y,d=this.m_mass*y*y;this.m_gamma=e.dt*(x+e.dt*d),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=p*e.dt*d*this.m_gamma,this.m_mass=u+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}if(e.warmStarting){this.m_impulse*=e.dtRatio;var f=this.m_impulse*this.m_u.x,v=this.m_impulse*this.m_u.y;n.m_linearVelocity.x-=n.m_invMass*f,n.m_linearVelocity.y-=n.m_invMass*v,n.m_angularVelocity-=n.m_invI*(r*v-a*f),s.m_linearVelocity.x+=s.m_invMass*f,s.m_linearVelocity.y+=s.m_invMass*v,s.m_angularVelocity+=s.m_invI*(l*v-h*f)}else this.m_impulse=0},r.prototype.SolveVelocityConstraints=function(){var t,e=this.m_bodyA,i=this.m_bodyB;t=e.m_xf.R;var o=this.m_localAnchor1.x-e.m_sweep.localCenter.x,n=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=t.col1.x*o+t.col2.x*n;n=t.col1.y*o+t.col2.y*n,o=s,t=i.m_xf.R;var r=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;s=t.col1.x*r+t.col2.x*a,a=t.col1.y*r+t.col2.y*a,r=s;var l=e.m_linearVelocity.x+-e.m_angularVelocity*n,h=e.m_linearVelocity.y+e.m_angularVelocity*o,c=i.m_linearVelocity.x+-i.m_angularVelocity*a,m=i.m_linearVelocity.y+i.m_angularVelocity*r,_=this.m_u.x*(c-l)+this.m_u.y*(m-h),u=-this.m_mass*(_+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=u;var p=u*this.m_u.x,y=u*this.m_u.y;e.m_linearVelocity.x-=e.m_invMass*p,e.m_linearVelocity.y-=e.m_invMass*y,e.m_angularVelocity-=e.m_invI*(o*y-n*p),i.m_linearVelocity.x+=i.m_invMass*p,i.m_linearVelocity.y+=i.m_invMass*y,i.m_angularVelocity+=i.m_invI*(r*y-a*p)},r.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);var i;if(this.m_frequencyHz>0)return!0;var n=this.m_bodyA,s=this.m_bodyB;i=n.m_xf.R;var r=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y,l=i.col1.x*r+i.col2.x*a;a=i.col1.y*r+i.col2.y*a,r=l,i=s.m_xf.R;var h=this.m_localAnchor2.x-s.m_sweep.localCenter.x,c=this.m_localAnchor2.y-s.m_sweep.localCenter.y;l=i.col1.x*h+i.col2.x*c,c=i.col1.y*h+i.col2.y*c,h=l;var m=s.m_sweep.c.x+h-n.m_sweep.c.x-r,_=s.m_sweep.c.y+c-n.m_sweep.c.y-a,u=Math.sqrt(m*m+_*_);m/=u,_/=u;var p=u-this.m_length;p=o.Clamp(p,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection);var y=-this.m_mass*p;this.m_u.Set(m,_);var x=y*this.m_u.x,d=y*this.m_u.y;return n.m_sweep.c.x-=n.m_invMass*x,n.m_sweep.c.y-=n.m_invMass*d,n.m_sweep.a-=n.m_invI*(r*d-a*x),s.m_sweep.c.x+=s.m_invMass*x,s.m_sweep.c.y+=s.m_invMass*d,s.m_sweep.a+=s.m_invI*(h*d-c*x),n.SynchronizeTransform(),s.SynchronizeTransform(),o.Abs(p)<t.b2_linearSlop},Box2D.inherit(a,Box2D.Dynamics.Joints.b2JointDef),a.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,a.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},a.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},a.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o));
var n=o.x-i.x,s=o.y-i.y;this.length=Math.sqrt(n*n+s*s),this.frequencyHz=0,this.dampingRatio=0},Box2D.inherit(l,Box2D.Dynamics.Joints.b2Joint),l.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,l.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new n,this.m_localAnchorB=new n,this.m_linearMass=new e,this.m_linearImpulse=new n},l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},l.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)},l.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_angularImpulse},l.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},l.prototype.GetMaxForce=function(){return this.m_maxForce},l.prototype.SetMaxTorque=function(t){void 0===t&&(t=0),this.m_maxTorque=t},l.prototype.GetMaxTorque=function(){return this.m_maxTorque},l.prototype.b2FrictionJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque},l.prototype.InitVelocityConstraints=function(t){var i,o=0,n=this.m_bodyA,s=this.m_bodyB;i=n.m_xf.R;var r=this.m_localAnchorA.x-n.m_sweep.localCenter.x,a=this.m_localAnchorA.y-n.m_sweep.localCenter.y;o=i.col1.x*r+i.col2.x*a,a=i.col1.y*r+i.col2.y*a,r=o,i=s.m_xf.R;var l=this.m_localAnchorB.x-s.m_sweep.localCenter.x,h=this.m_localAnchorB.y-s.m_sweep.localCenter.y;o=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=o;var c=n.m_invMass,m=s.m_invMass,_=n.m_invI,u=s.m_invI,p=new e;if(p.col1.x=c+m,p.col2.x=0,p.col1.y=0,p.col2.y=c+m,p.col1.x+=_*a*a,p.col2.x+=-_*r*a,p.col1.y+=-_*r*a,p.col2.y+=_*r*r,p.col1.x+=u*h*h,p.col2.x+=-u*l*h,p.col1.y+=-u*l*h,p.col2.y+=u*l*l,p.GetInverse(this.m_linearMass),this.m_angularMass=_+u,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.x*=t.dtRatio,this.m_linearImpulse.y*=t.dtRatio,this.m_angularImpulse*=t.dtRatio;var y=this.m_linearImpulse;n.m_linearVelocity.x-=c*y.x,n.m_linearVelocity.y-=c*y.y,n.m_angularVelocity-=_*(r*y.y-a*y.x+this.m_angularImpulse),s.m_linearVelocity.x+=m*y.x,s.m_linearVelocity.y+=m*y.y,s.m_angularVelocity+=u*(l*y.y-h*y.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},l.prototype.SolveVelocityConstraints=function(t){var e,i=0,s=this.m_bodyA,r=this.m_bodyB,a=s.m_linearVelocity,l=s.m_angularVelocity,h=r.m_linearVelocity,c=r.m_angularVelocity,m=s.m_invMass,_=r.m_invMass,u=s.m_invI,p=r.m_invI;e=s.m_xf.R;var y=this.m_localAnchorA.x-s.m_sweep.localCenter.x,x=this.m_localAnchorA.y-s.m_sweep.localCenter.y;i=e.col1.x*y+e.col2.x*x,x=e.col1.y*y+e.col2.y*x,y=i,e=r.m_xf.R;var d=this.m_localAnchorB.x-r.m_sweep.localCenter.x,f=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*d+e.col2.x*f,f=e.col1.y*d+e.col2.y*f,d=i;var v=0,b=c-l,g=-this.m_angularMass*b,D=this.m_angularImpulse;v=t.dt*this.m_maxTorque,this.m_angularImpulse=o.Clamp(this.m_angularImpulse+g,-v,v),g=this.m_angularImpulse-D,l-=u*g,c+=p*g;var C=h.x-c*f-a.x+l*x,B=h.y+c*d-a.y-l*y,w=o.MulMV(this.m_linearMass,new n(-C,-B)),S=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(w),v=t.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>v*v&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(v)),w=o.SubtractVV(this.m_linearImpulse,S),a.x-=m*w.x,a.y-=m*w.y,l-=u*(y*w.y-x*w.x),h.x+=_*w.x,h.y+=_*w.y,c+=p*(d*w.y-f*w.x),s.m_angularVelocity=l,r.m_angularVelocity=c},l.prototype.SolvePositionConstraints=function(t){return void 0===t&&(t=0),!0},Box2D.inherit(h,Box2D.Dynamics.Joints.b2JointDef),h.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,h.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},h.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_frictionJoint,this.maxForce=0,this.maxTorque=0},h.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i))},Box2D.inherit(c,Box2D.Dynamics.Joints.b2Joint),c.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,c.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new n,this.m_groundAnchor2=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_J=new _},c.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},c.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},c.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)},c.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);var e=this.m_bodyB.m_xf.R,i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,o=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,n=e.col1.x*i+e.col2.x*o;o=e.col1.y*i+e.col2.y*o,i=n;var s=this.m_impulse*this.m_J.linearB.x,r=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-i*r+o*s)},c.prototype.GetRatio=function(){return this.m_ratio},c.prototype.SetRatio=function(t){void 0===t&&(t=0),this.m_ratio=t},c.prototype.b2GearJoint=function(t){this.__super.b2Joint.call(this,t);var e=parseInt(t.joint1.m_type),i=parseInt(t.joint2.m_type);this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var o=0,n=0;this.m_ground1=t.joint1.GetBodyA(),this.m_bodyA=t.joint1.GetBodyB(),e==u.e_revoluteJoint?(this.m_revolute1=t.joint1 instanceof B?t.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),o=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1 instanceof b?t.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),o=this.m_prismatic1.GetJointTranslation()),this.m_ground2=t.joint2.GetBodyA(),this.m_bodyB=t.joint2.GetBodyB(),i==u.e_revoluteJoint?(this.m_revolute2=t.joint2 instanceof B?t.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),n=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2 instanceof b?t.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),n=this.m_prismatic2.GetJointTranslation()),this.m_ratio=t.ratio,this.m_constant=o+this.m_ratio*n,this.m_impulse=0},c.prototype.InitVelocityConstraints=function(t){var e,i,o=this.m_ground1,n=this.m_ground2,s=this.m_bodyA,r=this.m_bodyB,a=0,l=0,h=0,c=0,m=0,_=0,u=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,u+=s.m_invI):(e=o.m_xf.R,i=this.m_prismatic1.m_localXAxis1,a=e.col1.x*i.x+e.col2.x*i.y,l=e.col1.y*i.x+e.col2.y*i.y,e=s.m_xf.R,h=this.m_localAnchor1.x-s.m_sweep.localCenter.x,c=this.m_localAnchor1.y-s.m_sweep.localCenter.y,_=e.col1.x*h+e.col2.x*c,c=e.col1.y*h+e.col2.y*c,h=_,m=h*l-c*a,this.m_J.linearA.Set(-a,-l),this.m_J.angularA=-m,u+=s.m_invMass+s.m_invI*m*m),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,u+=this.m_ratio*this.m_ratio*r.m_invI):(e=n.m_xf.R,i=this.m_prismatic2.m_localXAxis1,a=e.col1.x*i.x+e.col2.x*i.y,l=e.col1.y*i.x+e.col2.y*i.y,e=r.m_xf.R,h=this.m_localAnchor2.x-r.m_sweep.localCenter.x,c=this.m_localAnchor2.y-r.m_sweep.localCenter.y,_=e.col1.x*h+e.col2.x*c,c=e.col1.y*h+e.col2.y*c,h=_,m=h*l-c*a,this.m_J.linearB.Set(-this.m_ratio*a,-this.m_ratio*l),this.m_J.angularB=-this.m_ratio*m,u+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*m*m)),this.m_mass=u>0?1/u:0,t.warmStarting?(s.m_linearVelocity.x+=s.m_invMass*this.m_impulse*this.m_J.linearA.x,s.m_linearVelocity.y+=s.m_invMass*this.m_impulse*this.m_J.linearA.y,s.m_angularVelocity+=s.m_invI*this.m_impulse*this.m_J.angularA,r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},c.prototype.SolveVelocityConstraints=function(){var t=this.m_bodyA,e=this.m_bodyB,i=this.m_J.Compute(t.m_linearVelocity,t.m_angularVelocity,e.m_linearVelocity,e.m_angularVelocity),o=-this.m_mass*i;this.m_impulse+=o,t.m_linearVelocity.x+=t.m_invMass*o*this.m_J.linearA.x,t.m_linearVelocity.y+=t.m_invMass*o*this.m_J.linearA.y,t.m_angularVelocity+=t.m_invI*o*this.m_J.angularA,e.m_linearVelocity.x+=e.m_invMass*o*this.m_J.linearB.x,e.m_linearVelocity.y+=e.m_invMass*o*this.m_J.linearB.y,e.m_angularVelocity+=e.m_invI*o*this.m_J.angularB},c.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);var i=0,o=this.m_bodyA,n=this.m_bodyB,s=0,r=0;s=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),r=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();var a=this.m_constant-(s+this.m_ratio*r),l=-this.m_mass*a;return o.m_sweep.c.x+=o.m_invMass*l*this.m_J.linearA.x,o.m_sweep.c.y+=o.m_invMass*l*this.m_J.linearA.y,o.m_sweep.a+=o.m_invI*l*this.m_J.angularA,n.m_sweep.c.x+=n.m_invMass*l*this.m_J.linearB.x,n.m_sweep.c.y+=n.m_invMass*l*this.m_J.linearB.y,n.m_sweep.a+=n.m_invI*l*this.m_J.angularB,o.SynchronizeTransform(),n.SynchronizeTransform(),i<t.b2_linearSlop},Box2D.inherit(m,Box2D.Dynamics.Joints.b2JointDef),m.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,m.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},m.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},_.b2Jacobian=function(){this.linearA=new n,this.linearB=new n},_.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},_.prototype.Set=function(t,e,i,o){void 0===e&&(e=0),void 0===o&&(o=0),this.linearA.SetV(t),this.angularA=e,this.linearB.SetV(i),this.angularB=o},_.prototype.Compute=function(t,e,i,o){return void 0===e&&(e=0),void 0===o&&(o=0),this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*e+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*o},u.b2Joint=function(){this.m_edgeA=new y,this.m_edgeB=new y,this.m_localCenterA=new n,this.m_localCenterB=new n},u.prototype.GetType=function(){return this.m_type},u.prototype.GetAnchorA=function(){return null},u.prototype.GetAnchorB=function(){return null},u.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),null},u.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},u.prototype.GetBodyA=function(){return this.m_bodyA},u.prototype.GetBodyB=function(){return this.m_bodyB},u.prototype.GetNext=function(){return this.m_next},u.prototype.GetUserData=function(){return this.m_userData},u.prototype.SetUserData=function(t){this.m_userData=t},u.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},u.Create=function(t){var e=null;switch(t.type){case u.e_distanceJoint:e=new r(t instanceof a?t:null);break;case u.e_mouseJoint:e=new f(t instanceof v?t:null);break;case u.e_prismaticJoint:e=new b(t instanceof g?t:null);break;case u.e_revoluteJoint:e=new B(t instanceof w?t:null);break;case u.e_pulleyJoint:e=new D(t instanceof C?t:null);break;case u.e_gearJoint:e=new c(t instanceof m?t:null);break;case u.e_lineJoint:e=new x(t instanceof d?t:null);break;case u.e_weldJoint:e=new S(t instanceof A?t:null);break;case u.e_frictionJoint:e=new l(t instanceof h?t:null)}return e},u.Destroy=function(){},u.prototype.b2Joint=function(e){t.b2Assert(e.bodyA!=e.bodyB),this.m_type=e.type,this.m_prev=null,this.m_next=null,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=e.collideConnected,this.m_islandFlag=!1,this.m_userData=e.userData},u.prototype.InitVelocityConstraints=function(){},u.prototype.SolveVelocityConstraints=function(){},u.prototype.FinalizeVelocityConstraints=function(){},u.prototype.SolvePositionConstraints=function(t){return void 0===t&&(t=0),!1},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3}),p.b2JointDef=function(){},p.prototype.b2JointDef=function(){this.type=u.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},y.b2JointEdge=function(){},Box2D.inherit(x,Box2D.Dynamics.Joints.b2Joint),x.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,x.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_localXAxis1=new n,this.m_localYAxis1=new n,this.m_axis=new n,this.m_perp=new n,this.m_K=new e,this.m_impulse=new n},x.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},x.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},x.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},x.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},x.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchor1),o=e.GetWorldPoint(this.m_localAnchor2),n=o.x-i.x,s=o.y-i.y,r=t.GetWorldVector(this.m_localXAxis1),a=r.x*n+r.y*s;return a},x.prototype.GetJointSpeed=function(){var t,e=this.m_bodyA,i=this.m_bodyB;t=e.m_xf.R;var o=this.m_localAnchor1.x-e.m_sweep.localCenter.x,n=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=t.col1.x*o+t.col2.x*n;n=t.col1.y*o+t.col2.y*n,o=s,t=i.m_xf.R;var r=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;s=t.col1.x*r+t.col2.x*a,a=t.col1.y*r+t.col2.y*a,r=s;var l=e.m_sweep.c.x+o,h=e.m_sweep.c.y+n,c=i.m_sweep.c.x+r,m=i.m_sweep.c.y+a,_=c-l,u=m-h,p=e.GetWorldVector(this.m_localXAxis1),y=e.m_linearVelocity,x=i.m_linearVelocity,d=e.m_angularVelocity,f=i.m_angularVelocity,v=_*-d*p.y+u*d*p.x+(p.x*(x.x+-f*a-y.x- -d*n)+p.y*(x.y+f*r-y.y-d*o));return v},x.prototype.IsLimitEnabled=function(){return this.m_enableLimit},x.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},x.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},x.prototype.GetUpperLimit=function(){return this.m_upperTranslation},x.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},x.prototype.IsMotorEnabled=function(){return this.m_enableMotor},x.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},x.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},x.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},x.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},x.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},x.prototype.GetMotorForce=function(){return this.m_motorImpulse},x.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=u.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},x.prototype.InitVelocityConstraints=function(e){var i,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(s.GetLocalCenter());var a=n.GetTransform();s.GetTransform(),i=n.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y;r=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=r,i=s.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,m=this.m_localAnchor2.y-this.m_localCenterB.y;r=i.col1.x*c+i.col2.x*m,m=i.col1.y*c+i.col2.y*m,c=r;var _=s.m_sweep.c.x+c-n.m_sweep.c.x-l,p=s.m_sweep.c.y+m-n.m_sweep.c.y-h;this.m_invMassA=n.m_invMass,this.m_invMassB=s.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=s.m_invI,this.m_axis.SetV(o.MulMV(a.R,this.m_localXAxis1)),this.m_a1=(_+l)*this.m_axis.y-(p+h)*this.m_axis.x,this.m_a2=c*this.m_axis.y-m*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(o.MulMV(a.R,this.m_localYAxis1)),this.m_s1=(_+l)*this.m_perp.y-(p+h)*this.m_perp.x,this.m_s2=c*this.m_perp.y-m*this.m_perp.x;var y=this.m_invMassA,x=this.m_invMassB,d=this.m_invIA,f=this.m_invIB;if(this.m_K.col1.x=y+x+d*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.col1.y=d*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=y+x+d*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_enableLimit){var v=this.m_axis.x*_+this.m_axis.y*p;o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?this.m_limitState=u.e_equalLimits:v<=this.m_lowerTranslation?this.m_limitState!=u.e_atLowerLimit&&(this.m_limitState=u.e_atLowerLimit,this.m_impulse.y=0):v>=this.m_upperTranslation?this.m_limitState!=u.e_atUpperLimit&&(this.m_limitState=u.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=u.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=u.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var b=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,g=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,D=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,C=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;n.m_linearVelocity.x-=this.m_invMassA*b,n.m_linearVelocity.y-=this.m_invMassA*g,n.m_angularVelocity-=this.m_invIA*D,s.m_linearVelocity.x+=this.m_invMassB*b,s.m_linearVelocity.y+=this.m_invMassB*g,s.m_angularVelocity+=this.m_invIB*C}else this.m_impulse.SetZero(),this.m_motorImpulse=0},x.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,s=e.m_linearVelocity,r=e.m_angularVelocity,a=i.m_linearVelocity,l=i.m_angularVelocity,h=0,c=0,m=0,_=0;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits){var p=this.m_axis.x*(a.x-s.x)+this.m_axis.y*(a.y-s.y)+this.m_a2*l-this.m_a1*r,y=this.m_motorMass*(this.m_motorSpeed-p),x=this.m_motorImpulse,d=t.dt*this.m_maxMotorForce;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+y,-d,d),y=this.m_motorImpulse-x,h=y*this.m_axis.x,c=y*this.m_axis.y,m=y*this.m_a1,_=y*this.m_a2,s.x-=this.m_invMassA*h,s.y-=this.m_invMassA*c,r-=this.m_invIA*m,a.x+=this.m_invMassB*h,a.y+=this.m_invMassB*c,l+=this.m_invIB*_}var f=this.m_perp.x*(a.x-s.x)+this.m_perp.y*(a.y-s.y)+this.m_s2*l-this.m_s1*r;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){var v=this.m_axis.x*(a.x-s.x)+this.m_axis.y*(a.y-s.y)+this.m_a2*l-this.m_a1*r,b=this.m_impulse.Copy(),g=this.m_K.Solve(new n,-f,-v);this.m_impulse.Add(g),this.m_limitState==u.e_atLowerLimit?this.m_impulse.y=o.Max(this.m_impulse.y,0):this.m_limitState==u.e_atUpperLimit&&(this.m_impulse.y=o.Min(this.m_impulse.y,0));var D=-f-(this.m_impulse.y-b.y)*this.m_K.col2.x,C=0;C=0!=this.m_K.col1.x?D/this.m_K.col1.x+b.x:b.x,this.m_impulse.x=C,g.x=this.m_impulse.x-b.x,g.y=this.m_impulse.y-b.y,h=g.x*this.m_perp.x+g.y*this.m_axis.x,c=g.x*this.m_perp.y+g.y*this.m_axis.y,m=g.x*this.m_s1+g.y*this.m_a1,_=g.x*this.m_s2+g.y*this.m_a2,s.x-=this.m_invMassA*h,s.y-=this.m_invMassA*c,r-=this.m_invIA*m,a.x+=this.m_invMassB*h,a.y+=this.m_invMassB*c,l+=this.m_invIB*_}else{var B=0;B=0!=this.m_K.col1.x?-f/this.m_K.col1.x:0,this.m_impulse.x+=B,h=B*this.m_perp.x,c=B*this.m_perp.y,m=B*this.m_s1,_=B*this.m_s2,s.x-=this.m_invMassA*h,s.y-=this.m_invMassA*c,r-=this.m_invIA*m,a.x+=this.m_invMassB*h,a.y+=this.m_invMassB*c,l+=this.m_invIB*_}e.m_linearVelocity.SetV(s),e.m_angularVelocity=r,i.m_linearVelocity.SetV(a),i.m_angularVelocity=l},x.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var s,r=this.m_bodyA,a=this.m_bodyB,l=r.m_sweep.c,h=r.m_sweep.a,c=a.m_sweep.c,m=a.m_sweep.a,_=0,u=0,p=0,y=0,x=0,d=0,f=0,v=!1,b=0,g=e.FromAngle(h),D=e.FromAngle(m);s=g;var C=this.m_localAnchor1.x-this.m_localCenterA.x,B=this.m_localAnchor1.y-this.m_localCenterA.y;_=s.col1.x*C+s.col2.x*B,B=s.col1.y*C+s.col2.y*B,C=_,s=D;var w=this.m_localAnchor2.x-this.m_localCenterB.x,S=this.m_localAnchor2.y-this.m_localCenterB.y;_=s.col1.x*w+s.col2.x*S,S=s.col1.y*w+s.col2.y*S,w=_;var A=c.x+w-l.x-C,M=c.y+S-l.y-B;if(this.m_enableLimit){this.m_axis=o.MulMV(g,this.m_localXAxis1),this.m_a1=(A+C)*this.m_axis.y-(M+B)*this.m_axis.x,this.m_a2=w*this.m_axis.y-S*this.m_axis.x;var I=this.m_axis.x*A+this.m_axis.y*M;o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?(b=o.Clamp(I,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),d=o.Abs(I),v=!0):I<=this.m_lowerTranslation?(b=o.Clamp(I-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),d=this.m_lowerTranslation-I,v=!0):I>=this.m_upperTranslation&&(b=o.Clamp(I-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),d=I-this.m_upperTranslation,v=!0)}this.m_perp=o.MulMV(g,this.m_localYAxis1),this.m_s1=(A+C)*this.m_perp.y-(M+B)*this.m_perp.x,this.m_s2=w*this.m_perp.y-S*this.m_perp.x;var V=new n,L=this.m_perp.x*A+this.m_perp.y*M;if(d=o.Max(d,o.Abs(L)),f=0,v)u=this.m_invMassA,p=this.m_invMassB,y=this.m_invIA,x=this.m_invIB,this.m_K.col1.x=u+p+y*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,this.m_K.col1.y=y*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=u+p+y*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_K.Solve(V,-L,-b);else{u=this.m_invMassA,p=this.m_invMassB,y=this.m_invIA,x=this.m_invIB;var P=u+p+y*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,T=0;T=0!=P?-L/P:0,V.x=T,V.y=0}var G=V.x*this.m_perp.x+V.y*this.m_axis.x,R=V.x*this.m_perp.y+V.y*this.m_axis.y,F=V.x*this.m_s1+V.y*this.m_a1,E=V.x*this.m_s2+V.y*this.m_a2;return l.x-=this.m_invMassA*G,l.y-=this.m_invMassA*R,h-=this.m_invIA*F,c.x+=this.m_invMassB*G,c.y+=this.m_invMassB*R,m+=this.m_invIB*E,r.m_sweep.a=h,a.m_sweep.a=m,r.SynchronizeTransform(),a.SynchronizeTransform(),d<=t.b2_linearSlop&&f<=t.b2_angularSlop},Box2D.inherit(d,Box2D.Dynamics.Joints.b2JointDef),d.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,d.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n,this.localAxisA=new n},d.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},d.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(o)},Box2D.inherit(f,Box2D.Dynamics.Joints.b2Joint),f.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,f.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new e,this.K1=new e,this.K2=new e,this.m_localAnchor=new n,this.m_target=new n,this.m_impulse=new n,this.m_mass=new e,this.m_C=new n},f.prototype.GetAnchorA=function(){return this.m_target},f.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},f.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},f.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},f.prototype.GetTarget=function(){return this.m_target},f.prototype.SetTarget=function(t){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=t},f.prototype.GetMaxForce=function(){return this.m_maxForce},f.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},f.prototype.GetFrequency=function(){return this.m_frequencyHz},f.prototype.SetFrequency=function(t){void 0===t&&(t=0),this.m_frequencyHz=t},f.prototype.GetDampingRatio=function(){return this.m_dampingRatio},f.prototype.SetDampingRatio=function(t){void 0===t&&(t=0),this.m_dampingRatio=t},f.prototype.b2MouseJoint=function(t){this.__super.b2Joint.call(this,t),this.m_target.SetV(t.target);var e=this.m_target.x-this.m_bodyB.m_xf.position.x,i=this.m_target.y-this.m_bodyB.m_xf.position.y,o=this.m_bodyB.m_xf.R;this.m_localAnchor.x=e*o.col1.x+i*o.col1.y,this.m_localAnchor.y=e*o.col2.x+i*o.col2.y,this.m_maxForce=t.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0},f.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyB,i=e.GetMass(),o=2*Math.PI*this.m_frequencyHz,n=2*i*this.m_dampingRatio*o,s=i*o*o;this.m_gamma=t.dt*(n+t.dt*s),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=t.dt*s*this.m_gamma;var r;r=e.m_xf.R;var a=this.m_localAnchor.x-e.m_sweep.localCenter.x,l=this.m_localAnchor.y-e.m_sweep.localCenter.y,h=r.col1.x*a+r.col2.x*l;l=r.col1.y*a+r.col2.y*l,a=h;var c=e.m_invMass,m=e.m_invI;this.K1.col1.x=c,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=c,this.K2.col1.x=m*l*l,this.K2.col2.x=-m*a*l,this.K2.col1.y=-m*a*l,this.K2.col2.y=m*a*a,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=e.m_sweep.c.x+a-this.m_target.x,this.m_C.y=e.m_sweep.c.y+l-this.m_target.y,e.m_angularVelocity*=.98,this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,e.m_linearVelocity.x+=c*this.m_impulse.x,e.m_linearVelocity.y+=c*this.m_impulse.y,e.m_angularVelocity+=m*(a*this.m_impulse.y-l*this.m_impulse.x)},f.prototype.SolveVelocityConstraints=function(t){var e,i=this.m_bodyB,o=0,n=0;e=i.m_xf.R;var s=this.m_localAnchor.x-i.m_sweep.localCenter.x,r=this.m_localAnchor.y-i.m_sweep.localCenter.y;o=e.col1.x*s+e.col2.x*r,r=e.col1.y*s+e.col2.y*r,s=o;var a=i.m_linearVelocity.x+-i.m_angularVelocity*r,l=i.m_linearVelocity.y+i.m_angularVelocity*s;e=this.m_mass,o=a+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,n=l+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var h=-(e.col1.x*o+e.col2.x*n),c=-(e.col1.y*o+e.col2.y*n),m=this.m_impulse.x,_=this.m_impulse.y;this.m_impulse.x+=h,this.m_impulse.y+=c;var u=t.dt*this.m_maxForce;this.m_impulse.LengthSquared()>u*u&&this.m_impulse.Multiply(u/this.m_impulse.Length()),h=this.m_impulse.x-m,c=this.m_impulse.y-_,i.m_linearVelocity.x+=i.m_invMass*h,i.m_linearVelocity.y+=i.m_invMass*c,i.m_angularVelocity+=i.m_invI*(s*c-r*h)},f.prototype.SolvePositionConstraints=function(t){return void 0===t&&(t=0),!0},Box2D.inherit(v,Box2D.Dynamics.Joints.b2JointDef),v.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,v.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new n},v.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},Box2D.inherit(b,Box2D.Dynamics.Joints.b2Joint),b.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,b.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_localXAxis1=new n,this.m_localYAxis1=new n,this.m_axis=new n,this.m_perp=new n,this.m_K=new i,this.m_impulse=new s},b.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},b.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},b.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchor1),o=e.GetWorldPoint(this.m_localAnchor2),n=o.x-i.x,s=o.y-i.y,r=t.GetWorldVector(this.m_localXAxis1),a=r.x*n+r.y*s;return a},b.prototype.GetJointSpeed=function(){var t,e=this.m_bodyA,i=this.m_bodyB;t=e.m_xf.R;var o=this.m_localAnchor1.x-e.m_sweep.localCenter.x,n=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=t.col1.x*o+t.col2.x*n;n=t.col1.y*o+t.col2.y*n,o=s,t=i.m_xf.R;var r=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;s=t.col1.x*r+t.col2.x*a,a=t.col1.y*r+t.col2.y*a,r=s;var l=e.m_sweep.c.x+o,h=e.m_sweep.c.y+n,c=i.m_sweep.c.x+r,m=i.m_sweep.c.y+a,_=c-l,u=m-h,p=e.GetWorldVector(this.m_localXAxis1),y=e.m_linearVelocity,x=i.m_linearVelocity,d=e.m_angularVelocity,f=i.m_angularVelocity,v=_*-d*p.y+u*d*p.x+(p.x*(x.x+-f*a-y.x- -d*n)+p.y*(x.y+f*r-y.y-d*o));return v},b.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},b.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},b.prototype.GetUpperLimit=function(){return this.m_upperTranslation},b.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},b.prototype.IsMotorEnabled=function(){return this.m_enableMotor},b.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},b.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},b.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},b.prototype.GetMotorForce=function(){return this.m_motorImpulse},b.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=u.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()
},b.prototype.InitVelocityConstraints=function(e){var i,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(s.GetLocalCenter());var a=n.GetTransform();s.GetTransform(),i=n.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y;r=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=r,i=s.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,m=this.m_localAnchor2.y-this.m_localCenterB.y;r=i.col1.x*c+i.col2.x*m,m=i.col1.y*c+i.col2.y*m,c=r;var _=s.m_sweep.c.x+c-n.m_sweep.c.x-l,p=s.m_sweep.c.y+m-n.m_sweep.c.y-h;this.m_invMassA=n.m_invMass,this.m_invMassB=s.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=s.m_invI,this.m_axis.SetV(o.MulMV(a.R,this.m_localXAxis1)),this.m_a1=(_+l)*this.m_axis.y-(p+h)*this.m_axis.x,this.m_a2=c*this.m_axis.y-m*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(o.MulMV(a.R,this.m_localYAxis1)),this.m_s1=(_+l)*this.m_perp.y-(p+h)*this.m_perp.x,this.m_s2=c*this.m_perp.y-m*this.m_perp.x;var y=this.m_invMassA,x=this.m_invMassB,d=this.m_invIA,f=this.m_invIB;if(this.m_K.col1.x=y+x+d*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.col1.y=d*this.m_s1+f*this.m_s2,this.m_K.col1.z=d*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=d+f,this.m_K.col2.z=d*this.m_a1+f*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=y+x+d*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_enableLimit){var v=this.m_axis.x*_+this.m_axis.y*p;o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?this.m_limitState=u.e_equalLimits:v<=this.m_lowerTranslation?this.m_limitState!=u.e_atLowerLimit&&(this.m_limitState=u.e_atLowerLimit,this.m_impulse.z=0):v>=this.m_upperTranslation?this.m_limitState!=u.e_atUpperLimit&&(this.m_limitState=u.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=u.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=u.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var b=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,g=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,D=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,C=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.m_linearVelocity.x-=this.m_invMassA*b,n.m_linearVelocity.y-=this.m_invMassA*g,n.m_angularVelocity-=this.m_invIA*D,s.m_linearVelocity.x+=this.m_invMassB*b,s.m_linearVelocity.y+=this.m_invMassB*g,s.m_angularVelocity+=this.m_invIB*C}else this.m_impulse.SetZero(),this.m_motorImpulse=0},b.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,r=e.m_linearVelocity,a=e.m_angularVelocity,l=i.m_linearVelocity,h=i.m_angularVelocity,c=0,m=0,_=0,p=0;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits){var y=this.m_axis.x*(l.x-r.x)+this.m_axis.y*(l.y-r.y)+this.m_a2*h-this.m_a1*a,x=this.m_motorMass*(this.m_motorSpeed-y),d=this.m_motorImpulse,f=t.dt*this.m_maxMotorForce;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+x,-f,f),x=this.m_motorImpulse-d,c=x*this.m_axis.x,m=x*this.m_axis.y,_=x*this.m_a1,p=x*this.m_a2,r.x-=this.m_invMassA*c,r.y-=this.m_invMassA*m,a-=this.m_invIA*_,l.x+=this.m_invMassB*c,l.y+=this.m_invMassB*m,h+=this.m_invIB*p}var v=this.m_perp.x*(l.x-r.x)+this.m_perp.y*(l.y-r.y)+this.m_s2*h-this.m_s1*a,b=h-a;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){var g=this.m_axis.x*(l.x-r.x)+this.m_axis.y*(l.y-r.y)+this.m_a2*h-this.m_a1*a,D=this.m_impulse.Copy(),C=this.m_K.Solve33(new s,-v,-b,-g);this.m_impulse.Add(C),this.m_limitState==u.e_atLowerLimit?this.m_impulse.z=o.Max(this.m_impulse.z,0):this.m_limitState==u.e_atUpperLimit&&(this.m_impulse.z=o.Min(this.m_impulse.z,0));var B=-v-(this.m_impulse.z-D.z)*this.m_K.col3.x,w=-b-(this.m_impulse.z-D.z)*this.m_K.col3.y,S=this.m_K.Solve22(new n,B,w);S.x+=D.x,S.y+=D.y,this.m_impulse.x=S.x,this.m_impulse.y=S.y,C.x=this.m_impulse.x-D.x,C.y=this.m_impulse.y-D.y,C.z=this.m_impulse.z-D.z,c=C.x*this.m_perp.x+C.z*this.m_axis.x,m=C.x*this.m_perp.y+C.z*this.m_axis.y,_=C.x*this.m_s1+C.y+C.z*this.m_a1,p=C.x*this.m_s2+C.y+C.z*this.m_a2,r.x-=this.m_invMassA*c,r.y-=this.m_invMassA*m,a-=this.m_invIA*_,l.x+=this.m_invMassB*c,l.y+=this.m_invMassB*m,h+=this.m_invIB*p}else{var A=this.m_K.Solve22(new n,-v,-b);this.m_impulse.x+=A.x,this.m_impulse.y+=A.y,c=A.x*this.m_perp.x,m=A.x*this.m_perp.y,_=A.x*this.m_s1+A.y,p=A.x*this.m_s2+A.y,r.x-=this.m_invMassA*c,r.y-=this.m_invMassA*m,a-=this.m_invIA*_,l.x+=this.m_invMassB*c,l.y+=this.m_invMassB*m,h+=this.m_invIB*p}e.m_linearVelocity.SetV(r),e.m_angularVelocity=a,i.m_linearVelocity.SetV(l),i.m_angularVelocity=h},b.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var r,a=this.m_bodyA,l=this.m_bodyB,h=a.m_sweep.c,c=a.m_sweep.a,m=l.m_sweep.c,_=l.m_sweep.a,u=0,p=0,y=0,x=0,d=0,f=0,v=0,b=!1,g=0,D=e.FromAngle(c),C=e.FromAngle(_);r=D;var B=this.m_localAnchor1.x-this.m_localCenterA.x,w=this.m_localAnchor1.y-this.m_localCenterA.y;u=r.col1.x*B+r.col2.x*w,w=r.col1.y*B+r.col2.y*w,B=u,r=C;var S=this.m_localAnchor2.x-this.m_localCenterB.x,A=this.m_localAnchor2.y-this.m_localCenterB.y;u=r.col1.x*S+r.col2.x*A,A=r.col1.y*S+r.col2.y*A,S=u;var M=m.x+S-h.x-B,I=m.y+A-h.y-w;if(this.m_enableLimit){this.m_axis=o.MulMV(D,this.m_localXAxis1),this.m_a1=(M+B)*this.m_axis.y-(I+w)*this.m_axis.x,this.m_a2=S*this.m_axis.y-A*this.m_axis.x;var V=this.m_axis.x*M+this.m_axis.y*I;o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?(g=o.Clamp(V,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),f=o.Abs(V),b=!0):V<=this.m_lowerTranslation?(g=o.Clamp(V-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),f=this.m_lowerTranslation-V,b=!0):V>=this.m_upperTranslation&&(g=o.Clamp(V-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),f=V-this.m_upperTranslation,b=!0)}this.m_perp=o.MulMV(D,this.m_localYAxis1),this.m_s1=(M+B)*this.m_perp.y-(I+w)*this.m_perp.x,this.m_s2=S*this.m_perp.y-A*this.m_perp.x;var L=new s,P=this.m_perp.x*M+this.m_perp.y*I,T=_-c-this.m_refAngle;if(f=o.Max(f,o.Abs(P)),v=o.Abs(T),b)p=this.m_invMassA,y=this.m_invMassB,x=this.m_invIA,d=this.m_invIB,this.m_K.col1.x=p+y+x*this.m_s1*this.m_s1+d*this.m_s2*this.m_s2,this.m_K.col1.y=x*this.m_s1+d*this.m_s2,this.m_K.col1.z=x*this.m_s1*this.m_a1+d*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=x+d,this.m_K.col2.z=x*this.m_a1+d*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=p+y+x*this.m_a1*this.m_a1+d*this.m_a2*this.m_a2,this.m_K.Solve33(L,-P,-T,-g);else{p=this.m_invMassA,y=this.m_invMassB,x=this.m_invIA,d=this.m_invIB;var G=p+y+x*this.m_s1*this.m_s1+d*this.m_s2*this.m_s2,R=x*this.m_s1+d*this.m_s2,F=x+d;this.m_K.col1.Set(G,R,0),this.m_K.col2.Set(R,F,0);var E=this.m_K.Solve22(new n,-P,-T);L.x=E.x,L.y=E.y,L.z=0}var J=L.x*this.m_perp.x+L.z*this.m_axis.x,j=L.x*this.m_perp.y+L.z*this.m_axis.y,k=L.x*this.m_s1+L.y+L.z*this.m_a1,O=L.x*this.m_s2+L.y+L.z*this.m_a2;return h.x-=this.m_invMassA*J,h.y-=this.m_invMassA*j,c-=this.m_invIA*k,m.x+=this.m_invMassB*J,m.y+=this.m_invMassB*j,_+=this.m_invIB*O,a.m_sweep.a=c,l.m_sweep.a=_,a.SynchronizeTransform(),l.SynchronizeTransform(),f<=t.b2_linearSlop&&v<=t.b2_angularSlop},Box2D.inherit(g,Box2D.Dynamics.Joints.b2JointDef),g.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,g.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n,this.localAxisA=new n},g.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},g.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(o),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(D,Box2D.Dynamics.Joints.b2Joint),D.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,D.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new n,this.m_groundAnchor2=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_u1=new n,this.m_u2=new n},D.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},D.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},D.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)},D.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},D.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor1),t},D.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor2),t},D.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,o=t.x-e,n=t.y-i;return Math.sqrt(o*o+n*n)},D.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),e=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,o=t.x-e,n=t.y-i;return Math.sqrt(o*o+n*n)},D.prototype.GetRatio=function(){return this.m_ratio},D.prototype.b2PulleyJoint=function(t){this.__super.b2Joint.call(this,t),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_ratio=t.ratio,this.m_constant=t.lengthA+this.m_ratio*t.lengthB,this.m_maxLength1=o.Min(t.maxLengthA,this.m_constant-this.m_ratio*D.b2_minPulleyLength),this.m_maxLength2=o.Min(t.maxLengthB,(this.m_constant-D.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},D.prototype.InitVelocityConstraints=function(e){var i,o=this.m_bodyA,n=this.m_bodyB;i=o.m_xf.R;var s=this.m_localAnchor1.x-o.m_sweep.localCenter.x,r=this.m_localAnchor1.y-o.m_sweep.localCenter.y,a=i.col1.x*s+i.col2.x*r;r=i.col1.y*s+i.col2.y*r,s=a,i=n.m_xf.R;var l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,h=this.m_localAnchor2.y-n.m_sweep.localCenter.y;a=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=a;var c=o.m_sweep.c.x+s,m=o.m_sweep.c.y+r,_=n.m_sweep.c.x+l,p=n.m_sweep.c.y+h,y=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,x=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,d=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,f=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(c-y,m-x),this.m_u2.Set(_-d,p-f);var v=this.m_u1.Length(),b=this.m_u2.Length();v>t.b2_linearSlop?this.m_u1.Multiply(1/v):this.m_u1.SetZero(),b>t.b2_linearSlop?this.m_u2.Multiply(1/b):this.m_u2.SetZero();var g=this.m_constant-v-this.m_ratio*b;g>0?(this.m_state=u.e_inactiveLimit,this.m_impulse=0):this.m_state=u.e_atUpperLimit,v<this.m_maxLength1?(this.m_limitState1=u.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=u.e_atUpperLimit,b<this.m_maxLength2?(this.m_limitState2=u.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=u.e_atUpperLimit;var D=s*this.m_u1.y-r*this.m_u1.x,C=l*this.m_u2.y-h*this.m_u2.x;if(this.m_limitMass1=o.m_invMass+o.m_invI*D*D,this.m_limitMass2=n.m_invMass+n.m_invI*C*C,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,e.warmStarting){this.m_impulse*=e.dtRatio,this.m_limitImpulse1*=e.dtRatio,this.m_limitImpulse2*=e.dtRatio;var B=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,w=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,S=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,A=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;o.m_linearVelocity.x+=o.m_invMass*B,o.m_linearVelocity.y+=o.m_invMass*w,o.m_angularVelocity+=o.m_invI*(s*w-r*B),n.m_linearVelocity.x+=n.m_invMass*S,n.m_linearVelocity.y+=n.m_invMass*A,n.m_angularVelocity+=n.m_invI*(l*A-h*S)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},D.prototype.SolveVelocityConstraints=function(){var t,e=this.m_bodyA,i=this.m_bodyB;t=e.m_xf.R;var n=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,r=t.col1.x*n+t.col2.x*s;s=t.col1.y*n+t.col2.y*s,n=r,t=i.m_xf.R;var a=this.m_localAnchor2.x-i.m_sweep.localCenter.x,l=this.m_localAnchor2.y-i.m_sweep.localCenter.y;r=t.col1.x*a+t.col2.x*l,l=t.col1.y*a+t.col2.y*l,a=r;var h=0,c=0,m=0,_=0,p=0,y=0,x=0,d=0,f=0,v=0,b=0;this.m_state==u.e_atUpperLimit&&(h=e.m_linearVelocity.x+-e.m_angularVelocity*s,c=e.m_linearVelocity.y+e.m_angularVelocity*n,m=i.m_linearVelocity.x+-i.m_angularVelocity*l,_=i.m_linearVelocity.y+i.m_angularVelocity*a,f=-(this.m_u1.x*h+this.m_u1.y*c)-this.m_ratio*(this.m_u2.x*m+this.m_u2.y*_),v=this.m_pulleyMass*-f,b=this.m_impulse,this.m_impulse=o.Max(0,this.m_impulse+v),v=this.m_impulse-b,p=-v*this.m_u1.x,y=-v*this.m_u1.y,x=-this.m_ratio*v*this.m_u2.x,d=-this.m_ratio*v*this.m_u2.y,e.m_linearVelocity.x+=e.m_invMass*p,e.m_linearVelocity.y+=e.m_invMass*y,e.m_angularVelocity+=e.m_invI*(n*y-s*p),i.m_linearVelocity.x+=i.m_invMass*x,i.m_linearVelocity.y+=i.m_invMass*d,i.m_angularVelocity+=i.m_invI*(a*d-l*x)),this.m_limitState1==u.e_atUpperLimit&&(h=e.m_linearVelocity.x+-e.m_angularVelocity*s,c=e.m_linearVelocity.y+e.m_angularVelocity*n,f=-(this.m_u1.x*h+this.m_u1.y*c),v=-this.m_limitMass1*f,b=this.m_limitImpulse1,this.m_limitImpulse1=o.Max(0,this.m_limitImpulse1+v),v=this.m_limitImpulse1-b,p=-v*this.m_u1.x,y=-v*this.m_u1.y,e.m_linearVelocity.x+=e.m_invMass*p,e.m_linearVelocity.y+=e.m_invMass*y,e.m_angularVelocity+=e.m_invI*(n*y-s*p)),this.m_limitState2==u.e_atUpperLimit&&(m=i.m_linearVelocity.x+-i.m_angularVelocity*l,_=i.m_linearVelocity.y+i.m_angularVelocity*a,f=-(this.m_u2.x*m+this.m_u2.y*_),v=-this.m_limitMass2*f,b=this.m_limitImpulse2,this.m_limitImpulse2=o.Max(0,this.m_limitImpulse2+v),v=this.m_limitImpulse2-b,x=-v*this.m_u2.x,d=-v*this.m_u2.y,i.m_linearVelocity.x+=i.m_invMass*x,i.m_linearVelocity.y+=i.m_invMass*d,i.m_angularVelocity+=i.m_invI*(a*d-l*x))},D.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);var i,n=this.m_bodyA,s=this.m_bodyB,r=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,h=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,c=0,m=0,_=0,p=0,y=0,x=0,d=0,f=0,v=0,b=0,g=0,D=0,C=0,B=0;return this.m_state==u.e_atUpperLimit&&(i=n.m_xf.R,c=this.m_localAnchor1.x-n.m_sweep.localCenter.x,m=this.m_localAnchor1.y-n.m_sweep.localCenter.y,C=i.col1.x*c+i.col2.x*m,m=i.col1.y*c+i.col2.y*m,c=C,i=s.m_xf.R,_=this.m_localAnchor2.x-s.m_sweep.localCenter.x,p=this.m_localAnchor2.y-s.m_sweep.localCenter.y,C=i.col1.x*_+i.col2.x*p,p=i.col1.y*_+i.col2.y*p,_=C,y=n.m_sweep.c.x+c,x=n.m_sweep.c.y+m,d=s.m_sweep.c.x+_,f=s.m_sweep.c.y+p,this.m_u1.Set(y-r,x-a),this.m_u2.Set(d-l,f-h),v=this.m_u1.Length(),b=this.m_u2.Length(),v>t.b2_linearSlop?this.m_u1.Multiply(1/v):this.m_u1.SetZero(),b>t.b2_linearSlop?this.m_u2.Multiply(1/b):this.m_u2.SetZero(),g=this.m_constant-v-this.m_ratio*b,B=o.Max(B,-g),g=o.Clamp(g+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),D=-this.m_pulleyMass*g,y=-D*this.m_u1.x,x=-D*this.m_u1.y,d=-this.m_ratio*D*this.m_u2.x,f=-this.m_ratio*D*this.m_u2.y,n.m_sweep.c.x+=n.m_invMass*y,n.m_sweep.c.y+=n.m_invMass*x,n.m_sweep.a+=n.m_invI*(c*x-m*y),s.m_sweep.c.x+=s.m_invMass*d,s.m_sweep.c.y+=s.m_invMass*f,s.m_sweep.a+=s.m_invI*(_*f-p*d),n.SynchronizeTransform(),s.SynchronizeTransform()),this.m_limitState1==u.e_atUpperLimit&&(i=n.m_xf.R,c=this.m_localAnchor1.x-n.m_sweep.localCenter.x,m=this.m_localAnchor1.y-n.m_sweep.localCenter.y,C=i.col1.x*c+i.col2.x*m,m=i.col1.y*c+i.col2.y*m,c=C,y=n.m_sweep.c.x+c,x=n.m_sweep.c.y+m,this.m_u1.Set(y-r,x-a),v=this.m_u1.Length(),v>t.b2_linearSlop?(this.m_u1.x*=1/v,this.m_u1.y*=1/v):this.m_u1.SetZero(),g=this.m_maxLength1-v,B=o.Max(B,-g),g=o.Clamp(g+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),D=-this.m_limitMass1*g,y=-D*this.m_u1.x,x=-D*this.m_u1.y,n.m_sweep.c.x+=n.m_invMass*y,n.m_sweep.c.y+=n.m_invMass*x,n.m_sweep.a+=n.m_invI*(c*x-m*y),n.SynchronizeTransform()),this.m_limitState2==u.e_atUpperLimit&&(i=s.m_xf.R,_=this.m_localAnchor2.x-s.m_sweep.localCenter.x,p=this.m_localAnchor2.y-s.m_sweep.localCenter.y,C=i.col1.x*_+i.col2.x*p,p=i.col1.y*_+i.col2.y*p,_=C,d=s.m_sweep.c.x+_,f=s.m_sweep.c.y+p,this.m_u2.Set(d-l,f-h),b=this.m_u2.Length(),b>t.b2_linearSlop?(this.m_u2.x*=1/b,this.m_u2.y*=1/b):this.m_u2.SetZero(),g=this.m_maxLength2-b,B=o.Max(B,-g),g=o.Clamp(g+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),D=-this.m_limitMass2*g,d=-D*this.m_u2.x,f=-D*this.m_u2.y,s.m_sweep.c.x+=s.m_invMass*d,s.m_sweep.c.y+=s.m_invMass*f,s.m_sweep.a+=s.m_invI*(_*f-p*d),s.SynchronizeTransform()),B<t.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),Box2D.inherit(C,Box2D.Dynamics.Joints.b2JointDef),C.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,C.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new n,this.groundAnchorB=new n,this.localAnchorA=new n,this.localAnchorB=new n},C.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},C.prototype.Initialize=function(t,e,i,o,n,s,r){void 0===r&&(r=0),this.bodyA=t,this.bodyB=e,this.groundAnchorA.SetV(i),this.groundAnchorB.SetV(o),this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(s);var a=n.x-i.x,l=n.y-i.y;this.lengthA=Math.sqrt(a*a+l*l);var h=s.x-o.x,c=s.y-o.y;this.lengthB=Math.sqrt(h*h+c*c),this.ratio=r;var m=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=m-this.ratio*D.b2_minPulleyLength,this.maxLengthB=(m-D.b2_minPulleyLength)/this.ratio},Box2D.inherit(B,Box2D.Dynamics.Joints.b2Joint),B.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,B.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new e,this.K1=new e,this.K2=new e,this.K3=new e,this.impulse3=new s,this.impulse2=new n,this.reduced=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_impulse=new s,this.m_mass=new i},B.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},B.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},B.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},B.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},B.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},B.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},B.prototype.IsLimitEnabled=function(){return this.m_enableLimit},B.prototype.EnableLimit=function(t){this.m_enableLimit=t},B.prototype.GetLowerLimit=function(){return this.m_lowerAngle},B.prototype.GetUpperLimit=function(){return this.m_upperAngle},B.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_lowerAngle=t,this.m_upperAngle=e},B.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},B.prototype.EnableMotor=function(t){this.m_enableMotor=t},B.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},B.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},B.prototype.SetMaxMotorTorque=function(t){void 0===t&&(t=0),this.m_maxMotorTorque=t},B.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},B.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=u.e_inactiveLimit},B.prototype.InitVelocityConstraints=function(e){var i,n=this.m_bodyA,s=this.m_bodyB,r=0;this.m_enableMotor||this.m_enableLimit,i=n.m_xf.R;var a=this.m_localAnchor1.x-n.m_sweep.localCenter.x,l=this.m_localAnchor1.y-n.m_sweep.localCenter.y;r=i.col1.x*a+i.col2.x*l,l=i.col1.y*a+i.col2.y*l,a=r,i=s.m_xf.R;var h=this.m_localAnchor2.x-s.m_sweep.localCenter.x,c=this.m_localAnchor2.y-s.m_sweep.localCenter.y;r=i.col1.x*h+i.col2.x*c,c=i.col1.y*h+i.col2.y*c,h=r;var m=n.m_invMass,_=s.m_invMass,p=n.m_invI,y=s.m_invI;if(this.m_mass.col1.x=m+_+l*l*p+c*c*y,this.m_mass.col2.x=-l*a*p-c*h*y,this.m_mass.col3.x=-l*p-c*y,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=m+_+a*a*p+h*h*y,this.m_mass.col3.y=a*p+h*y,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=p+y,this.m_motorMass=1/(p+y),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit){var x=s.m_sweep.a-n.m_sweep.a-this.m_referenceAngle;o.Abs(this.m_upperAngle-this.m_lowerAngle)<2*t.b2_angularSlop?this.m_limitState=u.e_equalLimits:x<=this.m_lowerAngle?(this.m_limitState!=u.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=u.e_atLowerLimit):x>=this.m_upperAngle?(this.m_limitState!=u.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=u.e_atUpperLimit):(this.m_limitState=u.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=u.e_inactiveLimit;if(e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var d=this.m_impulse.x,f=this.m_impulse.y;n.m_linearVelocity.x-=m*d,n.m_linearVelocity.y-=m*f,n.m_angularVelocity-=p*(a*f-l*d+this.m_motorImpulse+this.m_impulse.z),s.m_linearVelocity.x+=_*d,s.m_linearVelocity.y+=_*f,s.m_angularVelocity+=y*(h*f-c*d+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},B.prototype.SolveVelocityConstraints=function(t){var e,i=this.m_bodyA,n=this.m_bodyB,s=0,r=0,a=0,l=0,h=0,c=0,m=i.m_linearVelocity,_=i.m_angularVelocity,p=n.m_linearVelocity,y=n.m_angularVelocity,x=i.m_invMass,d=n.m_invMass,f=i.m_invI,v=n.m_invI;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits){var b=y-_-this.m_motorSpeed,g=this.m_motorMass*-b,D=this.m_motorImpulse,C=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+g,-C,C),g=this.m_motorImpulse-D,_-=f*g,y+=v*g}if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){e=i.m_xf.R,a=this.m_localAnchor1.x-i.m_sweep.localCenter.x,l=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=s,e=n.m_xf.R,h=this.m_localAnchor2.x-n.m_sweep.localCenter.x,c=this.m_localAnchor2.y-n.m_sweep.localCenter.y,s=e.col1.x*h+e.col2.x*c,c=e.col1.y*h+e.col2.y*c,h=s;var B=p.x+-y*c-m.x- -_*l,w=p.y+y*h-m.y-_*a,S=y-_;this.m_mass.Solve33(this.impulse3,-B,-w,-S),this.m_limitState==u.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==u.e_atLowerLimit?(r=this.m_impulse.z+this.impulse3.z,0>r&&(this.m_mass.Solve22(this.reduced,-B,-w),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==u.e_atUpperLimit&&(r=this.m_impulse.z+this.impulse3.z,r>0&&(this.m_mass.Solve22(this.reduced,-B,-w),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),m.x-=x*this.impulse3.x,m.y-=x*this.impulse3.y,_-=f*(a*this.impulse3.y-l*this.impulse3.x+this.impulse3.z),p.x+=d*this.impulse3.x,p.y+=d*this.impulse3.y,y+=v*(h*this.impulse3.y-c*this.impulse3.x+this.impulse3.z)}else{e=i.m_xf.R,a=this.m_localAnchor1.x-i.m_sweep.localCenter.x,l=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=s,e=n.m_xf.R,h=this.m_localAnchor2.x-n.m_sweep.localCenter.x,c=this.m_localAnchor2.y-n.m_sweep.localCenter.y,s=e.col1.x*h+e.col2.x*c,c=e.col1.y*h+e.col2.y*c,h=s;var A=p.x+-y*c-m.x- -_*l,M=p.y+y*h-m.y-_*a;this.m_mass.Solve22(this.impulse2,-A,-M),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,m.x-=x*this.impulse2.x,m.y-=x*this.impulse2.y,_-=f*(a*this.impulse2.y-l*this.impulse2.x),p.x+=d*this.impulse2.x,p.y+=d*this.impulse2.y,y+=v*(h*this.impulse2.y-c*this.impulse2.x)}i.m_linearVelocity.SetV(m),i.m_angularVelocity=_,n.m_linearVelocity.SetV(p),n.m_angularVelocity=y},B.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);var i,n=0,s=this.m_bodyA,r=this.m_bodyB,a=0,l=0,h=0,c=0,m=0;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){var _=r.m_sweep.a-s.m_sweep.a-this.m_referenceAngle,p=0;this.m_limitState==u.e_equalLimits?(n=o.Clamp(_-this.m_lowerAngle,-t.b2_maxAngularCorrection,t.b2_maxAngularCorrection),p=-this.m_motorMass*n,a=o.Abs(n)):this.m_limitState==u.e_atLowerLimit?(n=_-this.m_lowerAngle,a=-n,n=o.Clamp(n+t.b2_angularSlop,-t.b2_maxAngularCorrection,0),p=-this.m_motorMass*n):this.m_limitState==u.e_atUpperLimit&&(n=_-this.m_upperAngle,a=n,n=o.Clamp(n-t.b2_angularSlop,0,t.b2_maxAngularCorrection),p=-this.m_motorMass*n),s.m_sweep.a-=s.m_invI*p,r.m_sweep.a+=r.m_invI*p,s.SynchronizeTransform(),r.SynchronizeTransform()}i=s.m_xf.R;var y=this.m_localAnchor1.x-s.m_sweep.localCenter.x,x=this.m_localAnchor1.y-s.m_sweep.localCenter.y;h=i.col1.x*y+i.col2.x*x,x=i.col1.y*y+i.col2.y*x,y=h,i=r.m_xf.R;var d=this.m_localAnchor2.x-r.m_sweep.localCenter.x,f=this.m_localAnchor2.y-r.m_sweep.localCenter.y;h=i.col1.x*d+i.col2.x*f,f=i.col1.y*d+i.col2.y*f,d=h;var v=r.m_sweep.c.x+d-s.m_sweep.c.x-y,b=r.m_sweep.c.y+f-s.m_sweep.c.y-x,g=v*v+b*b,D=Math.sqrt(g);l=D;var C=s.m_invMass,w=r.m_invMass,S=s.m_invI,A=r.m_invI,M=10*t.b2_linearSlop;if(g>M*M){var I=C+w,V=1/I;c=V*-v,m=V*-b;var L=.5;s.m_sweep.c.x-=L*C*c,s.m_sweep.c.y-=L*C*m,r.m_sweep.c.x+=L*w*c,r.m_sweep.c.y+=L*w*m,v=r.m_sweep.c.x+d-s.m_sweep.c.x-y,b=r.m_sweep.c.y+f-s.m_sweep.c.y-x}return this.K1.col1.x=C+w,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=C+w,this.K2.col1.x=S*x*x,this.K2.col2.x=-S*y*x,this.K2.col1.y=-S*y*x,this.K2.col2.y=S*y*y,this.K3.col1.x=A*f*f,this.K3.col2.x=-A*d*f,this.K3.col1.y=-A*d*f,this.K3.col2.y=A*d*d,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(B.tImpulse,-v,-b),c=B.tImpulse.x,m=B.tImpulse.y,s.m_sweep.c.x-=s.m_invMass*c,s.m_sweep.c.y-=s.m_invMass*m,s.m_sweep.a-=s.m_invI*(y*m-x*c),r.m_sweep.c.x+=r.m_invMass*c,r.m_sweep.c.y+=r.m_invMass*m,r.m_sweep.a+=r.m_invI*(d*m-f*c),s.SynchronizeTransform(),r.SynchronizeTransform(),l<=t.b2_linearSlop&&a<=t.b2_angularSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new n}),Box2D.inherit(w,Box2D.Dynamics.Joints.b2JointDef),w.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,w.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},w.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},w.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(S,Box2D.Dynamics.Joints.b2Joint),S.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,S.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new n,this.m_localAnchorB=new n,this.m_impulse=new s,this.m_mass=new i},S.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},S.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},S.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},S.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},S.prototype.b2WeldJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new i},S.prototype.InitVelocityConstraints=function(t){var e,i=0,o=this.m_bodyA,n=this.m_bodyB;e=o.m_xf.R;var s=this.m_localAnchorA.x-o.m_sweep.localCenter.x,r=this.m_localAnchorA.y-o.m_sweep.localCenter.y;i=e.col1.x*s+e.col2.x*r,r=e.col1.y*s+e.col2.y*r,s=i,e=n.m_xf.R;var a=this.m_localAnchorB.x-n.m_sweep.localCenter.x,l=this.m_localAnchorB.y-n.m_sweep.localCenter.y;i=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=i;var h=o.m_invMass,c=n.m_invMass,m=o.m_invI,_=n.m_invI;this.m_mass.col1.x=h+c+r*r*m+l*l*_,this.m_mass.col2.x=-r*s*m-l*a*_,this.m_mass.col3.x=-r*m-l*_,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=h+c+s*s*m+a*a*_,this.m_mass.col3.y=s*m+a*_,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=m+_,t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_impulse.z*=t.dtRatio,o.m_linearVelocity.x-=h*this.m_impulse.x,o.m_linearVelocity.y-=h*this.m_impulse.y,o.m_angularVelocity-=m*(s*this.m_impulse.y-r*this.m_impulse.x+this.m_impulse.z),n.m_linearVelocity.x+=c*this.m_impulse.x,n.m_linearVelocity.y+=c*this.m_impulse.y,n.m_angularVelocity+=_*(a*this.m_impulse.y-l*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},S.prototype.SolveVelocityConstraints=function(){var t,e=0,i=this.m_bodyA,o=this.m_bodyB,n=i.m_linearVelocity,r=i.m_angularVelocity,a=o.m_linearVelocity,l=o.m_angularVelocity,h=i.m_invMass,c=o.m_invMass,m=i.m_invI,_=o.m_invI;t=i.m_xf.R;var u=this.m_localAnchorA.x-i.m_sweep.localCenter.x,p=this.m_localAnchorA.y-i.m_sweep.localCenter.y;e=t.col1.x*u+t.col2.x*p,p=t.col1.y*u+t.col2.y*p,u=e,t=o.m_xf.R;var y=this.m_localAnchorB.x-o.m_sweep.localCenter.x,x=this.m_localAnchorB.y-o.m_sweep.localCenter.y;e=t.col1.x*y+t.col2.x*x,x=t.col1.y*y+t.col2.y*x,y=e;var d=a.x-l*x-n.x+r*p,f=a.y+l*y-n.y-r*u,v=l-r,b=new s;this.m_mass.Solve33(b,-d,-f,-v),this.m_impulse.Add(b),n.x-=h*b.x,n.y-=h*b.y,r-=m*(u*b.y-p*b.x+b.z),a.x+=c*b.x,a.y+=c*b.y,l+=_*(y*b.y-x*b.x+b.z),i.m_angularVelocity=r,o.m_angularVelocity=l},S.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);var i,n=0,r=this.m_bodyA,a=this.m_bodyB;i=r.m_xf.R;var l=this.m_localAnchorA.x-r.m_sweep.localCenter.x,h=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=n,i=a.m_xf.R;var c=this.m_localAnchorB.x-a.m_sweep.localCenter.x,m=this.m_localAnchorB.y-a.m_sweep.localCenter.y;
n=i.col1.x*c+i.col2.x*m,m=i.col1.y*c+i.col2.y*m,c=n;var _=r.m_invMass,u=a.m_invMass,p=r.m_invI,y=a.m_invI,x=a.m_sweep.c.x+c-r.m_sweep.c.x-l,d=a.m_sweep.c.y+m-r.m_sweep.c.y-h,f=a.m_sweep.a-r.m_sweep.a-this.m_referenceAngle,v=10*t.b2_linearSlop,b=Math.sqrt(x*x+d*d),g=o.Abs(f);b>v&&(p*=1,y*=1),this.m_mass.col1.x=_+u+h*h*p+m*m*y,this.m_mass.col2.x=-h*l*p-m*c*y,this.m_mass.col3.x=-h*p-m*y,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=_+u+l*l*p+c*c*y,this.m_mass.col3.y=l*p+c*y,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=p+y;var D=new s;return this.m_mass.Solve33(D,-x,-d,-f),r.m_sweep.c.x-=_*D.x,r.m_sweep.c.y-=_*D.y,r.m_sweep.a-=p*(l*D.y-h*D.x+D.z),a.m_sweep.c.x+=u*D.x,a.m_sweep.c.y+=u*D.y,a.m_sweep.a+=y*(c*D.y-m*D.x+D.z),r.SynchronizeTransform(),a.SynchronizeTransform(),b<=t.b2_linearSlop&&g<=t.b2_angularSlop},Box2D.inherit(A,Box2D.Dynamics.Joints.b2JointDef),A.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,A.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},A.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=u.e_weldJoint,this.referenceAngle=0},A.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var t=Box2D.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var t=this;this.m_sprite={graphics:{clear:function(){t.m_ctx.clearRect(0,0,t.m_ctx.canvas.width,t.m_ctx.canvas.height)}}}},t.prototype._color=function(t,e){return"rgba("+((16711680&t)>>16)+","+((65280&t)>>8)+","+(255&t)+","+e+")"},t.prototype.b2DebugDraw=function(){this.m_drawFlags=0},t.prototype.SetFlags=function(t){void 0===t&&(t=0),this.m_drawFlags=t},t.prototype.GetFlags=function(){return this.m_drawFlags},t.prototype.AppendFlags=function(t){void 0===t&&(t=0),this.m_drawFlags|=t},t.prototype.ClearFlags=function(t){void 0===t&&(t=0),this.m_drawFlags&=~t},t.prototype.SetSprite=function(t){this.m_ctx=t},t.prototype.GetSprite=function(){return this.m_ctx},t.prototype.SetDrawScale=function(t){void 0===t&&(t=0),this.m_drawScale=t},t.prototype.GetDrawScale=function(){return this.m_drawScale},t.prototype.SetLineThickness=function(t){void 0===t&&(t=0),this.m_lineThickness=t,this.m_ctx.strokeWidth=t},t.prototype.GetLineThickness=function(){return this.m_lineThickness},t.prototype.SetAlpha=function(t){void 0===t&&(t=0),this.m_alpha=t},t.prototype.GetAlpha=function(){return this.m_alpha},t.prototype.SetFillAlpha=function(t){void 0===t&&(t=0),this.m_fillAlpha=t},t.prototype.GetFillAlpha=function(){return this.m_fillAlpha},t.prototype.SetXFormScale=function(t){void 0===t&&(t=0),this.m_xformScale=t},t.prototype.GetXFormScale=function(){return this.m_xformScale},t.prototype.DrawPolygon=function(t,e,i){if(e){var o=this.m_ctx,n=this.m_drawScale;o.beginPath(),o.strokeStyle=this._color(i.color,this.m_alpha),o.moveTo(t[0].x*n,t[0].y*n);for(var s=1;e>s;s++)o.lineTo(t[s].x*n,t[s].y*n);o.lineTo(t[0].x*n,t[0].y*n),o.closePath(),o.stroke()}},t.prototype.DrawSolidPolygon=function(t,e,i){if(e){var o=this.m_ctx,n=this.m_drawScale;o.beginPath(),o.strokeStyle=this._color(i.color,this.m_alpha),o.fillStyle=this._color(i.color,this.m_fillAlpha),o.moveTo(t[0].x*n,t[0].y*n);for(var s=1;e>s;s++)o.lineTo(t[s].x*n,t[s].y*n);o.lineTo(t[0].x*n,t[0].y*n),o.closePath(),o.fill(),o.stroke()}},t.prototype.DrawCircle=function(t,e,i){if(e){var o=this.m_ctx,n=this.m_drawScale;o.beginPath(),o.strokeStyle=this._color(i.color,this.m_alpha),o.arc(t.x*n,t.y*n,e*n,0,2*Math.PI,!0),o.closePath(),o.stroke()}},t.prototype.DrawSolidCircle=function(t,e,i,o){if(e){var n=this.m_ctx,s=this.m_drawScale,r=t.x*s,a=t.y*s;n.moveTo(0,0),n.beginPath(),n.strokeStyle=this._color(o.color,this.m_alpha),n.fillStyle=this._color(o.color,this.m_fillAlpha),n.arc(r,a,e*s,0,2*Math.PI,!0),n.moveTo(r,a),n.lineTo((t.x+i.x*e)*s,(t.y+i.y*e)*s),n.closePath(),n.fill(),n.stroke()}},t.prototype.DrawSegment=function(t,e,i){var o=this.m_ctx,n=this.m_drawScale;o.strokeStyle=this._color(i.color,this.m_alpha),o.beginPath(),o.moveTo(t.x*n,t.y*n),o.lineTo(e.x*n,e.y*n),o.closePath(),o.stroke()},t.prototype.DrawTransform=function(t){var e=this.m_ctx,i=this.m_drawScale;e.beginPath(),e.strokeStyle=this._color(16711680,this.m_alpha),e.moveTo(t.position.x*i,t.position.y*i),e.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*i,(t.position.y+this.m_xformScale*t.R.col1.y)*i),e.strokeStyle=this._color(65280,this.m_alpha),e.moveTo(t.position.x*i,t.position.y*i),e.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*i,(t.position.y+this.m_xformScale*t.R.col2.y)*i),e.closePath(),e.stroke()}}();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs,define("Box2dWeb",function(t){return function(){var e;return e||t.Box2D}}(this)),define("box2d",["Box2dWeb"],function(t){return{b2Vec2:t.Common.Math.b2Vec2,b2BodyDef:t.Dynamics.b2BodyDef,b2Body:t.Dynamics.b2Body,b2FixtureDef:t.Dynamics.b2FixtureDef,b2Fixture:t.Dynamics.b2Fixture,b2World:t.Dynamics.b2World,b2MassData:t.Collision.Shapes.b2MassData,b2PolygonShape:t.Collision.Shapes.b2PolygonShape,b2CircleShape:t.Collision.Shapes.b2CircleShape,b2DebugDraw:t.Dynamics.b2DebugDraw,SCALE:30}}),function(){var t=this.createjs=this.createjs||{},t=t.PreloadJS=t.PreloadJS||{};t.version="0.3.1",t.buildDate="Thu, 09 May 2013 22:04:32 GMT"}(),this.createjs=this.createjs||{},function(){var t=function(){this.initialize()},e=t.prototype;t.initialize=function(t){t.addEventListener=e.addEventListener,t.removeEventListener=e.removeEventListener,t.removeAllEventListeners=e.removeAllEventListeners,t.hasEventListener=e.hasEventListener,t.dispatchEvent=e.dispatchEvent},e._listeners=null,e.initialize=function(){},e.addEventListener=function(t,e){var i=this._listeners;i?this.removeEventListener(t,e):i=this._listeners={};var o=i[t];return o||(o=i[t]=[]),o.push(e),e},e.removeEventListener=function(t,e){var i=this._listeners;if(i){var o=i[t];if(o)for(var n=0,s=o.length;s>n;n++)if(o[n]==e){1==s?delete i[t]:o.splice(n,1);break}}},e.removeAllEventListeners=function(t){t?this._listeners&&delete this._listeners[t]:this._listeners=null},e.dispatchEvent=function(t,e){var i=!1,o=this._listeners;if(t&&o){if("string"==typeof t&&(t={type:t}),o=o[t.type],!o)return i;t.target=e||this;for(var o=o.slice(),n=0,s=o.length;s>n;n++)var r=o[n],i=r.handleEvent?i||r.handleEvent(t):i||r(t)}return!!i},e.hasEventListener=function(t){var e=this._listeners;return!(!e||!e[t])},e.toString=function(){return"[EventDispatcher]"},createjs.EventDispatcher=t}(),this.createjs=this.createjs||{},function(){var t=function(){this.init()};t.prototype={};var e=t.prototype;t.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/,e.loaded=!1,e.canceled=!1,e.progress=0,e._item=null,e._basePath=null,e.onProgress=null,e.onLoadStart=null,e.onComplete=null,e.onError=null,e.addEventListener=null,e.removeEventListener=null,e.removeAllEventListeners=null,e.dispatchEvent=null,e.hasEventListener=null,e._listeners=null,createjs.EventDispatcher.initialize(e),e.getItem=function(){return this._item},e.init=function(){},e.load=function(){},e.close=function(){},e._sendLoadStart=function(){this._isCanceled()||(this.onLoadStart&&this.onLoadStart({target:this}),this.dispatchEvent("loadStart"),this.dispatchEvent("loadstart"))},e._sendProgress=function(t){if(!this._isCanceled()){var e=null;"number"==typeof t?(this.progress=t,e={loaded:this.progress,total:1}):(e=t,this.progress=t.loaded/t.total,(isNaN(this.progress)||1/0==this.progress)&&(this.progress=0)),e.target=this,e.type="progress",e.progress=this.progress,this.onProgress&&this.onProgress(e),this.dispatchEvent(e)}},e._sendComplete=function(){this._isCanceled()||(this.onComplete&&this.onComplete({target:this}),this.dispatchEvent("complete"))},e._sendError=function(t){this._isCanceled()||(null==t&&(t={}),t.target=this,t.type="error",this.onError&&this.onError(t),this.dispatchEvent(t))},e._isCanceled=function(){return null==window.createjs||this.canceled?!0:!1},e._parseURI=function(e){return e?e.match(t.FILE_PATTERN):null},e._formatQueryString=function(t,e){if(null==t)throw Error("You must specify data.");var i,o=[];for(i in t)o.push(i+"="+escape(t[i]));return e&&(o=o.concat(e)),o.join("&")},e.buildPath=function(t,e,i){if(null!=e){var o=this._parseURI(t);(null==o[1]||""==o[1])&&(t=e+t)}if(null==i)return t;if(e=[],o=t.indexOf("?"),-1!=o)var n=t.slice(o+1),e=e.concat(n.split("&"));return-1!=o?t.slice(0,o)+"?"+this._formatQueryString(i,e):t+"?"+this._formatQueryString(i,e)},e.toString=function(){return"[PreloadJS AbstractLoader]"},createjs.AbstractLoader=t}(),this.createjs=this.createjs||{},function(){var t=function(t,e){this.init(t,e)},e=t.prototype=new createjs.AbstractLoader;t.LOAD_TIMEOUT=8e3,t.BINARY="binary",t.CSS="css",t.IMAGE="image",t.JAVASCRIPT="javascript",t.JSON="json",t.JSONP="jsonp",t.SOUND="sound",t.SVG="svg",t.TEXT="text",t.XML="xml",t.POST="POST",t.GET="GET",e.useXHR=!0,e.stopOnError=!1,e.maintainScriptOrder=!0,e.next=null,e.onFileLoad=null,e.onFileProgress=null,e._typeCallbacks=null,e._extensionCallbacks=null,e._loadStartWasDispatched=!1,e._maxConnections=1,e._currentlyLoadingScript=null,e._currentLoads=null,e._loadQueue=null,e._loadQueueBackup=null,e._loadItemsById=null,e._loadItemsBySrc=null,e._loadedResults=null,e._loadedRawResults=null,e._numItems=0,e._numItemsLoaded=0,e._scriptOrder=null,e._loadedScripts=null,e.init=function(t,e){this._numItems=this._numItemsLoaded=0,this._loadStartWasDispatched=this._paused=!1,this._currentLoads=[],this._loadQueue=[],this._loadQueueBackup=[],this._scriptOrder=[],this._loadedScripts=[],this._loadItemsById={},this._loadItemsBySrc={},this._loadedResults={},this._loadedRawResults={},this._typeCallbacks={},this._extensionCallbacks={},this._basePath=e,this.setUseXHR(t)},e.setUseXHR=function(t){return this.useXHR=0!=t&&null!=window.XMLHttpRequest},e.removeAll=function(){this.remove()},e.remove=function(t){var e=null;if(!t||t instanceof Array?t&&(e=t):e=[t],t=!1,e){for(;e.length;){for(var i=e.pop(),o=this.getResult(i),n=this._loadQueue.length-1;n>=0;n--)if(s=this._loadQueue[n].getItem(),s.id==i||s.src==i){this._loadQueue.splice(n,1)[0].cancel();break}for(n=this._loadQueueBackup.length-1;n>=0;n--)if(s=this._loadQueueBackup[n].getItem(),s.id==i||s.src==i){this._loadQueueBackup.splice(n,1)[0].cancel();break}if(o)delete this._loadItemsById[o.id],delete this._loadItemsBySrc[o.src],this._disposeItem(o);else for(var n=this._currentLoads.length-1;n>=0;n--){var s=this._currentLoads[n].getItem();if(s.id==i||s.src==i){this._currentLoads.splice(n,1)[0].cancel(),t=!0;break}}}t&&this._loadNext()}else{this.close();for(i in this._loadItemsById)this._disposeItem(this._loadItemsById[i]);this.init(this.useXHR)}},e.reset=function(){this.close();for(var t in this._loadItemsById)this._disposeItem(this._loadItemsById[t]);for(t=[],i=0,l=this._loadQueueBackup.length;l>i;i++)t.push(this._loadQueueBackup[i].getItem());this.loadManifest(t,!1)},t.isBinary=function(t){switch(t){case createjs.LoadQueue.IMAGE:case createjs.LoadQueue.BINARY:return!0;default:return!1}},e.installPlugin=function(t){if(null!=t&&null!=t.getPreloadHandlers){if(t=t.getPreloadHandlers(),null!=t.types)for(var e=0,i=t.types.length;i>e;e++)this._typeCallbacks[t.types[e]]=t.callback;if(null!=t.extensions)for(e=0,i=t.extensions.length;i>e;e++)this._extensionCallbacks[t.extensions[e]]=t.callback}},e.setMaxConnections=function(t){this._maxConnections=t,!this._paused&&this._loadQueue.length>0&&this._loadNext()},e.loadFile=function(t,e,i){null==t?this._sendError({text:"PRELOAD_NO_FILE"}):(this._addItem(t,i),e!==!1?this.setPaused(!1):this.setPaused(!0))},e.loadManifest=function(t,e,i){var o=null;if(t instanceof Array){if(0==t.length)return this._sendError({text:"PRELOAD_MANIFEST_EMPTY"}),void 0;o=t}else{if(null==t)return this._sendError({text:"PRELOAD_MANIFEST_NULL"}),void 0;o=[t]}for(var t=0,n=o.length;n>t;t++)this._addItem(o[t],i);e!==!1?this.setPaused(!1):this.setPaused(!0)},e.load=function(){this.setPaused(!1)},e.getItem=function(t){return this._loadItemsById[t]||this._loadItemsBySrc[t]},e.getResult=function(t,e){var i=this._loadItemsById[t]||this._loadItemsBySrc[t];return null==i?null:(i=i.id,e&&this._loadedRawResults[i]?this._loadedRawResults[i]:this._loadedResults[i])},e.setPaused=function(t){(this._paused=t)||this._loadNext()},e.close=function(){for(;this._currentLoads.length;)this._currentLoads.pop().cancel();this._scriptOrder.length=0,this._loadedScripts.length=0,this.loadStartWasDispatched=!1},e._addItem=function(t,e){var i=this._createLoadItem(t);if(null!=i){var o=this._createLoader(i,e);null!=o&&(this._loadQueue.push(o),this._loadQueueBackup.push(o),this._numItems++,this._updateProgress(),this.maintainScriptOrder&&i.type==createjs.LoadQueue.JAVASCRIPT&&o instanceof createjs.XHRLoader&&(this._scriptOrder.push(i),this._loadedScripts.push(null)))}},e._createLoadItem=function(t){var e=null;switch(typeof t){case"string":e={src:t};break;case"object":e=window.HTMLAudioElement&&t instanceof HTMLAudioElement?{tag:t,src:e.tag.src,type:createjs.LoadQueue.SOUND}:t}if(t=this._parseURI(e.src),null!=t&&(e.ext=t[5]),null==e.type&&(e.type=this._getTypeByExtension(e.ext)),e.type==createjs.LoadQueue.JSON&&null!=e.callback&&(e.type=createjs.LoadQueue.JSONP),e.type==createjs.LoadQueue.JSONP&&null==e.callback)throw Error("callback is required for loading JSONP requests.");if(null==e.tag&&(e.tag=this._createTag(e.type)),(null==e.id||""==e.id)&&(e.id=e.src),t=this._typeCallbacks[e.type]||this._extensionCallbacks[e.ext]){if(t=t(e.src,e.type,e.id,e.data),t===!1)return null;t!==!0&&(null!=t.src&&(e.src=t.src),null!=t.id&&(e.id=t.id),null!=t.tag&&t.tag.load instanceof Function&&(e.tag=t.tag),null!=t.completeHandler&&(e.completeHandler=t.completeHandler)),t.type&&(e.type=t.type),t=this._parseURI(e.src),null!=t&&null!=t[5]&&(e.ext=t[5].toLowerCase())}return this._loadItemsById[e.id]=e,this._loadItemsBySrc[e.src]=e},e._createLoader=function(t,e){var i=this.useXHR;switch(t.type){case createjs.LoadQueue.JSON:case createjs.LoadQueue.XML:case createjs.LoadQueue.TEXT:i=!0;break;case createjs.LoadQueue.SOUND:case createjs.LoadQueue.JSONP:i=!1}return null==e&&(e=this._basePath),i?new createjs.XHRLoader(t,e):new createjs.TagLoader(t,e)},e._loadNext=function(){if(!this._paused){this._loadStartWasDispatched||(this._sendLoadStart(),this._loadStartWasDispatched=!0),this._numItems==this._numItemsLoaded&&(this.loaded=!0,this._sendComplete(),this.next&&this.next.load&&this.next.load());for(var t=0,e=this._loadQueue.length;e>t&&!(this._currentLoads.length>=this._maxConnections);t++){var i=this._loadQueue[t];if(this.maintainScriptOrder&&i instanceof createjs.TagLoader&&i.getItem().type==createjs.LoadQueue.JAVASCRIPT){if(this._currentlyLoadingScript)continue;this._currentlyLoadingScript=!0}this._loadQueue.splice(t,1),t--,e--,this._loadItem(i)}}},e._loadItem=function(t){t.addEventListener("progress",createjs.proxy(this._handleProgress,this)),t.addEventListener("complete",createjs.proxy(this._handleFileComplete,this)),t.addEventListener("error",createjs.proxy(this._handleFileError,this)),this._currentLoads.push(t),this._sendFileStart(t.getItem()),t.load()},e._handleFileError=function(t){var e=t.target;this._numItemsLoaded++,this._updateProgress(),t={item:e.getItem()},this._sendError(t),this.stopOnError||(this._removeLoadItem(e),this._loadNext())},e._handleFileComplete=function(t){var t=t.target,e=t.getItem();if(this._loadedResults[e.id]=t.getResult(),t instanceof createjs.XHRLoader&&(this._loadedRawResults[e.id]=t.getResult(!0)),this._removeLoadItem(t),this.maintainScriptOrder&&e.type==createjs.LoadQueue.JAVASCRIPT){if(!(t instanceof createjs.TagLoader))return this._loadedScripts[this._scriptOrder.indexOf(e)]=e,this._checkScriptLoadOrder(t),void 0;this._currentlyLoadingScript=!1}this._processFinishedLoad(e,t)},e._processFinishedLoad=function(t,e){this._numItemsLoaded++,this._updateProgress(),this._sendFileComplete(t,e),this._loadNext()},e._checkScriptLoadOrder=function(){for(var t=this._loadedScripts.length,e=0;t>e;e++){var i=this._loadedScripts[e];if(null===i)break;i!==!0&&(this._processFinishedLoad(i),this._loadedScripts[e]=!0,e--,t--)}},e._removeLoadItem=function(t){for(var e=this._currentLoads.length,i=0;e>i;i++)if(this._currentLoads[i]==t){this._currentLoads.splice(i,1);break}},e._handleProgress=function(t){t=t.target,this._sendFileProgress(t.getItem(),t.progress),this._updateProgress()},e._updateProgress=function(){var t=this._numItemsLoaded/this._numItems,e=this._numItems-this._numItemsLoaded;if(e>0){for(var i=0,o=0,n=this._currentLoads.length;n>o;o++)i+=this._currentLoads[o].progress;t+=i/e*(e/this._numItems)}this._sendProgress(t)},e._disposeItem=function(t){delete this._loadedResults[t.id],delete this._loadedRawResults[t.id],delete this._loadItemsById[t.id],delete this._loadItemsBySrc[t.src]},e._createTag=function(t){var e=null;switch(t){case createjs.LoadQueue.IMAGE:return document.createElement("img");case createjs.LoadQueue.SOUND:return e=document.createElement("audio"),e.autoplay=!1,e;case createjs.LoadQueue.JSONP:case createjs.LoadQueue.JAVASCRIPT:return e=document.createElement("script"),e.type="text/javascript",e;case createjs.LoadQueue.CSS:return e=this.useXHR?document.createElement("style"):document.createElement("link"),e.rel="stylesheet",e.type="text/css",e;case createjs.LoadQueue.SVG:return this.useXHR?e=document.createElement("svg"):(e=document.createElement("object"),e.type="image/svg+xml"),e}return null},e._getTypeByExtension=function(t){switch(t.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return createjs.LoadQueue.IMAGE;case"ogg":case"mp3":case"wav":return createjs.LoadQueue.SOUND;case"json":return createjs.LoadQueue.JSON;case"xml":return createjs.LoadQueue.XML;case"css":return createjs.LoadQueue.CSS;case"js":return createjs.LoadQueue.JAVASCRIPT;case"svg":return createjs.LoadQueue.SVG;default:return createjs.LoadQueue.TEXT}},e._sendFileProgress=function(t,e){if(this._isCanceled())this._cleanUp();else{var i={target:this,type:"fileprogress",progress:e,loaded:e,total:1,item:t};this.onFileProgress&&this.onFileProgress(i),this.dispatchEvent(i)}},e._sendFileComplete=function(t,e){if(!this._isCanceled()){var i={target:this,type:"fileload",loader:e,item:t,result:this._loadedResults[t.id],rawResult:this._loadedRawResults[t.id]};t.completeHandler&&t.completeHandler(i),this.onFileLoad&&this.onFileLoad(i),this.dispatchEvent(i)}},e._sendFileStart=function(t){this.dispatchEvent({target:this,type:"filestart",item:t})},e.toString=function(){return"[PreloadJS LoadQueue]"},t.proxy=function(t,e){return function(){return t.apply(e,arguments)}},createjs.LoadQueue=t,createjs.proxy||(createjs.proxy=function(t,e){var i=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e,Array.prototype.slice.call(arguments,0).concat(i))}});var o=function(){};o.init=function(){var t=navigator.userAgent;o.isFirefox=t.indexOf("Firefox")>-1,o.isOpera=null!=window.opera,o.isChrome=t.indexOf("Chrome")>-1,o.isIOS=t.indexOf("iPod")>-1||t.indexOf("iPhone")>-1||t.indexOf("iPad")>-1},o.init(),createjs.LoadQueue.BrowserDetect=o,Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null==this)throw new TypeError;var e=Object(this),i=e.length>>>0;if(0===i)return-1;var o=0;if(arguments.length>1&&(o=Number(arguments[1]),o!=o?o=0:0!=o&&1/0!=o&&o!=-1/0&&(o=(o>0||-1)*Math.floor(Math.abs(o)))),o>=i)return-1;for(o=o>=0?o:Math.max(i-Math.abs(o),0);i>o;o++)if(o in e&&e[o]===t)return o;return-1})}(),this.createjs=this.createjs||{},function(){var t=function(t,e){this.init(t,e)},e=t.prototype=new createjs.AbstractLoader;e._loadTimeout=null,e._tagCompleteProxy=null,e._isAudio=!1,e._tag=null,e._jsonResult=null,e.init=function(t,e){this._item=t,this._basePath=e,this._tag=t.tag,this._isAudio=window.HTMLAudioElement&&t.tag instanceof HTMLAudioElement,this._tagCompleteProxy=createjs.proxy(this._handleLoad,this)},e.getResult=function(){return this._item.type==createjs.LoadQueue.JSONP?this._jsonResult:this._tag},e.cancel=function(){this.canceled=!0,this._clean(),this.getItem()},e.load=function(){var t=this._item,e=this._tag;clearTimeout(this._loadTimeout),this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),createjs.LoadQueue.LOAD_TIMEOUT),this._isAudio&&(e.src=null,e.preload="auto"),e.onerror=createjs.proxy(this._handleError,this),this._isAudio?(e.onstalled=createjs.proxy(this._handleStalled,this),e.addEventListener("canplaythrough",this._tagCompleteProxy,!1)):(e.onload=createjs.proxy(this._handleLoad,this),e.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this));var i=this.buildPath(t.src,this._basePath,t.values);switch(t.type){case createjs.LoadQueue.CSS:e.href=i;break;case createjs.LoadQueue.SVG:e.data=i;break;default:e.src=i}if(t.type==createjs.LoadQueue.JSONP){if(null==t.callback)throw Error("callback is required for loading JSONP requests.");if(null!=window[t.callback])throw Error('JSONP callback "'+t.callback+'" already exists on window. You need to specify a different callback. Or re-name the current one.');window[t.callback]=createjs.proxy(this._handleJSONPLoad,this)}(t.type==createjs.LoadQueue.SVG||t.type==createjs.LoadQueue.JSONP||t.type==createjs.LoadQueue.JSON||t.type==createjs.LoadQueue.JAVASCRIPT||t.type==createjs.LoadQueue.CSS)&&(this._startTagVisibility=e.style.visibility,e.style.visibility="hidden",(document.body||document.getElementsByTagName("body")[0]).appendChild(e)),null!=e.load&&e.load()},e._handleJSONPLoad=function(t){this._jsonResult=t},e._handleTimeout=function(){this._clean(),this._sendError({reason:"PRELOAD_TIMEOUT"})},e._handleStalled=function(){},e._handleError=function(){this._clean(),this._sendError()},e._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var t=this.getItem().tag;("loaded"==t.readyState||"complete"==t.readyState)&&this._handleLoad()},e._handleLoad=function(){if(!this._isCanceled()){var t=this.getItem(),e=t.tag;if(!(this.loaded||this.isAudio&&4!==e.readyState)){switch(this.loaded=!0,t.type){case createjs.LoadQueue.SVG:case createjs.LoadQueue.JSONP:e.style.visibility=this._startTagVisibility,(document.body||document.getElementsByTagName("body")[0]).removeChild(e)}this._clean(),this._sendComplete()}}},e._clean=function(){clearTimeout(this._loadTimeout);var t=this.getItem().tag;t.onload=null,t.removeEventListener&&t.removeEventListener("canplaythrough",this._tagCompleteProxy,!1),t.onstalled=null,t.onprogress=null,t.onerror=null,t.parentNode&&t.parentNode.removeChild(t),t=this.getItem(),t.type==createjs.LoadQueue.JSONP&&(window[t.callback]=null)},e.toString=function(){return"[PreloadJS TagLoader]"},createjs.TagLoader=t}(),this.createjs=this.createjs||{},function(){var t=function(t,e){this.init(t,e)},e=t.prototype=new createjs.AbstractLoader;e._request=null,e._loadTimeout=null,e._xhrLevel=1,e._response=null,e._rawResponse=null,e.init=function(t,e){this._item=t,this._basePath=e,this._createXHR(t)},e.getResult=function(t){return t&&this._rawResponse?this._rawResponse:this._response},e.cancel=function(){this.canceled=!0,this._clean(),this._request.abort()},e.load=function(){if(null==this._request)this._handleError();else{this._request.onloadstart=createjs.proxy(this._handleLoadStart,this),this._request.onprogress=createjs.proxy(this._handleProgress,this),this._request.onabort=createjs.proxy(this._handleAbort,this),this._request.onerror=createjs.proxy(this._handleError,this),this._request.ontimeout=createjs.proxy(this._handleTimeout,this),1==this._xhrLevel&&(this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),createjs.LoadQueue.LOAD_TIMEOUT)),this._request.onload=createjs.proxy(this._handleLoad,this),this._request.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this);try{this._item.values&&this._item.method!=createjs.LoadQueue.GET?this._item.method==createjs.LoadQueue.POST&&this._request.send(this._formatQueryString(this._item.values)):this._request.send()}catch(t){this._sendError({source:t})}}},e.getAllResponseHeaders=function(){return this._request.getAllResponseHeaders instanceof Function?this._request.getAllResponseHeaders():null},e.getResponseHeader=function(t){return this._request.getResponseHeader instanceof Function?this._request.getResponseHeader(t):null},e._handleProgress=function(t){t.loaded>0&&0==t.total||this._sendProgress({loaded:t.loaded,total:t.total})},e._handleLoadStart=function(){clearTimeout(this._loadTimeout),this._sendLoadStart()},e._handleAbort=function(){this._clean(),this._sendError()},e._handleError=function(){this._clean(),this._sendError()},e._handleReadyStateChange=function(){4==this._request.readyState&&this._handleLoad()},e._handleLoad=function(){this.loaded||(this.loaded=!0,this._checkError()?(this._response=this._getResponse(),this._clean(),this._generateTag()&&this._sendComplete()):this._handleError())},e._handleTimeout=function(){this._clean(),this._sendError({reason:"PRELOAD_TIMEOUT"})},e._checkError=function(){switch(parseInt(this._request.status)){case 404:case 0:return!1}return!0},e._getResponse=function(){if(null!=this._response)return this._response;if(null!=this._request.response)return this._request.response;try{if(null!=this._request.responseText)return this._request.responseText}catch(t){}try{if(null!=this._request.responseXML)return this._request.responseXML}catch(e){}return null},e._createXHR=function(t){var e=document.createElement("a");e.href=this.buildPath(t.src,this._basePath);var i=document.createElement("a");if(i.href=location.href,e=""!=e.hostname&&(e.port!=i.port||e.protocol!=i.protocol||e.hostname!=i.hostname),i=null,e&&window.XDomainRequest)i=new XDomainRequest;else if(window.XMLHttpRequest)i=new XMLHttpRequest;else try{i=new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(o){try{i=new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(n){try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(s){return!1}}}t.type==createjs.LoadQueue.TEXT&&i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined"),this._xhrLevel="string"==typeof i.responseType?2:1;var r=null,r=t.method==createjs.LoadQueue.GET?this.buildPath(t.src,this._basePath,t.values):this.buildPath(t.src,this._basePath);return i.open(t.method||createjs.LoadQueue.GET,r,!0),e&&i instanceof XMLHttpRequest&&1==this._xhrLevel&&i.setRequestHeader("Origin",location.origin),t.values&&t.method==createjs.LoadQueue.POST&&i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),createjs.LoadQueue.isBinary(t.type)&&(i.responseType="arraybuffer"),this._request=i,!0},e._clean=function(){clearTimeout(this._loadTimeout);var t=this._request;t.onloadstart=null,t.onprogress=null,t.onabort=null,t.onerror=null,t.onload=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null},e._generateTag=function(){var t=this._item.tag;switch(this._item.type){case createjs.LoadQueue.IMAGE:return t.onload=createjs.proxy(this._handleTagReady,this),t.src=this.buildPath(this._item.src,this._basePath,this._item.values),this._rawResponse=this._response,this._response=t,!1;case createjs.LoadQueue.JAVASCRIPT:t=document.createElement("script"),this._rawResponse=t.text=this._response,this._response=t;break;case createjs.LoadQueue.CSS:if(document.getElementsByTagName("head")[0].appendChild(t),t.styleSheet)t.styleSheet.cssText=this._response;else{var e=document.createTextNode(this._response);t.appendChild(e)}this._rawResponse=this._response,this._response=t;break;case createjs.LoadQueue.XML:this._response=e=this._parseXML(this._response,"text/xml");break;case createjs.LoadQueue.SVG:e=this._parseXML(this._response,"image/svg+xml"),this._rawResponse=this._response,null!=e.documentElement?(t.appendChild(e.documentElement),this._response=t):this._response=e;break;case createjs.LoadQueue.JSON:t={};try{t=JSON.parse(this._response)}catch(i){t=i}this._rawResponse=this._response,this._response=t}return!0},e._parseXML=function(t,e){var i=null;return window.DOMParser?i=(new DOMParser).parseFromString(t,e):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async=!1,i.loadXML(t)),i},e._handleTagReady=function(){this._sendComplete()},e.toString=function(){return"[PreloadJS XHRLoader]"},createjs.XHRLoader=t}(),"object"!=typeof JSON&&(JSON={}),function(){function c(t){return 10>t?"0"+t:t}function a(t){return e.lastIndex=0,e.test(t)?'"'+t.replace(e,function(t){var e=o[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function d(t,e){var i,o,n,s,r,l=j,c=e[t];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(t)),"function"==typeof h&&(c=h.call(e,t,c)),typeof c){case"string":return a(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(j+=f,r=[],"[object Array]"===Object.prototype.toString.apply(c)){for(s=c.length,i=0;s>i;i+=1)r[i]=d(i,c)||"null";return n=0===r.length?"[]":j?"[\n"+j+r.join(",\n"+j)+"\n"+l+"]":"["+r.join(",")+"]",j=l,n}if(h&&"object"==typeof h)for(s=h.length,i=0;s>i;i+=1)"string"==typeof h[i]&&(o=h[i],(n=d(o,c))&&r.push(a(o)+(j?": ":":")+n));else for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(n=d(o,c))&&r.push(a(o)+(j?": ":":")+n);return n=0===r.length?"{}":j?"{\n"+j+r.join(",\n"+j)+"\n"+l+"}":"{"+r.join(",")+"}",j=l,n}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,j,f,o={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,i){var o;if(f=j="","number"==typeof i)for(o=0;i>o;o+=1)f+=" ";else"string"==typeof i&&(f=i);if((h=e)&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw Error("JSON.stringify");return d("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(a,c){function d(t,e){var i,o,n=t[e];if(n&&"object"==typeof n)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(o=d(n,i),void 0!==o?n[i]=o:delete n[i]);return c.call(t,e,n)}var e,a=String(a);if(b.lastIndex=0,b.test(a)&&(a=a.replace(b,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),"function"==typeof c?d({"":e},""):e;throw new SyntaxError("JSON.parse")})}(),define("preloadjs",function(t){return function(){var e;return e||t.createjs}}(this)),define("Level",["preloadjs"],function(t){var e=function(){};return e.load=function(e,i){var o=new t.LoadQueue;o.addEventListener("fileload",function(t){i(t.result)}),o.loadFile("assets/"+e+".json")},e}),define("Sprite",["box2d","easeljs"],function(t,e){var i=function(i,o){var n,s;switch(this.view=new e.Bitmap("../img/b1.png"),this.view.regX=this.view.regY=t.SCALE/2,n=new t.b2FixtureDef,n.density=o.density||1,n.friction=o.friction||.5,n.restitution=o.restitution||.8,s=new t.b2BodyDef,s.type="static"===o.type?t.b2Body.b2_staticBody:t.b2Body.b2_dynamicBody,s.position.x=o.x||15*Math.random()+1,s.position.y=o.y||0,o.shape){case"circle":n.shape=new t.b2CircleShape(o.radius||1);
break;default:n.shape=new t.b2PolygonShape,n.shape.SetAsBox(o.width||1,o.height||1)}this.view.body=i.CreateBody(s),this.view.body.CreateFixture(n),this.view.onTick=function(){var e=this.body.GetPosition();this.x=e.x*t.SCALE,this.y=e.y*t.SCALE,this.rotation=180*this.body.GetAngle()/Math.PI}};return i}),define("Scene",["easeljs","box2d","Level","Sprite"],function(t,e,i,o){function n(){var t=new e.b2World(new e.b2Vec2(0,10),!0);return t}var s=function(e){this.stage=new t.Stage(e),this.debug=document.getElementById("debug"),t.EventDispatcher.initialize(s.prototype),this.world=n(),t.Ticker.addListener(this),t.Ticker.setFPS(60),t.Ticker.useRAF=!0};return s.prototype.tick=function(){this.stage.update(),this.world.DrawDebugData(),this.world.Step(1/60,10,10),this.world.ClearForces()},s.prototype.loadLevel=function(t){var n=this;i.load(t,function(t){for(var i,s,r=0,a=t.ground.length;a>r;r++)i=new e.b2FixtureDef,i.density=1,i.friction=.5,s=new e.b2BodyDef,s.type=e.b2Body.b2_staticBody,s.position.x=t.ground[r].x,s.position.y=t.ground[r].y,i.shape=new e.b2PolygonShape,i.shape.SetAsBox(t.ground[r].width,t.ground[r].height),n.world.CreateBody(s).CreateFixture(i);n.debug.onmousedown=function(){var t=new o(n.world,{shape:"circle",radius:.3});n.stage.addChild(t.view)};var l=new e.b2DebugDraw;l.SetSprite(n.debug.getContext("2d")),l.SetDrawScale(e.SCALE),l.SetFillAlpha(.5),l.SetFlags(e.b2DebugDraw.e_shapeBit|e.b2DebugDraw.e_jointBit),n.world.SetDebugDraw(l)})},s}),define("Game",["Scene"],function(t){var e=function(){this.score=0,this.level="I.1"};return e.prototype.start=function(){var e=new t(document.getElementById("canvas"));e.loadLevel(this.level)},e.prototype.kill=function(){this.score+=100,console.log(this.score)},e.prototype.damage=function(){this.score+=100,console.log(this.score)},e.prototype.died=function(){this.score+=100,console.log(this.score)},new e}),define("app",["Game"],function(t){return console.log("app.js"),t.start(),{Game:t}}),require.config({shim:{Box2dWeb:{exports:"Box2D"},easeljs:{exports:"createjs"},soundjs:{exports:"createjs"},preloadjs:{exports:"createjs"}},paths:{Box2dWeb:"../components/box2dweb/Box2dWeb-2.1.a.3",easeljs:"../components/easeljs/index",soundjs:"../components/soundjs/index",preloadjs:"../components/preloadjs/index"}}),require(["app"],function(){}),define("main",function(){});